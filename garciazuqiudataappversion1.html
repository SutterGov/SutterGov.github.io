<!DOCTYPE html>
<html lang="zh-CN" class="scroll-smooth">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>åŠ è¥¿äºšè¶³çƒAPP</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.sheetjs.com/xlsx-0.20.1/package/dist/xlsx.full.min.js"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <script>
        tailwind.config = {
            darkMode: 'class',
            theme: {
                extend: {
                    colors: {
                        primary: '#1e3a5f',
                        accent: '#c9a227',
                        dark: {
                            bg: '#121212',
                            surface: '#1e1e1e',
                            border: '#2c2c2c'
                        },
                        // é˜…è¯»èƒŒæ™¯è‰²
                        reader: {
                            green: '#c7edcc',   // æµ…ç»¿è‰²
                            yellow: '#f5f0d8',  // æ·¡é»„è‰²
                            gray: '#e5e5e5',    // ç°è‰²
                            black: '#1a1a1a'    // é»‘è‰²
                        }
                    }
                }
            }
        }
    </script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Noto+Sans+SC:wght@400;500;700&display=swap');
        
        * {
            scrollbar-width: none !important;
            -ms-overflow-style: none !important;
        }
        
        *::-webkit-scrollbar {
            display: none !important;
            width: 0 !important;
            height: 0 !important;
        }
        
        html, body {
            font-family: 'Noto Sans SC', -apple-system, BlinkMacSystemFont, sans-serif;
            -webkit-tap-highlight-color: transparent;
            overflow-x: hidden;
        }
        
        body {
            scrollbar-width: none;
            -ms-overflow-style: none;
        }
        
        body::-webkit-scrollbar {
            display: none;
        }
        
        .news-card {
            transition: all 0.2s ease;
        }
        
        .news-card:active {
            transform: scale(0.98);
            opacity: 0.9;
        }
        
        .tag-active {
            position: relative;
        }
        
        .tag-active::after {
            content: '';
            position: absolute;
            bottom: -8px;
            left: 50%;
            transform: translateX(-50%);
            width: 20px;
            height: 3px;
            background-color: #10b981;
            border-radius: 2px;
        }
        
        .line-clamp-2 {
            display: -webkit-box;
            -webkit-line-clamp: 2;
            -webkit-box-orient: vertical;
            overflow: hidden;
        }
        
        .bottom-nav-item {
            transition: all 0.2s;
        }
        
        .bottom-nav-item.active {
            color: #10b981;
        }
        
        .fade-in {
            animation: fadeIn 0.3s ease-out;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        .pull-refresh {
            position: absolute;
            top: -60px;
            left: 0;
            right: 0;
            height: 60px;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: transform 0.3s;
        }
        
        .pull-refresh-spinner {
            width: 24px;
            height: 24px;
            border: 2px solid #e5e7eb;
            border-top-color: #10b981;
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }
        
        @keyframes spin {
            to { transform: rotate(360deg); }
        }
        
        .refresh-toast {
            position: fixed;
            top: 100px;
            left: 50%;
            transform: translateX(-50%) translateY(-100px);
            background: rgba(16, 185, 129, 0.95);
            color: white;
            padding: 8px 16px;
            border-radius: 20px;
            font-size: 14px;
            opacity: 0;
            transition: all 0.3s;
            z-index: 100;
            pointer-events: none;
        }
        
        .refresh-toast.show {
            transform: translateX(-50%) translateY(0);
            opacity: 1;
        }
        
        .scroll-container {
            overflow-y: auto;
            scrollbar-width: none;
            -ms-overflow-style: none;
        }
        
        .scroll-container::-webkit-scrollbar {
            display: none;
        }
        
        /* çƒé˜Ÿé¡µé¢æ ·å¼ - æ‡‚çƒå¸é£æ ¼ */
        .team-header {
            background: linear-gradient(135deg, #1e3a5f 0%, #2c5282 100%);
        }
        
        .team-logo-large {
            filter: drop-shadow(0 4px 6px rgba(0,0,0,0.3));
        }
        
        .stat-card {
            background: rgba(255,255,255,0.1);
            backdrop-filter: blur(10px);
        }
        
        .player-card {
            transition: all 0.2s;
        }
        
        .player-card:active {
            transform: scale(0.98);
        }
        
        .position-badge {
            font-size: 10px;
            padding: 2px 6px;
            border-radius: 4px;
            font-weight: 600;
        }
        
        .position-gk { background: #fbbf24; color: #92400e; }
        .position-df { background: #3b82f6; color: white; }
        .position-mf { background: #10b981; color: white; }
        .position-fw { background: #ef4444; color: white; }
        
        .rating-badge {
            background: linear-gradient(135deg, #10b981 0%, #059669 100%);
            color: white;
            font-weight: bold;
        }
        
        .tab-active {
            color: #10b981;
            border-bottom: 2px solid #10b981;
        }
        
        /* é˜Ÿå¾½æ ·å¼ - è‡ªé€‚åº”å¤§å° */
        .team-logo-container {
            display: flex;
            align-items: center;
            justify-content: center;
            overflow: hidden;
        }
        
        .team-logo-container img {
            max-width: 100%;
            max-height: 100%;
            object-fit: contain;
        }
        
        .team-logo-list {
            width: 64px;
            height: 64px;
            flex-shrink: 0;
        }
        
        .team-logo-detail {
            width: 80px;
            height: 80px;
            flex-shrink: 0;
        }
        
        .team-logo-small {
            width: 20px;
            height: 20px;
            flex-shrink: 0;
        }
        
        /* æ–°é—»ä¸­çš„çƒé˜Ÿæ ‡ç­¾ */
        .news-team-tag {
            display: inline-flex;
            align-items: center;
            gap: 4px;
            padding: 2px 8px;
            background: rgba(16, 185, 129, 0.1);
            border: 1px solid rgba(16, 185, 129, 0.3);
            border-radius: 12px;
            font-size: 11px;
            color: #10b981;
            cursor: pointer;
            transition: all 0.2s;
        }
        
        .news-team-tag:hover {
            background: rgba(16, 185, 129, 0.2);
        }
        
        .news-team-tag img {
            width: 16px;
            height: 16px;
            object-fit: contain;
        }
        
        /* èµ„é‡‘è­¦å‘Š */
        .financial-warning {
            background: linear-gradient(90deg, #fef2f2 0%, #fee2e2 100%);
            border-left: 4px solid #ef4444;
            color: #dc2626;
            padding: 10px 16px;
            font-size: 13px;
            font-weight: 500;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .dark .financial-warning {
            background: linear-gradient(90deg, #450a0a 0%, #7f1d1d 100%);
            color: #fca5a5;
        }
        
        /* æ–‡ç« è¯¦æƒ…é¡µåŠ¨ç”» - ä¿®å¤ç‰ˆ */
        .article-page {
            transform: translateX(100%);
            transition: transform 0.3s ease-out;
        }
        
        .article-page.show {
            transform: translateX(0);
        }

        /* å°è¯´é˜…è¯»å™¨æ ·å¼ */
        .reader-content {
            font-family: 'Noto Serif SC', 'PingFang SC', 'Microsoft YaHei', serif;
            line-height: 1.8;
            letter-spacing: 0.05em;
            word-spacing: 0;
            text-align: justify;
            text-indent: 2em;
        }
        
        .reader-content p {
            margin-bottom: 1em;
            text-indent: 2em;
        }
        
        .reader-bg-green { background-color: #c7edcc; color: #2d3748; }
        .reader-bg-yellow { background-color: #f5f0d8; color: #2d3748; }
        .reader-bg-gray { background-color: #e5e5e5; color: #2d3748; }
        .reader-bg-black { background-color: #1a1a1a; color: #d1d5db; }
        
        .reader-bg-black .reader-content {
            color: #d1d5db;
        }
        
        .reader-bg-black .reader-content p {
            color: #d1d5db;
        }
        
        .reader-bg-green .reader-content,
        .reader-bg-yellow .reader-content,
        .reader-bg-gray .reader-content {
            color: #2d3748;
        }
        
        /* ä¹¦æ¶æ ·å¼ */
        .bookshelf-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 16px;
            padding: 16px;
        }
        
        @media (min-width: 640px) {
            .bookshelf-grid {
                grid-template-columns: repeat(4, 1fr);
            }
        }
        
        .book-cover {
            aspect-ratio: 3/4;
            border-radius: 8px;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 16px;
            text-align: center;
            position: relative;
            overflow: hidden;
        }
        
        .book-cover::before {
            content: '';
            position: absolute;
            left: 0;
            top: 0;
            bottom: 0;
            width: 4px;
            background: rgba(255,255,255,0.3);
        }
        
        .book-title {
            font-weight: bold;
            font-size: 14px;
            line-height: 1.4;
            display: -webkit-box;
            -webkit-line-clamp: 3;
            -webkit-box-orient: vertical;
            overflow: hidden;
        }
        
        .book-author {
            font-size: 12px;
            opacity: 0.8;
            margin-top: 4px;
        }
        
        /* é˜…è¯»è®¾ç½®é¢æ¿ */
        .reader-settings {
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            background: rgba(255,255,255,0.95);
            backdrop-filter: blur(10px);
            border-top: 1px solid rgba(0,0,0,0.1);
            padding: 16px;
            transform: translateY(100%);
            transition: transform 0.3s ease;
            z-index: 60;
            max-height: 70vh;
            overflow-y: auto;
        }
        
        .reader-settings.show {
            transform: translateY(0);
        }
        
        .dark .reader-settings {
            background: rgba(30,30,30,0.95);
            border-top-color: rgba(255,255,255,0.1);
        }
        
        .setting-group {
            margin-bottom: 16px;
        }
        
        .setting-label {
            font-size: 12px;
            color: #6b7280;
            margin-bottom: 8px;
            display: block;
        }
        
        .dark .setting-label {
            color: #9ca3af;
        }
        
        .color-option {
            width: 48px;
            height: 48px;
            border-radius: 8px;
            border: 2px solid transparent;
            cursor: pointer;
            position: relative;
        }
        
        .color-option.active {
            border-color: #10b981;
        }
        
        .color-option.active::after {
            content: 'âœ“';
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            color: #10b981;
            font-weight: bold;
            font-size: 20px;
            text-shadow: 0 1px 2px rgba(255,255,255,0.8);
        }
        
        .range-slider {
            width: 100%;
            height: 6px;
            border-radius: 3px;
            background: #e5e7eb;
            outline: none;
            -webkit-appearance: none;
        }
        
        .dark .range-slider {
            background: #374151;
        }
        
        .range-slider::-webkit-slider-thumb {
            -webkit-appearance: none;
            appearance: none;
            width: 20px;
            height: 20px;
            border-radius: 50%;
            background: #10b981;
            cursor: pointer;
        }
        
        .range-slider::-moz-range-thumb {
            width: 20px;
            height: 20px;
            border-radius: 50%;
            background: #10b981;
            cursor: pointer;
            border: none;
        }
        
        /* é˜…è¯»è¿›åº¦æ¡ */
        .reading-progress {
            position: fixed;
            top: 0;
            left: 0;
            height: 2px;
            background: #10b981;
            z-index: 55;
            transition: width 0.1s;
        }
    </style>
</head>
<body class="bg-gray-50 dark:bg-dark-bg text-gray-900 dark:text-gray-100 transition-colors duration-300 pb-16">

    <!-- åˆ·æ–°æˆåŠŸæç¤º -->
    <div id="refreshToast" class="refresh-toast">
        <i class="fas fa-check-circle mr-1"></i> å·²æ›´æ–°
    </div>

    <!-- é¡¶éƒ¨çŠ¶æ€æ  -->
    <div class="sticky top-0 z-50 bg-white dark:bg-dark-surface border-b border-gray-200 dark:border-dark-border transition-colors duration-300" id="mainHeader">
        <!-- æ—¶é—´æ  -->
        <div class="flex justify-between items-center px-4 py-1 text-xs text-gray-500 dark:text-gray-400">
            <span id="clock">16:10</span>
            <div class="flex items-center gap-1">
                <span id="syncStatus" class="text-gray-400 dark:text-gray-500 text-[10px] mr-2">
                    ç­‰å¾…åˆ·æ–°
                </span>
                <span>5G</span>
                <i class="fas fa-signal"></i>
                <i class="fas fa-wifi"></i>
                <i class="fas fa-battery-full"></i>
            </div>
        </div>
        
        <!-- æœç´¢æ  -->
        <div class="px-4 py-2 flex items-center gap-3">
            <div class="w-8 h-8 rounded-full bg-gray-200 dark:bg-gray-700 flex items-center justify-center overflow-hidden">
                <img src="https://suttergov.github.io/åå‘¨å¹´çºªå¿µ.png" alt="avatar" class="w-full h-full object-cover">
            </div>
            <div class="flex-1 relative">
                <input type="text" placeholder="æœç´¢åŠ è¥¿äºšè¶³çƒAPP..." 
                       class="w-full bg-gray-100 dark:bg-dark-border text-sm px-4 py-2 rounded-full focus:outline-none focus:ring-2 focus:ring-emerald-500 dark:text-gray-200 transition-colors">
                <i class="fas fa-search absolute right-3 top-2.5 text-gray-400 text-sm"></i>
            </div>
            <button onclick="toggleTheme()" class="w-8 h-8 flex items-center justify-center text-gray-600 dark:text-gray-300">
                <i class="fas fa-moon dark:hidden"></i>
                <i class="fas fa-sun hidden dark:block text-yellow-400"></i>
            </button>
        </div>
        
        <!-- æ ‡ç­¾æ  - ä»…åœ¨é¦–é¡µæ˜¾ç¤º -->
        <div id="homeTabs" class="flex overflow-x-auto px-2 py-2 gap-6 text-sm font-medium border-t border-gray-100 dark:border-dark-border" style="scrollbar-width: none; -ms-overflow-style: none;">
            <button onclick="filterByTag('all')" class="tag-btn tag-active text-emerald-600 dark:text-emerald-400 whitespace-nowrap px-2" data-tag="all">å…¨éƒ¨</button>
            <button onclick="filterByTag('match')" class="tag-btn text-gray-600 dark:text-gray-400 whitespace-nowrap px-2" data-tag="match">æˆ˜æŠ¥</button>
            <button onclick="filterByTag('transfer')" class="tag-btn text-gray-600 dark:text-gray-400 whitespace-nowrap px-2" data-tag="transfer">è½¬ä¼š</button>
            <button onclick="filterByTag('official')" class="tag-btn text-gray-600 dark:text-gray-400 whitespace-nowrap px-2" data-tag="official">å…¬å‘Š</button>
            <button onclick="filterByTag('analysis')" class="tag-btn text-gray-600 dark:text-gray-400 whitespace-nowrap px-2" data-tag="analysis">åˆ†æ</button>
        </div>
    </div>

    <!-- ä¸‹æ‹‰åˆ·æ–°å®¹å™¨ -->
    <div id="refreshContainer" class="relative">
        <div id="pullIndicator" class="pull-refresh">
            <div id="pullSpinner" class="pull-refresh-spinner hidden"></div>
            <div id="pullText" class="text-gray-500 dark:text-gray-400 text-sm">
                <i class="fas fa-arrow-down mr-1"></i> ä¸‹æ‹‰åˆ·æ–°
            </div>
        </div>

        <!-- é¦–é¡µå†…å®¹ -->
        <main id="newsFeed" class="divide-y divide-gray-200 dark:divide-dark-border min-h-[60vh] scroll-container">
        </main>

        <!-- çƒé˜Ÿé¡µé¢ -->
        <div id="teamPage" class="hidden min-h-[60vh] scroll-container bg-gray-100 dark:bg-dark-bg">
            <!-- çƒé˜Ÿåˆ—è¡¨ -->
            <div id="teamList" class="p-4 grid grid-cols-1 gap-3">
                <!-- åŠ¨æ€åŠ è½½ -->
            </div>
        </div>

        <!-- å°è¯´é¡µé¢ - ä¹¦æ¶ -->
        <div id="novelPage" class="hidden min-h-[60vh] scroll-container bg-gray-100 dark:bg-dark-bg">
            <div class="p-4">
                <h2 class="text-lg font-bold mb-4 dark:text-gray-100">æˆ‘çš„ä¹¦æ¶</h2>
                <div id="bookshelf" class="bookshelf-grid">
                    <!-- åŠ¨æ€åŠ è½½ä¹¦ç± -->
                </div>
            </div>
        </div>

        <!-- å°è¯´é˜…è¯»é¡µé¢ -->
        <div id="readerPage" class="hidden fixed inset-0 z-[80] overflow-hidden">
            <!-- é˜…è¯»è¿›åº¦æ¡ -->
            <div id="readingProgress" class="reading-progress" style="width: 0%"></div>
            
            <!-- é¡¶éƒ¨å¯¼èˆª -->
            <div id="readerHeader" class="absolute top-0 left-0 right-0 bg-white/90 dark:bg-gray-900/90 backdrop-blur border-b border-gray-200 dark:border-gray-700 px-4 py-3 flex items-center justify-between z-50 transition-transform duration-300">
                <button onclick="backToBookshelf()" class="w-10 h-10 flex items-center justify-center text-gray-600 dark:text-gray-300">
                    <i class="fas fa-arrow-left"></i>
                </button>
                <span id="readerTitle" class="font-medium text-sm truncate max-w-[200px] dark:text-gray-100"></span>
                <button onclick="toggleReaderSettings()" class="w-10 h-10 flex items-center justify-center text-gray-600 dark:text-gray-300">
                    <i class="fas fa-cog"></i>
                </button>
            </div>
            
            <!-- é˜…è¯»å†…å®¹åŒº -->
            <div id="readerContentContainer" class="h-full overflow-y-auto pt-16 pb-20 scroll-container" onclick="toggleReaderUI()">
                <div id="readerContent" class="reader-content px-4 py-4 max-w-3xl mx-auto">
                    <!-- å°è¯´å†…å®¹ -->
                </div>
            </div>
            
            <!-- åº•éƒ¨ä¿¡æ¯æ  -->
            <div id="readerFooter" class="absolute bottom-0 left-0 right-0 bg-white/90 dark:bg-gray-900/90 backdrop-blur border-t border-gray-200 dark:border-gray-700 px-4 py-2 flex items-center justify-between text-xs text-gray-500 dark:text-gray-400 z-50 transition-transform duration-300">
                <span id="readerProgress">0%</span>
                <span id="readerTime">12:00</span>
            </div>
        </div>

        <!-- é˜…è¯»è®¾ç½®é¢æ¿ -->
        <div id="readerSettings" class="reader-settings">
            <div class="flex items-center justify-between mb-4">
                <h3 class="font-bold dark:text-gray-100">é˜…è¯»è®¾ç½®</h3>
                <button onclick="toggleReaderSettings()" class="w-8 h-8 flex items-center justify-center text-gray-500">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            
            <!-- èƒŒæ™¯é¢œè‰² -->
            <div class="setting-group">
                <label class="setting-label">èƒŒæ™¯é¢œè‰²</label>
                <div class="flex gap-3">
                    <div class="color-option reader-bg-green active" onclick="setReaderBg('green')" data-bg="green"></div>
                    <div class="color-option reader-bg-yellow" onclick="setReaderBg('yellow')" data-bg="yellow"></div>
                    <div class="color-option reader-bg-gray" onclick="setReaderBg('gray')" data-bg="gray"></div>
                    <div class="color-option reader-bg-black" onclick="setReaderBg('black')" data-bg="black"></div>
                </div>
            </div>
            
            <!-- å­—å· -->
            <div class="setting-group">
                <label class="setting-label">å­—å· <span id="fontSizeValue">18</span>px</label>
                <input type="range" min="12" max="32" value="18" class="range-slider" id="fontSizeSlider" oninput="updateReaderStyle()">
            </div>
            
            <!-- è¡Œè· -->
            <div class="setting-group">
                <label class="setting-label">è¡Œè· <span id="lineHeightValue">1.8</span></label>
                <input type="range" min="10" max="30" value="18" class="range-slider" id="lineHeightSlider" oninput="updateReaderStyle()">
            </div>
            
            <!-- å­—é—´è· -->
            <div class="setting-group">
                <label class="setting-label">å­—é—´è· <span id="letterSpacingValue">0.05</span>em</label>
                <input type="range" min="0" max="10" value="5" class="range-slider" id="letterSpacingSlider" oninput="updateReaderStyle()">
            </div>
            
            <!-- æ®µé—´è· -->
            <div class="setting-group">
                <label class="setting-label">æ®µé—´è· <span id="paraSpacingValue">1.0</span>em</label>
                <input type="range" min="0" max="20" value="10" class="range-slider" id="paraSpacingSlider" oninput="updateReaderStyle()">
            </div>
        </div>

        <!-- çƒé˜Ÿè¯¦æƒ…é¡µ -->
        <div id="teamDetailPage" class="hidden fixed inset-0 z-50 bg-gray-100 dark:bg-dark-bg scroll-container">
            <!-- çƒé˜Ÿè¯¦æƒ…å¤´éƒ¨ -->
            <div class="team-header text-white relative overflow-hidden">
                <div class="absolute inset-0 bg-gradient-to-b from-transparent to-black/50"></div>
                
                <!-- å¯¼èˆªæ  -->
                <div class="relative z-10 flex items-center justify-between px-4 py-3">
                    <button onclick="backToTeamList()" class="w-10 h-10 flex items-center justify-center rounded-full bg-white/20 backdrop-blur">
                        <i class="fas fa-arrow-left"></i>
                    </button>
                    <span class="font-medium">çƒé˜Ÿè¯¦æƒ…</span>
                    <button onclick="shareTeam()" class="w-10 h-10 flex items-center justify-center rounded-full bg-white/20 backdrop-blur">
                        <i class="fas fa-share-alt"></i>
                    </button>
                </div>
                
                <!-- çƒé˜Ÿä¿¡æ¯ -->
                <div class="relative z-10 px-4 pb-6 pt-2">
                    <div class="flex items-center gap-4">
                        <div class="team-logo-container team-logo-detail bg-white/10 rounded-lg p-2">
                            <img id="teamDetailLogo" src="" alt="" class="team-logo-large">
                        </div>
                        <div class="flex-1">
                            <h1 id="teamDetailName" class="text-2xl font-bold mb-1"></h1>
                            <p id="teamDetailNameEn" class="text-sm opacity-80 mb-2"></p>
                            <div class="flex items-center gap-2 text-xs flex-wrap">
                                <span class="bg-white/20 px-2 py-1 rounded">åŠ è¶…è”</span>
                                <span id="teamDetailCoach" class="bg-white/20 px-2 py-1 rounded"></span>
                            </div>
                        </div>
                    </div>
                    
                    <!-- æ•°æ®ç»Ÿè®¡ -->
                    <div class="grid grid-cols-3 gap-2 mt-4">
                        <div class="stat-card rounded-lg p-3 text-center">
                            <div class="text-xs opacity-80">çƒé˜Ÿèµ„é‡‘</div>
                            <div class="text-lg font-bold" id="teamDetailFunds"></div>
                        </div>
                        <div class="stat-card rounded-lg p-3 text-center">
                            <div class="text-xs opacity-80">åœºå‡ä¸Šåº§</div>
                            <div class="text-lg font-bold" id="teamDetailAttendance"></div>
                        </div>
                        <div class="stat-card rounded-lg p-3 text-center">
                            <div class="text-xs opacity-80">ä¸Šåº§ç‡</div>
                            <div class="text-lg font-bold" id="teamDetailOccupancy"></div>
                        </div>
                        <div class="stat-card rounded-lg p-3 text-center">
                            <div class="text-xs opacity-80">çƒåœºå®¹é‡</div>
                            <div class="text-lg font-bold" id="teamDetailCapacity"></div>
                        </div>
                        <div class="stat-card rounded-lg p-3 text-center">
                            <div class="text-xs opacity-80">çƒé˜Ÿæ€»å¹´è–ª</div>
                            <div class="text-lg font-bold" id="teamDetailWages"></div>
                        </div>
                        <div class="stat-card rounded-lg p-3 text-center">
                            <div class="text-xs opacity-80">é¢„è®¡å­£æœ«èµ„é‡‘</div>
                            <div class="text-lg font-bold" id="teamDetailProjected"></div>
                        </div>
                    </div>
                    
                    <!-- èµ„é‡‘è­¦å‘Š -->
                    <div id="financialWarning" class="hidden mt-3 rounded-lg financial-warning">
                        <i class="fas fa-exclamation-triangle"></i>
                        <span>çƒé˜Ÿèµ„é‡‘æƒ…å†µå±é™©ï¼Œå¯èƒ½æ— æ³•é€šè¿‡å‡†å…¥</span>
                    </div>
                </div>
            </div>
            
            <!-- æ ‡ç­¾é¡µ -->
            <div class="bg-white dark:bg-dark-surface border-b border-gray-200 dark:border-dark-border sticky top-0 z-40">
                <div class="flex">
                    <button onclick="switchTeamTab('squad')" class="team-tab flex-1 py-3 text-sm font-medium text-center tab-active" data-tab="squad">é˜µå®¹</button>
                    <button onclick="switchTeamTab('stats')" class="team-tab flex-1 py-3 text-sm font-medium text-center text-gray-500 dark:text-gray-400" data-tab="stats">æ•°æ®</button>
                    <button onclick="switchTeamTab('schedule')" class="team-tab flex-1 py-3 text-sm font-medium text-center text-gray-500 dark:text-gray-400" data-tab="schedule">èµ›ç¨‹</button>
                    <button onclick="switchTeamTab('news')" class="team-tab flex-1 py-3 text-sm font-medium text-center text-gray-500 dark:text-gray-400" data-tab="news">åŠ¨æ€</button>
                </div>
            </div>
            
            <!-- é˜µå®¹å†…å®¹ -->
            <div id="squadContent" class="p-4">
                <!-- ä¸»æ•™ç»ƒ - å¯ç‚¹å‡»è¿›å…¥æ•™ç»ƒè¯¦æƒ… -->
                <div class="mb-4">
                    <h3 class="text-sm font-bold text-gray-500 dark:text-gray-400 mb-2 uppercase tracking-wider">ä¸»æ•™ç»ƒ</h3>
                    <div onclick="openCoachDetail()" class="bg-white dark:bg-dark-surface rounded-lg p-4 flex items-center justify-between shadow-sm cursor-pointer active:scale-95 transition-transform">
                        <div id="coachCard" class="flex-1">
                        </div>
                        <i class="fas fa-chevron-right text-gray-400 dark:text-gray-500 ml-2"></i>
                    </div>
                </div>
                
                <!-- çƒå‘˜åˆ—è¡¨ -->
                <div id="playersList">
                    <!-- æŒ‰ä½ç½®åˆ†ç»„æ˜¾ç¤º -->
                </div>
            </div>
            
            <!-- å…¶ä»–æ ‡ç­¾å†…å®¹ï¼ˆå ä½ï¼‰ -->
            <div id="statsContent" class="hidden p-4">
                <div class="bg-white dark:bg-dark-surface rounded-lg p-8 text-center text-gray-400">
                    <i class="fas fa-chart-bar text-4xl mb-2"></i>
                    <p>æ•°æ®ç»Ÿè®¡åŠŸèƒ½å¼€å‘ä¸­</p>
                </div>
            </div>
            
            <div id="scheduleContent" class="hidden p-4">
                <div class="bg-white dark:bg-dark-surface rounded-lg p-8 text-center text-gray-400">
                    <i class="fas fa-calendar-alt text-4xl mb-2"></i>
                    <p>èµ›ç¨‹åŠŸèƒ½å¼€å‘ä¸­</p>
                </div>
            </div>
            
            <div id="newsContent" class="hidden p-4">
                <div id="teamNewsList" class="space-y-3">
                    <!-- çƒé˜Ÿç›¸å…³æ–°é—»åŠ¨æ€åŠ è½½ -->
                </div>
            </div>
        </div>

        <!-- æ•™ç»ƒè¯¦æƒ…é¡µ -->
        <div id="coachDetailPage" class="hidden fixed inset-0 z-[60] bg-gray-100 dark:bg-dark-bg scroll-container">
            <div class="bg-white dark:bg-dark-surface border-b border-gray-200 dark:border-dark-border px-4 py-3 flex items-center sticky top-0 z-50">
                <button onclick="backToTeamDetailFromCoach()" class="w-10 h-10 flex items-center justify-center -ml-2">
                    <i class="fas fa-arrow-left text-gray-600 dark:text-gray-300"></i>
                </button>
                <span class="font-medium ml-2 dark:text-gray-100">æ•™ç»ƒå›¢é˜Ÿ</span>
            </div>
            <div id="coachList" class="p-4 space-y-3">
            </div>
        </div>

        <!-- çƒå‘˜è¯¦æƒ…é¡µ -->
        <div id="playerDetailPage" class="hidden fixed inset-0 z-[70] bg-gray-100 dark:bg-dark-bg scroll-container">
            <!-- çƒå‘˜å¤´éƒ¨ -->
            <div class="relative bg-gradient-to-br from-emerald-600 to-emerald-800 text-white">
                <div class="flex items-center justify-between px-4 py-3">
                    <button onclick="backToTeamDetail()" class="w-10 h-10 flex items-center justify-center rounded-full bg-white/20 backdrop-blur">
                        <i class="fas fa-arrow-left"></i>
                    </button>
                    <span class="font-medium">çƒå‘˜è¯¦æƒ…</span>
                    <button onclick="sharePlayer()" class="w-10 h-10 flex items-center justify-center rounded-full bg-white/20 backdrop-blur">
                        <i class="fas fa-share-alt"></i>
                    </button>
                </div>
                
                <div class="px-4 pb-6 flex items-end gap-4">
                    <div class="w-24 h-24 rounded-lg bg-white/20 flex items-center justify-center text-4xl font-bold">
                        <span id="playerInitial"></span>
                    </div>
                    <div class="flex-1 pb-1">
                        <div class="flex items-center gap-2 mb-1">
                            <span id="playerDetailPosition" class="position-badge"></span>
                        </div>
                        <h1 id="playerDetailName" class="text-2xl font-bold mb-1"></h1>
                        <p id="playerDetailTeam" class="text-sm opacity-80"></p>
                    </div>
                </div>
            </div>
            
            <!-- çƒå‘˜æ•°æ® -->
            <div class="p-4 space-y-4">
                <!-- èƒ½åŠ›å€¼ -->
                <div class="bg-white dark:bg-dark-surface rounded-lg p-4 shadow-sm">
                    <h3 class="font-bold mb-3 dark:text-gray-200">èƒ½åŠ›è¯„ä¼°</h3>
                    <div class="flex items-center justify-center mb-4">
                        <div class="w-24 h-24 rounded-full rating-badge flex items-center justify-center text-3xl" id="playerDetailRating">
                        </div>
                    </div>
                    <div class="grid grid-cols-2 gap-3 text-sm">
                        <div class="flex justify-between py-2 border-b border-gray-100 dark:border-dark-border">
                            <span class="text-gray-500">å½“å‰èƒ½åŠ›(CA)</span>
                            <span class="font-bold" id="playerDetailCA"></span>
                        </div>
                        <div class="flex justify-between py-2 border-b border-gray-100 dark:border-dark-border">
                            <span class="text-gray-500">æ½œåŠ›(PA)</span>
                            <span class="font-bold text-emerald-600" id="playerDetailPA"></span>
                        </div>
                        <div class="flex justify-between py-2 border-b border-gray-100 dark:border-dark-border">
                            <span class="text-gray-500">å¹´é¾„</span>
                            <span class="font-bold" id="playerDetailAge"></span>
                        </div>
                        <div class="flex justify-between py-2 border-b border-gray-100 dark:border-dark-border">
                            <span class="text-gray-500">å›½ç±</span>
                            <span class="font-bold" id="playerDetailNation"></span>
                        </div>
                        <div class="flex justify-between py-2 border-b border-gray-100 dark:border-dark-border">
                            <span class="text-gray-500">èº«é«˜</span>
                            <span class="font-bold" id="playerDetailHeight"></span>
                        </div>
                        <div class="flex justify-between py-2 border-b border-gray-100 dark:border-dark-border">
                            <span class="text-gray-500">ä½“é‡</span>
                            <span class="font-bold" id="playerDetailWeight"></span>
                        </div>
                    </div>
                </div>
                
                <!-- ä½ç½®ä¿¡æ¯ -->
                <div class="bg-white dark:bg-dark-surface rounded-lg p-4 shadow-sm">
                    <h3 class="font-bold mb-3 dark:text-gray-200">å¯æ‰“ä½ç½®</h3>
                    <div id="playerAllPositions" class="flex flex-wrap gap-2">
                    </div>
                </div>
                
                <!-- åˆåŒä¿¡æ¯ -->
                <div class="bg-white dark:bg-dark-surface rounded-lg p-4 shadow-sm">
                    <h3 class="font-bold mb-3 dark:text-gray-200">åˆåŒä¿¡æ¯</h3>
                    <div class="space-y-2 text-sm">
                        <div class="flex justify-between py-2 border-b border-gray-100 dark:border-dark-border">
                            <span class="text-gray-500">æ‰€åœ¨çƒé˜Ÿ</span>
                            <span class="font-bold" id="playerDetailTeam2"></span>
                        </div>
                        <div class="flex justify-between py-2 border-b border-gray-100 dark:border-dark-border">
                            <span class="text-gray-500">åˆçº¦åˆ°æœŸ</span>
                            <span class="font-bold" id="playerDetailContract"></span>
                        </div>
                        <div class="flex justify-between py-2 border-b border-gray-100 dark:border-dark-border">
                            <span class="text-gray-500">å¹´è–ª</span>
                            <span class="font-bold text-emerald-600" id="playerDetailWage"></span>
                        </div>
                        <div class="flex justify-between py-2">
                            <span class="text-gray-500">è¿çº¦é‡‘</span>
                            <span class="font-bold text-red-500" id="playerDetailClause"></span>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- æ–‡ç« è¯¦æƒ…é¡µ - ä¿®å¤ç‰ˆ -->
    <div id="articlePage" class="article-page fixed inset-0 z-50 bg-white dark:bg-dark-bg scroll-container">
        <div class="sticky top-0 bg-white/95 dark:bg-dark-surface/95 backdrop-blur border-b border-gray-200 dark:border-dark-border px-4 py-2 flex items-center justify-between">
            <button onclick="closeArticle()" class="w-8 h-8 flex items-center justify-center text-gray-600 dark:text-gray-300">
                <i class="fas fa-arrow-left text-lg"></i>
            </button>
            <span class="font-medium text-sm dark:text-gray-200">åŠ è¥¿äºšè¶³çƒAPP</span>
            <button onclick="shareArticle()" class="w-8 h-8 flex items-center justify-center text-gray-600 dark:text-gray-300">
                <i class="fas fa-share-alt"></i>
            </button>
        </div>
        
        <article id="articleContent" class="p-4">
        </article>
    </div>

    <!-- åº•éƒ¨å¯¼èˆª -->
    <nav class="fixed bottom-0 left-0 right-0 bg-white dark:bg-dark-surface border-t border-gray-200 dark:border-dark-border px-6 py-2 flex justify-between items-center z-40 transition-colors duration-300">
        <button onclick="switchTab('home')" class="bottom-nav-item active flex flex-col items-center gap-1 text-emerald-600 dark:text-emerald-400" data-tab="home">
            <i class="fas fa-home text-xl"></i>
            <span class="text-xs">é¦–é¡µ</span>
        </button>
        <button onclick="switchTab('match')" class="bottom-nav-item flex flex-col items-center gap-1 text-gray-400 dark:text-gray-500" data-tab="match">
            <i class="fas fa-trophy text-xl"></i>
            <span class="text-xs">æ¯”èµ›</span>
        </button>
        <button onclick="switchTab('team')" class="bottom-nav-item flex flex-col items-center gap-1 text-gray-400 dark:text-gray-500" data-tab="team">
            <i class="fas fa-shield-alt text-xl"></i>
            <span class="text-xs">çƒé˜Ÿ</span>
        </button>
        <button onclick="switchTab('video')" class="bottom-nav-item flex flex-col items-center gap-1 text-gray-400 dark:text-gray-500" data-tab="video">
            <i class="fas fa-play-circle text-xl"></i>
            <span class="text-xs">è§†é¢‘</span>
        </button>
        <button onclick="switchTab('novel')" class="bottom-nav-item flex flex-col items-center gap-1 text-gray-400 dark:text-gray-500" data-tab="novel">
            <i class="fas fa-book text-xl"></i>
            <span class="text-xs">å°è¯´</span>
        </button>
    </nav>

    <script>
        const CONFIG = {
            owner: 'SutterGov',
            repo: 'SutterGov.github.io',
            branch: 'main',
            rssPath: 'garciafootball.xml',
            excelUrl: 'https://suttergov.github.io/GarciaDatabase26.xlsx',
            bookSourceUrl: 'https://SutterGov.github.io/ä¹¦æº.txt'
        };

        // çƒé˜Ÿé˜Ÿå¾½æ˜ å°„è¡¨ - æ›´æ–°ç‰ˆ
        const TEAM_LOGOS = {
            'å—å¤ªå¹³æ´‹å¤§å­¦è‰²æ¸©æ ¡åŒº': 'https://suttergov.github.io/å—å¤ªå¤§æ–°æ³°.png',
            'ä¸‰å®æ•¦': 'https://suttergov.github.io/ä¸‰å®æ•¦.png',
            'ä¸œå¹³é›„é¹°': 'https://suttergov.github.io/ä¸œå¹³é›„é¹°.png',
            'ä¼Šä¸½èç™½å¥³ç‹é•‡è”åˆ': 'https://suttergov.github.io/ä¼Šä¸½èç™½è”åˆ.png',
            'æ³°å…‹é©¬è”åˆ': 'https://suttergov.github.io/ä¼Šæ–¯ç‰¹ä¼å¾·è”åˆæ–°2.png',
            'é¦–éƒ½å®ˆæŠ¤è€…': 'https://suttergov.github.io/å“ˆå¡æ‹‰æ‰˜ç‰¹å¡11.png',
            'å“ˆè´¾ä¸¹å¤ªå¹³æ´‹äºº': 'https://suttergov.github.io/å“ˆè´¾ä¸¹å¤ªå¹³æ´‹äºº.png',
            'åå¸ƒå°”æ–°å•ä¼ç™»': 'https://suttergov.github.io/åå¸ƒå°”æ–°å•ä¼ç™».png',
            'å¤§åŒæ‹œä»çš‡å®¶åŠ è¥¿äºš': 'https://suttergov.github.io/å¤§åŒæ‹œä»çš‡å®¶åŠ è¥¿äºš.png',
            'å¥¥é¡¿å…°æµ·æ¸¯': 'https://suttergov.github.io/å¥¥é¡¿å…°æ–¯å·´è¾¾å…‹æ–¯.png',
            'å¥¥é¡¿å…°æµ·é¸¥': 'https://suttergov.github.io/å¥¥é¡¿å…°æµ·æ¸¯.png',
            'ä¸œæœ¨å¸‚èŒä¸š': 'https://suttergov.github.io/å­”æ©åº¦å¢FC.png',
            'å®‰å€è¨é•‡': 'https://suttergov.github.io/å®‰å€è¨åŸ.png',
            'æ‹‰é˜¿çº³': 'https://suttergov.github.io/æ‹‰é˜¿çº³åŸå¸‚ç«æŠ€.png',
            'æ–¯æ³¢æ‰˜æ™®åŸå¸‚': 'https://suttergov.github.io/æ–¯æ³¢æ‰˜æ™®åŸå¸‚.png',
            'æ–°å•ä¼ç™»çŒ«å¤´é¹°é•‡': 'https://suttergov.github.io/æ–°å•ä¼ç™»çŒ«å¤´é¹°.png',
            'æ–°å—åŸ': 'https://suttergov.github.io/æ–°æ³°æ–°3.png',
            'æ–°è¾¾åå“ˆæµ·å²¸': 'https://suttergov.github.io/æ–°è¾¾åå“ˆæµ·å²¸.png',
            'æ³°å…‹é©¬èŒä¸š': 'https://suttergov.github.io/æ³°å…‹é©¬èŒä¸š.png',
            'æ³°å…‹é©¬é˜Ÿ': 'https://suttergov.github.io/æ³°å…‹é©¬é˜Ÿ.png',
            'ç“¦å·´è¨æœ±æ ‘é¸¦': 'https://suttergov.github.io/ç“¦å·´è¨æœ±æ ‘é¸¦.png',
            'ç“¦å·´è¨æœ±æ ‘é¸¦B': 'https://suttergov.github.io/ç“¦å·´è¨æœ±æ ‘é¸¦.png',
            'æ–°æ³°æ³°å±±': 'https://suttergov.github.io/ç“¦å·´è¨æœ±è‰¾å¥¥çº³å°”.png',
            'çš‡å®¶è¨ä¹Œè¨ä¹Œ': 'https://suttergov.github.io/çš‡å®¶è¨ä¹Œè¨ä¹Œ.png',
            'ç©†æ‹‰å“ˆè¥¿éƒ¨': 'https://suttergov.github.io/ç©†æ‹‰å“ˆè¥¿éƒ¨.png',
            'ä¸‰å®æ•¦ä¹é‚¦æˆ˜å£«': 'https://suttergov.github.io/ç»´å°”å›¾é’¢ç®¡.png',
            'è‰²æ¸©å²±å·ä¸œå²³': 'https://suttergov.github.io/è‰²æ¸©å²±å·ä¸œå²³.png',
            'å·´å³°': 'https://suttergov.github.io/è¨ä¹Œè¨ä¹Œæ–°.png',
            'è¯ºç»´å¥‡æ¸¯': 'https://suttergov.github.io/è¯ºç»´å¥‡æ¸¯æ–°.png',
            'åŒ—æ³°å…‹é©¬': 'https://suttergov.github.io/é‡Œæ‹‰èµ«é£ç‡•.png',
            'é˜¿å°”ç‰¹å¼—é›·å¥‡æµæµªè€…': 'https://suttergov.github.io/é˜¿å°”ç‰¹å¼—é›·å¥‡æµæµªè€….png',
            'é©¬é›·å…‹é’æ˜¥ä¹‹åŸ': 'https://suttergov.github.io/é©¬é›·å…‹æ–°.png',
            'å“ˆå…‹ç«æŠ€': 'https://suttergov.github.io/å“ˆå¡æ‹‰æ‰˜ç‰¹å¡.png',
            'æ¯”åˆ—ç«æŠ€': 'https://suttergov.github.io/æ¯”åˆ—ç«æŠ€æ–°.png',
            'æœ±é©¬è“è‰²åè¿›': 'https://suttergov.github.io/æœ±é©¬è“è‰²åè¿›.png',
            'ä¼Šæ–¯ç‰¹ä¼å¾·ç«æŠ€': 'https://suttergov.github.io/ä¼Šæ–¯ç‰¹ä¼å¾·ä¿±ä¹éƒ¨.png',
            'æ¯”æ–¯æ°æå«è€…': 'https://suttergov.github.io/æ¯”æ–¯æ°æå«è€….png',
            'æ–°åˆ©é›…å¾—èƒœåˆ©': 'https://suttergov.github.io/æ™®æ‹‰å¸‚æ°‘.png',
            'å—æ¯”æ–¯æ°åŸå¸‚': 'https://suttergov.github.io/å—æ¯”æ–¯æ°åŸå¸‚.png',
            // æ–°å¢é˜Ÿå¾½
            'æ–°åˆ©é›…å¾—æ–°æœˆ': 'https://fclogo.top/_next/image?url=https%3A%2F%2Fcdn.sanity.io%2Fimages%2F11hmdf08%2Fproduction%2F8b173e002d366de185a0b51b67e71d230f63b72e-800x800.png%3Fw%3D800%26fm%3Dwebp%26q%3D80&w=828&q=75',
            'é¦–éƒ½-ä¸œæœ¨è”åˆB': 'https://suttergov.github.io/å“ˆå¡æ‹‰æ‰˜ç‰¹å¡11.png',
            'å“ˆå¡æ‹‰æ‰˜ç‰¹å¡æµ·ç‰›': 'https://fclogo.top/_next/image?url=https%3A%2F%2Fcdn.sanity.io%2Fimages%2F11hmdf08%2Fproduction%2F2d2c10be4e5d9a91aada5021b9b551ebd88f3bdc-800x800.png%3Fw%3D800%26fm%3Dwebp%26q%3D80&w=828&q=75',
            'ä¼Šæ–¯ç‰¹ä¼å¾·æµ·å²¸çº¿': 'https://suttergov.github.io/è¿åŠ¨ä¼Šæ–¯ç‰¹ä¼å¾·.png',
            'æ–°æ³•é²å¤§é‡Œæ–¯æœ¬è”ç›Ÿ': 'https://suttergov.github.io/æ–°æ³•é²æ–°.png',
            'åŒ—æ³°å…‹é©¬é˜Ÿ': 'https://suttergov.github.io/é‡Œæ‹‰èµ«é£ç‡•.png',
            'å²±å·ä¸œå²³': 'https://suttergov.github.io/è‰²æ¸©å²±å·ä¸œå²³.png'
        };

        // é»˜è®¤é˜Ÿå¾½
        const DEFAULT_LOGO = 'https://duihui.duoduocdn.com/zuqiu/zuqiuzhudui1.png';

        let currentTag = 'all';
        let currentTab = 'home';
        let rssData = [];
        let teamData = [];
        let playersData = [];
        let currentTeam = null;
        let currentCoaches = [];
        let isRefreshing = false;
        let touchStartY = 0;
        let touchCurrentY = 0;
        let isPulling = false;
        const PULL_THRESHOLD = 80;

        // å°è¯´ç›¸å…³å˜é‡
        let books = [];
        let currentBook = null;
        let currentChapter = 0;
        let readerSettings = {
            bg: 'green',
            fontSize: 18,
            lineHeight: 1.8,
            letterSpacing: 0.05,
            paraSpacing: 1.0
        };

        document.addEventListener('DOMContentLoaded', () => {
            const cached = localStorage.getItem('rss_cache');
            if (cached) {
                try {
                    const { data } = JSON.parse(cached);
                    rssData = data;
                    renderNews();
                    updateSyncStatus('cached');
                } catch (e) {
                    showEmptyState();
                }
            } else {
                showEmptyState();
            }
            
            updateClock();
            setInterval(updateClock, 1000);
            
            if (window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches) {
                document.documentElement.classList.add('dark');
            }
            
            initPullToRefresh();
            
            // åŠ è½½é˜…è¯»è®¾ç½®
            const savedSettings = localStorage.getItem('reader_settings');
            if (savedSettings) {
                readerSettings = JSON.parse(savedSettings);
                applyReaderSettings();
            }
        });

        function showEmptyState() {
            document.getElementById('newsFeed').innerHTML = `
                <div class="p-8 text-center text-gray-400 dark:text-gray-500 mt-10">
                    <div class="text-4xl mb-3">ğŸ“¡</div>
                    <p class="mb-2">æš‚æ— æ•°æ®</p>
                    <p class="text-xs mb-4">ä¸‹æ‹‰åˆ·æ–°æˆ–ç‚¹å‡»é¦–é¡µæŒ‰é’®è·å–æœ€æ–°å†…å®¹</p>
                    <button onclick="loadRSS()" class="px-6 py-2 bg-emerald-600 text-white rounded-lg text-sm hover:bg-emerald-700 transition">
                        ç«‹å³åˆ·æ–°
                    </button>
                </div>
            `;
        }

        function updateClock() {
            const now = new Date();
            const hours = String(now.getHours()).padStart(2, '0');
            const minutes = String(now.getMinutes()).padStart(2, '0');
            document.getElementById('clock').textContent = `${hours}:${minutes}`;
            
            // æ›´æ–°é˜…è¯»å™¨æ—¶é—´
            const readerTime = document.getElementById('readerTime');
            if (readerTime) {
                readerTime.textContent = `${hours}:${minutes}`;
            }
        }

        function toggleTheme() {
            document.documentElement.classList.toggle('dark');
        }

        function initPullToRefresh() {
            const container = document.getElementById('refreshContainer');
            const indicator = document.getElementById('pullIndicator');
            const spinner = document.getElementById('pullSpinner');
            const text = document.getElementById('pullText');
            
            container.addEventListener('touchstart', (e) => {
                if (window.scrollY === 0 && !isRefreshing && currentTab === 'home') {
                    touchStartY = e.touches[0].clientY;
                    isPulling = true;
                }
            }, { passive: true });
            
            container.addEventListener('touchmove', (e) => {
                if (!isPulling || isRefreshing || currentTab !== 'home') return;
                
                touchCurrentY = e.touches[0].clientY;
                const diff = touchCurrentY - touchStartY;
                
                if (diff > 0) {
                    e.preventDefault();
                    const pullDistance = Math.min(diff * 0.5, 120);
                    indicator.style.transform = `translateY(${pullDistance}px)`;
                    
                    if (pullDistance > PULL_THRESHOLD) {
                        text.innerHTML = '<i class="fas fa-arrow-up mr-1"></i> é‡Šæ”¾åˆ·æ–°';
                        indicator.classList.add('ready');
                    } else {
                        text.innerHTML = '<i class="fas fa-arrow-down mr-1"></i> ä¸‹æ‹‰åˆ·æ–°';
                        indicator.classList.remove('ready');
                    }
                }
            }, { passive: false });
            
            container.addEventListener('touchend', () => {
                if (!isPulling || isRefreshing) return;
                
                const diff = touchCurrentY - touchStartY;
                
                if (diff > PULL_THRESHOLD && !isRefreshing) {
                    startRefresh();
                } else {
                    resetPullIndicator();
                }
                
                isPulling = false;
                touchStartY = 0;
                touchCurrentY = 0;
            });
        }

        function startRefresh() {
            isRefreshing = true;
            const indicator = document.getElementById('pullIndicator');
            const spinner = document.getElementById('pullSpinner');
            const text = document.getElementById('pullText');
            
            spinner.classList.remove('hidden');
            text.innerHTML = '<span class="ml-2">åˆ·æ–°ä¸­...</span>';
            indicator.style.transform = `translateY(60px)`;
            
            loadRSS().then(() => {
                showRefreshToast();
            }).finally(() => {
                setTimeout(() => {
                    resetPullIndicator();
                    isRefreshing = false;
                }, 500);
            });
        }

        function resetPullIndicator() {
            const indicator = document.getElementById('pullIndicator');
            const spinner = document.getElementById('pullSpinner');
            const text = document.getElementById('pullText');
            
            indicator.style.transition = 'transform 0.3s';
            indicator.style.transform = 'translateY(0)';
            spinner.classList.add('hidden');
            text.innerHTML = '<i class="fas fa-arrow-down mr-1"></i> ä¸‹æ‹‰åˆ·æ–°';
            
            setTimeout(() => {
                indicator.style.transition = '';
            }, 300);
        }

        function showRefreshToast() {
            const toast = document.getElementById('refreshToast');
            toast.classList.add('show');
            setTimeout(() => {
                toast.classList.remove('show');
            }, 2000);
        }

        async function loadRSS() {
            updateSyncStatus('syncing');
            
            try {
                const githubUrl = `https://raw.githubusercontent.com/${CONFIG.owner}/${CONFIG.repo}/${CONFIG.branch}/${CONFIG.rssPath}?t=${new Date().getTime()}`;
                
                let response = await fetch(githubUrl, {
                    method: 'GET',
                    headers: { 'Accept': 'application/xml, text/xml, */*' },
                    signal: AbortSignal.timeout(10000)
                });

                if (!response.ok) {
                    const proxyUrl = 'https://api.allorigins.win/raw?url=' + encodeURIComponent('https://sutterfootball.freeflarum.com/rss/t/garciafootball');
                    response = await fetch(proxyUrl, { signal: AbortSignal.timeout(10000) });
                }

                if (!response.ok) throw new Error(`HTTP ${response.status}`);

                const xmlText = await response.text();
                if (!xmlText.includes('<?xml') && !xmlText.includes('<rss')) {
                    throw new Error('è¿”å›å†…å®¹ä¸æ˜¯æœ‰æ•ˆçš„ RSS');
                }

                const items = parseRSS(xmlText);
                if (items.length === 0) throw new Error('RSS è§£æç»“æœä¸ºç©º');

                rssData = items;
                renderNews();
                updateSyncStatus('success', items.length);
                
                localStorage.setItem('rss_cache', JSON.stringify({
                    data: items,
                    time: new Date().toISOString()
                }));

            } catch (error) {
                console.error('RSS åŠ è½½å¤±è´¥:', error);
                const cached = localStorage.getItem('rss_cache');
                if (cached) {
                    try {
                        const { data, time } = JSON.parse(cached);
                        rssData = data;
                        renderNews();
                        updateSyncStatus('cached', data.length, time);
                    } catch (e) {
                        showError('åŠ è½½å¤±è´¥ï¼Œä¸”æ— ç¼“å­˜æ•°æ®å¯ç”¨');
                    }
                } else {
                    showError('åŠ è½½å¤±è´¥: ' + error.message);
                }
            }
        }

        function parseRSS(xmlText) {
            const parser = new DOMParser();
            const xml = parser.parseFromString(xmlText, 'text/xml');
            const parseError = xml.querySelector('parsererror');
            if (parseError) throw new Error('XML è§£æé”™è¯¯');

            const items = xml.querySelectorAll('item');
            
            return Array.from(items).map((item, index) => {
                let title = item.querySelector('title')?.textContent || 'æ— æ ‡é¢˜';
                title = title.replace(/<!\[CDATA\[(.*?)\]\]>/s, '$1').trim();
                
                const link = item.querySelector('link')?.textContent || '';
                
                let description = item.querySelector('description')?.textContent || '';
                description = description.replace(/<!\[CDATA\[(.*?)\]\]>/s, '$1').trim();
                
                let content = item.querySelector('content\\:encoded')?.textContent || 
                             item.querySelector('encoded')?.textContent || 
                             description;
                content = content.replace(/<!\[CDATA\[(.*?)\]\]>/s, '$1').trim();
                
                const pubDate = item.querySelector('pubDate')?.textContent || 
                               item.querySelector('dc\\:date')?.textContent || 
                               new Date().toISOString();
                
                const author = item.querySelector('author')?.textContent || 
                              item.querySelector('dc\\:creator')?.textContent || 
                              item.querySelector('creator')?.textContent || 
                              'åŠ è¥¿äºšè¶³çƒAPP';
                
                const categories = Array.from(item.querySelectorAll('category')).map(c => c.textContent);
                const category = categories[0] || detectCategory(title);
                
                const id = item.querySelector('guid')?.textContent || 
                          item.querySelector('link')?.textContent || 
                          index;
                
                const imgMatch = content.match(/<img[^>]+src=["']([^"']+)["']/i);
                const image = imgMatch ? imgMatch[1] : getDefaultImage(category, index);
                
                return { id, title, link, description: stripHtml(description).substring(0, 200) + '...', content, pubDate, author, category, image, comments: Math.floor(Math.random() * 100), views: Math.floor(Math.random() * 1000) + 100 };
            });
        }

        function detectCategory(title) {
            const lower = title.toLowerCase();
            if (lower.includes('æˆ˜æŠ¥') || lower.includes('vs') || lower.includes('-') || lower.includes('æ¯”èµ›')) return 'match';
            if (lower.includes('è½¬ä¼š') || lower.includes('ç­¾çº¦') || lower.includes('ç»­çº¦') || lower.includes('åŠ ç›Ÿ')) return 'transfer';
            if (lower.includes('å…¬å‘Š') || lower.includes('å®˜æ–¹') || lower.includes('é€šçŸ¥')) return 'official';
            if (lower.includes('åˆ†æ') || lower.includes('æˆ˜æœ¯') || lower.includes('æ•°æ®')) return 'analysis';
            return 'news';
        }

        function getDefaultImage(category, seed) {
            const images = {
                match: 'https://images.unsplash.com/photo-1574629810360-7efbbe195018?w=400&h=300&fit=crop',
                transfer: 'https://images.unsplash.com/photo-1522778119026-d647f0565c6a?w=400&h=300&fit=crop',
                official: 'https://images.unsplash.com/photo-1556056504-5c7696c4c28d?w=400&h=300&fit=crop',
                analysis: 'https://images.unsplash.com/photo-1517927033932-b3d18e61fb3a?w=400&h=300&fit=crop',
                news: 'https://images.unsplash.com/photo-1489944440615-453fc2b6a9a9?w=400&h=300&fit=crop'
            };
            return images[category] || images.news;
        }

        function updateSyncStatus(status, count, cacheTime) {
            const el = document.getElementById('syncStatus');
            const now = new Date();
            const timeStr = `${String(now.getHours()).padStart(2,'0')}:${String(now.getMinutes()).padStart(2,'0')}`;
            
            switch(status) {
                case 'syncing':
                    el.innerHTML = '<i class="fas fa-sync-alt animate-spin mr-1"></i>æ›´æ–°ä¸­';
                    el.className = 'text-emerald-600 dark:text-emerald-400 text-[10px] mr-2';
                    break;
                case 'success':
                    el.innerHTML = `<i class="fas fa-check mr-1"></i>${count}æ¡ ${timeStr}`;
                    el.className = 'text-emerald-600 dark:text-emerald-400 text-[10px] mr-2';
                    break;
                case 'cached':
                    const cacheDate = new Date(cacheTime);
                    const cacheTimeStr = `${String(cacheDate.getHours()).padStart(2,'0')}:${String(cacheDate.getMinutes()).padStart(2,'0')}`;
                    el.innerHTML = `<i class="fas fa-clock mr-1"></i>ç¼“å­˜ ${cacheTimeStr}`;
                    el.className = 'text-amber-600 dark:text-amber-400 text-[10px] mr-2';
                    break;
            }
        }

        function showError(message) {
            const feed = document.getElementById('newsFeed');
            feed.innerHTML = `
                <div class="p-8 text-center text-red-500 dark:text-red-400">
                    <div class="text-4xl mb-2">âš ï¸</div>
                    <p class="font-medium mb-2">${message}</p>
                    <button onclick="loadRSS()" class="mt-4 px-6 py-2 bg-emerald-600 text-white rounded-lg text-sm hover:bg-emerald-700 transition">
                        é‡æ–°åŠ è½½
                    </button>
                </div>
            `;
            updateSyncStatus('error');
        }

        function filterByTag(tag) {
            currentTag = tag;
            
            document.querySelectorAll('.tag-btn').forEach(btn => {
                btn.classList.remove('tag-active', 'text-emerald-600', 'dark:text-emerald-400');
                btn.classList.add('text-gray-600', 'dark:text-gray-400');
                if (btn.dataset.tag === tag) {
                    btn.classList.add('tag-active', 'text-emerald-600', 'dark:text-emerald-400');
                    btn.classList.remove('text-gray-600', 'dark:text-gray-400');
                }
            });
            
            renderNews();
        }

        // æ£€æµ‹æ–°é—»ä¸­æ˜¯å¦åŒ…å«çƒé˜Ÿå
        function detectTeamsInNews(title, description) {
            const teams = [];
            const text = (title + ' ' + description).toLowerCase();
            
            for (const teamName in TEAM_LOGOS) {
                if (text.includes(teamName.toLowerCase())) {
                    teams.push(teamName);
                }
            }
            
            return teams;
        }

        // è·å–çƒé˜ŸID
        function getTeamIdByName(teamName) {
            const team = teamData.find(t => t.name === teamName);
            return team ? team.id : null;
        }

        function renderNews() {
            const feed = document.getElementById('newsFeed');
            feed.innerHTML = '';
            
            const filtered = currentTag === 'all' ? rssData : rssData.filter(p => p.category === currentTag);
            
            if (filtered.length === 0) {
                feed.innerHTML = `
                    <div class="p-8 text-center text-gray-400 dark:text-gray-500">
                        <i class="fas fa-inbox text-4xl mb-3"></i>
                        <p>æš‚æ— ç›¸å…³æ–‡ç« </p>
                    </div>
                `;
                return;
            }
            
            filtered.forEach((post, index) => {
                const card = document.createElement('div');
                card.className = 'news-card bg-white dark:bg-dark-surface p-4 flex gap-4 cursor-pointer fade-in';
                card.style.animationDelay = `${index * 0.05}s`;
                card.onclick = () => openArticle(post);
                
                const tagColors = {
                    match: 'bg-blue-100 dark:bg-blue-900 text-blue-700 dark:text-blue-300',
                    transfer: 'bg-purple-100 dark:bg-purple-900 text-purple-700 dark:text-purple-300',
                    official: 'bg-red-100 dark:bg-red-900 text-red-700 dark:text-red-300',
                    analysis: 'bg-amber-100 dark:bg-amber-900 text-amber-700 dark:text-amber-300',
                    news: 'bg-gray-100 dark:bg-gray-700 text-gray-700 dark:text-gray-300'
                };
                
                const tagNames = { match: 'æˆ˜æŠ¥', transfer: 'è½¬ä¼š', official: 'å…¬å‘Š', analysis: 'åˆ†æ', news: 'æ–°é—»' };
                
                const tagClass = tagColors[post.category] || tagColors.news;
                const tagName = tagNames[post.category] || 'æ–°é—»';
                
                // æ£€æµ‹ç›¸å…³çƒé˜Ÿ
                const relatedTeams = detectTeamsInNews(post.title, post.description);
                let teamTagsHtml = '';
                if (relatedTeams.length > 0) {
                    teamTagsHtml = `
                        <div class="flex flex-wrap gap-2 mt-2">
                            ${relatedTeams.map(team => `
                                <span class="news-team-tag" onclick="event.stopPropagation(); goToTeamByName('${team}')">
                                    <img src="${getTeamLogo(team)}" alt="${team}" onerror="this.src='${DEFAULT_LOGO}'">
                                    ${team}
                                </span>
                            `).join('')}
                        </div>
                    `;
                }
                
                card.innerHTML = `
                    <div class="flex-1 min-w-0">
                        <h2 class="text-base font-bold text-gray-900 dark:text-gray-100 leading-snug mb-2 line-clamp-2">
                            ${escapeHtml(post.title)}
                        </h2>
                        <p class="text-sm text-gray-500 dark:text-gray-400 line-clamp-2 mb-3 leading-relaxed">
                            ${escapeHtml(post.description)}
                        </p>
                        <div class="flex items-center text-xs text-gray-400 dark:text-gray-500 gap-3">
                            <span class="${tagClass} px-2 py-0.5 rounded font-medium">${tagName}</span>
                            <span class="flex items-center gap-1"><i class="far fa-comment-alt"></i>${post.comments}</span>
                            <span>${formatTime(post.pubDate)}</span>
                        </div>
                        ${teamTagsHtml}
                    </div>
                    <div class="w-24 h-20 flex-shrink-0 rounded-lg overflow-hidden bg-gray-200 dark:bg-gray-700">
                        <img src="${post.image}" alt="" class="w-full h-full object-cover" loading="lazy" onerror="this.src='https://via.placeholder.com/400x300?text=No+Image'">
                    </div>
                `;
                
                feed.appendChild(card);
            });
        }

        // æ ¹æ®çƒé˜Ÿåè·³è½¬åˆ°çƒé˜Ÿé¡µ
        function goToTeamByName(teamName) {
            const team = teamData.find(t => t.name === teamName);
            if (team) {
                // åˆ‡æ¢åˆ°çƒé˜Ÿæ ‡ç­¾
                switchTab('team');
                // æ‰“å¼€çƒé˜Ÿè¯¦æƒ…
                setTimeout(() => openTeamDetail(team.id), 100);
            } else {
                alert('çƒé˜Ÿæ•°æ®å°šæœªåŠ è½½ï¼Œè¯·å…ˆè®¿é—®çƒé˜Ÿé¡µé¢');
            }
        }

        // ä¿®å¤ï¼šæ–‡ç« è¯¦æƒ…é¡µæ‰“å¼€å‡½æ•°
        function openArticle(post) {
            const page = document.getElementById('articlePage');
            const content = document.getElementById('articleContent');
            
            const tagNames = { match: 'æ¯”èµ›æˆ˜æŠ¥', transfer: 'è½¬ä¼šåŠ¨æ€', official: 'å®˜æ–¹å…¬å‘Š', analysis: 'æˆ˜æœ¯åˆ†æ', news: 'æ–°é—»æŠ¥é“' };
            
            // æ£€æµ‹ç›¸å…³çƒé˜Ÿ
            const relatedTeams = detectTeamsInNews(post.title, post.description);
            let teamTagsHtml = '';
            if (relatedTeams.length > 0) {
                teamTagsHtml = `
                    <div class="flex flex-wrap gap-2 mt-4 pt-4 border-t border-gray-200 dark:border-dark-border">
                        <span class="text-sm text-gray-500 dark:text-gray-400 mr-2">ç›¸å…³çƒé˜Ÿï¼š</span>
                        ${relatedTeams.map(team => `
                            <span class="news-team-tag" onclick="event.stopPropagation(); goToTeamByName('${team}')">
                                <img src="${getTeamLogo(team)}" alt="${team}" onerror="this.src='${DEFAULT_LOGO}'">
                                ${team}
                            </span>
                        `).join('')}
                    </div>
                `;
            }
            
            content.innerHTML = `
                <div class="mb-4">
                    <span class="inline-block px-2 py-1 bg-emerald-100 dark:bg-emerald-900 text-emerald-700 dark:text-emerald-300 text-xs rounded mb-2 font-medium">
                        ${tagNames[post.category] || 'æ–°é—»'}
                    </span>
                    <h1 class="text-2xl font-bold text-gray-900 dark:text-gray-100 leading-tight mb-3">
                        ${escapeHtml(post.title)}
                    </h1>
                    <div class="flex items-center justify-between text-sm text-gray-500 dark:text-gray-400 border-b border-gray-200 dark:border-dark-border pb-4">
                        <div class="flex items-center gap-2">
                            <span class="font-medium text-gray-700 dark:text-gray-300">${escapeHtml(post.author)}</span>
                            <span>â€¢</span>
                            <span>${formatTime(post.pubDate)}</span>
                        </div>
                        <div class="flex items-center gap-3">
                            <span class="flex items-center gap-1"><i class="far fa-eye"></i>${post.views}</span>
                            <span class="flex items-center gap-1"><i class="far fa-comment"></i>${post.comments}</span>
                        </div>
                    </div>
                </div>
                <div class="prose dark:prose-invert max-w-none text-gray-700 dark:text-gray-300 leading-relaxed text-base">
                    ${post.content}
                </div>
                ${teamTagsHtml}
            `;
            
            // ä¿®å¤ï¼šæ·»åŠ  show ç±»æ¥è§¦å‘æ»‘å…¥åŠ¨ç”»
            page.classList.add('show');
            document.body.style.overflow = 'hidden';
        }

        // ä¿®å¤ï¼šæ–‡ç« è¯¦æƒ…é¡µå…³é—­å‡½æ•°
        function closeArticle() {
            const page = document.getElementById('articlePage');
            page.classList.remove('show');
            document.body.style.overflow = '';
        }

        function shareArticle() {
            const title = document.querySelector('#articleContent h1')?.textContent || 'åŠ è¥¿äºšè¶³çƒAPP';
            if (navigator.share) {
                navigator.share({ title: title, text: 'æ¥è‡ªåŠ è¥¿äºšè¶³çƒAPP', url: window.location.href });
            } else {
                navigator.clipboard.writeText(window.location.href).then(() => alert('é“¾æ¥å·²å¤åˆ¶åˆ°å‰ªè´´æ¿'));
            }
        }

        // ========== çƒé˜Ÿé¡µé¢åŠŸèƒ½ ==========
        
        // è·å–é˜Ÿå¾½URL
        function getTeamLogo(teamName) {
            return TEAM_LOGOS[teamName] || DEFAULT_LOGO;
        }
        
        // è§£æä½ç½®åˆ†ç±» - æ ¹æ®ç¬¬ä¸€ä¸ªä½ç½®åˆ¤æ–­
        function getPositionCategory(position) {
            if (!position) return 'MF';
            
            const posList = position.split(/[,ï¼Œ]/).map(p => p.trim());
            const firstPos = posList[0];
            
            // é—¨å°†
            if (firstPos.includes('é—¨å°†') || firstPos.includes('å®ˆé—¨')) return 'GK';
            
            // åå« - Xå«
            if (firstPos.includes('åå«') || firstPos.includes('åå«') || 
                firstPos.includes('åå«') || firstPos.includes('åå«') ||
                firstPos.includes('åå«') || firstPos.includes('åå«') ||
                firstPos.includes('åå«') || firstPos.endsWith('å«')) return 'DF';
            
            // å‰é”‹ - Xé”‹
            if (firstPos.includes('å‰é”‹') || firstPos.includes('ä¸­é”‹') || 
                firstPos.includes('å½±é”‹') || firstPos.includes('è¾¹é”‹') ||
                firstPos.endsWith('é”‹')) return 'FW';
            
            // ä¸­åœº - Xåœºã€Xè…°
            if (firstPos.includes('ä¸­åœº') || firstPos.includes('å‰å«') || 
                firstPos.includes('åè…°') || firstPos.includes('å‰è…°') ||
                firstPos.includes('ä¸­å‰å«') || firstPos.includes('ç»„ç»‡') ||
                firstPos.includes('è¿›æ”»') || firstPos.endsWith('åœº') || 
                firstPos.endsWith('è…°')) return 'MF';
            
            return 'MF';
        }
        
        // è·å–ä½ç½®é¢œè‰²ç±»
        function getPositionColorClass(pos) {
            const map = { 'GK': 'position-gk', 'DF': 'position-df', 'MF': 'position-mf', 'FW': 'position-fw' };
            return map[pos] || 'position-mf';
        }
        
        // è§£ææ•™ç»ƒå­—ç¬¦ä¸²ï¼Œæå–æ‰€æœ‰æ•™ç»ƒ
        function parseCoaches(coachStr) {
            if (!coachStr) return [];
            // æŒ‰é¡¿å·ã€é€—å·ã€æ–œæ åˆ†éš”
            return coachStr.split(/[ã€,ï¼Œ/]/).map(c => c.trim()).filter(c => c);
        }
        
        // æ ¼å¼åŒ–æ•°å­—ï¼Œä¸æ˜¾ç¤ºå•ä½
        function formatNumberRaw(num) {
            if (!num) return '0';
            return num.toString();
        }
        
        async function loadTeamData() {
            const teamList = document.getElementById('teamList');
            teamList.innerHTML = '<div class="text-center py-8"><i class="fas fa-spinner fa-spin text-2xl text-emerald-600"></i><p class="text-sm text-gray-500 mt-2">åŠ è½½çƒé˜Ÿæ•°æ®...</p></div>';
            
            try {
                const response = await fetch(CONFIG.excelUrl, { signal: AbortSignal.timeout(15000) });
                if (!response.ok) throw  new Error('æ— æ³•åŠ è½½æ•°æ®æ–‡ä»¶');
                
                const arrayBuffer = await response.arrayBuffer();
                const data = new Uint8Array(arrayBuffer);
                const workbook = XLSX.read(data, { type: 'array' });
                
                // è§£æçƒé˜Ÿè¡¨æ ¼ï¼ˆç¬¬äºŒä¸ªå·¥ä½œè¡¨ï¼‰
                const teamSheetName = workbook.SheetNames.find(name => name.includes('çƒé˜Ÿ')) || workbook.SheetNames[1];
                const teamSheet = workbook.Sheets[teamSheetName];
                const teamJson = XLSX.utils.sheet_to_json(teamSheet, { header: 1 });
                
                // è§£æçƒå‘˜æ•°æ®åº“ï¼ˆç¬¬ä¸€ä¸ªå·¥ä½œè¡¨ï¼‰
                const playerSheetName = workbook.SheetNames.find(name => name.includes('çƒå‘˜')) || workbook.SheetNames[0];
                const playerSheet = workbook.Sheets[playerSheetName];
                const playerJson = XLSX.utils.sheet_to_json(playerSheet, { header: 1 });
                
                // å¤„ç†çƒé˜Ÿæ•°æ® - ä¿®å¤ï¼šæ­£ç¡®å¤„ç†è¡¨å¤´å’Œæ•°æ®è¡Œ
                const teamHeaders = teamJson[0];
                teamData = [];
                for (let i = 1; i < teamJson.length; i++) {
                    const row = teamJson[i];
                    if (!row[0]) continue; // è·³è¿‡ç©ºè¡Œ
                    
                    const teamObj = {};
                    teamHeaders.forEach((header, idx) => {
                        teamObj[header] = row[idx];
                    });
                    
                    teamData.push({
                        id: i - 1,
                        name: teamObj['çƒé˜Ÿå'] || '',
                        manager: teamObj['ç©å®¶'] || '',
                        coach: teamObj['æ•™ç»ƒç»„'] || '',
                        stadium: teamObj['ä¸»åœº'] || '',
                        capacity: teamObj['åº§å¸­æ•°'] || 0,
                        avgAttendance: teamObj['åœºå‡ä¸Šåº§'] || 0,
                        occupancyRate: teamObj['ä¸Šåº§ç‡'] || 0,
                        revenue: teamObj['æ”¶å…¥'] || 0,
                        funds: teamObj['çƒé˜Ÿèµ„é‡‘'] || 0,
                        sponsor1: teamObj['èµåŠ©å•†1'] || '',
                        sponsor2: teamObj['èµåŠ©å•†2'] || '',
                        youth: teamObj['é’è®­'] || '',
                        other: teamObj['å…¶ä»–'] || ''
                    });
                }
                
                // å¤„ç†çƒå‘˜æ•°æ® - ä¿®å¤ï¼šæ­£ç¡®å¤„ç†è¡¨å¤´å’Œæ•°æ®è¡Œ
                const playerHeaders = playerJson[0];
                playersData = [];
                for (let i = 1; i < playerJson.length; i++) {
                    const row = playerJson[i];
                    if (!row[0]) continue; // è·³è¿‡ç©ºè¡Œ
                    
                    const playerObj = {};
                    playerHeaders.forEach((header, idx) => {
                        playerObj[header] = row[idx];
                    });
                    
                    const position = playerObj['ä½ç½®'] || '';
                    const mainPos = getPositionCategory(position);
                    const posList = position.split(/[,ï¼Œ]/).map(p => p.trim()).filter(p => p);
                    
                    playersData.push({
                        id: i - 1,
                        name: playerObj['çƒå‘˜åç§°'] || '',
                        age: playerObj['å¹´é¾„'] || 0,
                        nation: playerObj['å›½å®¶/åœ°åŒºç±'] || '',
                        height: playerObj['èº«é«˜'] || 0,
                        weight: playerObj['ä½“é‡'] || 0,
                        ca: playerObj['CA'] || 0,
                        pa: playerObj['PA'] || 0,
                        position: position,
                        mainPosition: mainPos,
                        positionName: posList[0] || 'æœªçŸ¥',
                        allPositions: posList,
                        wage: playerObj['å¹´è–ª'] || 0,
                        team: playerObj['æ‰€åœ¨çƒé˜Ÿ'] || '',
                        contractEnd: playerObj['åˆçº¦åˆ°æœŸ'] || '',
                        clause: playerObj['è¿çº¦é‡‘'] || '',
                        contractType: playerObj['åˆåŒç±»å‹'] || '',
                        contractNote: playerObj['åˆåŒå¤‡æ³¨'] || ''
                    });
                }
                
                renderTeamList();
                
            } catch (error) {
                console.error('åŠ è½½çƒé˜Ÿæ•°æ®å¤±è´¥:', error);
                teamList.innerHTML = `
                    <div class="text-center text-red-500 py-8">
                        <i class="fas fa-exclamation-circle text-2xl mb-2"></i>
                        <p class="text-sm">åŠ è½½å¤±è´¥: ${error.message}</p>
                        <button onclick="loadTeamData()" class="mt-4 px-4 py-2 bg-emerald-600 text-white rounded-lg text-sm">
                            é‡è¯•
                        </button>
                    </div>
                `;
            }
        }
        
        function renderTeamList() {
            const container = document.getElementById('teamList');
            
            if (teamData.length === 0) {
                container.innerHTML = '<div class="text-center text-gray-400 py-8">æš‚æ— çƒé˜Ÿæ•°æ®</div>';
                return;
            }
            
            container.innerHTML = teamData.map((team, idx) => `
                <div onclick="openTeamDetail(${team.id})" class="bg-white dark:bg-dark-surface rounded-lg p-4 flex items-center gap-4 shadow-sm cursor-pointer active:scale-95 transition-transform">
                    <div class="team-logo-container team-logo-list bg-gray-50 dark:bg-gray-800 rounded-lg p-1">
                        <img src="${getTeamLogo(team.name)}" alt="${team.name}" onerror="this.src='${DEFAULT_LOGO}'">
                    </div>
                    <div class="flex-1 min-w-0">
                        <div class="flex items-center gap-2 mb-1">
                            <h3 class="font-bold text-lg dark:text-gray-100 truncate">${team.name}</h3>
                        </div>
                        <div class="flex items-center gap-2 text-sm text-gray-500 dark:text-gray-400">
                            <span class="truncate">${team.stadium}</span>
                        </div>
                        <div class="flex items-center gap-3 mt-1 text-xs text-gray-400">
                            <span>èµ„é‡‘: ${formatNumber(team.funds)}ä¸‡</span>
                            <span>ä¸Šåº§: ${formatNumber(team.avgAttendance)}</span>
                        </div>
                    </div>
                    <i class="fas fa-chevron-right text-gray-300 dark:text-gray-600"></i>
                </div>
            `).join('');
        }
        
        function formatNumber(num) {
            if (!num) return '0';
            if (num >= 10000) return (num / 10000).toFixed(1) + 'äº¿';
            if (num >= 1000) return (num / 1000).toFixed(1) + 'åƒä¸‡';
            return num.toString();
        }
        
        function openTeamDetail(teamId) {
            currentTeam = teamData.find(t => t.id === teamId);
            if (!currentTeam) return;
            
            // è§£ææ•™ç»ƒåˆ—è¡¨
            currentCoaches = parseCoaches(currentTeam.coach);
            const headCoach = currentCoaches[0] || 'æš‚æ— ';
            
            // è®¡ç®—çƒé˜Ÿæ€»å¹´è–ªå’Œé¢„è®¡å­£æœ«èµ„é‡‘
            const teamPlayers = playersData.filter(p => p.team === currentTeam.name);
            const totalWages = teamPlayers.reduce((sum, p) => sum + (parseFloat(p.wage) || 0), 0);
            const projectedFunds = (parseFloat(currentTeam.funds) || 0) - totalWages;
            
            // å¡«å……çƒé˜Ÿä¿¡æ¯ - å¤´éƒ¨åªæ˜¾ç¤ºä¸»æ•™ç»ƒ
            document.getElementById('teamDetailName').textContent = currentTeam.name;
            document.getElementById('teamDetailNameEn').textContent = currentTeam.stadium;
            document.getElementById('teamDetailCoach').textContent = headCoach;
            
            // ç»Ÿè®¡æ•°å­—ä¸æ˜¾ç¤ºå•ä½
            document.getElementById('teamDetailFunds').textContent = formatNumberRaw(currentTeam.funds);
            document.getElementById('teamDetailAttendance').textContent = formatNumberRaw(currentTeam.avgAttendance);
            document.getElementById('teamDetailOccupancy').textContent = ((currentTeam.occupancyRate || 0) * 100).toFixed(1) + '%';
            document.getElementById('teamDetailCapacity').textContent = formatNumberRaw(currentTeam.capacity);
            
            // æ–°å¢ï¼šçƒé˜Ÿæ€»å¹´è–ªå’Œé¢„è®¡å­£æœ«èµ„é‡‘
            document.getElementById('teamDetailWages').textContent = formatNumberRaw(totalWages);
            document.getElementById('teamDetailProjected').textContent = formatNumberRaw(projectedFunds);
            
            // å¦‚æœé¢„è®¡å­£æœ«èµ„é‡‘ä¸ºè´Ÿæ•°ï¼Œæ˜¾ç¤ºè­¦å‘Š
            const warningEl = document.getElementById('financialWarning');
            if (projectedFunds < 0) {
                warningEl.classList.remove('hidden');
            } else {
                warningEl.classList.add('hidden');
            }
            
            // çƒé˜Ÿlogo
            document.getElementById('teamDetailLogo').src = getTeamLogo(currentTeam.name);
            
            // ä¸»æ•™ç»ƒåŒºåŸŸ - åªæ˜¾ç¤ºä¸»æ•™ç»ƒï¼Œæ·»åŠ ç®­å¤´
            document.getElementById('coachCard').innerHTML = `
                <div class="font-bold dark:text-gray-100 text-lg">${headCoach}</div>
                <div class="text-sm text-gray-500">ä¸»æ•™ç»ƒ</div>
            `;
            
            // æ¸²æŸ“çƒå‘˜åˆ—è¡¨
            renderSquad();
            
            // æ¸²æŸ“çƒé˜ŸåŠ¨æ€ï¼ˆç›¸å…³æ–°é—»ï¼‰
            renderTeamNews();
            
            // é‡ç½®æ ‡ç­¾é¡µ
            switchTeamTab('squad');
            
            // æ˜¾ç¤ºè¯¦æƒ…é¡µ
            document.getElementById('teamDetailPage').classList.remove('hidden');
            document.body.style.overflow = 'hidden';
        }
        
        // æ¸²æŸ“çƒé˜ŸåŠ¨æ€ï¼ˆç›¸å…³æ–°é—»ï¼‰
        function renderTeamNews() {
            const container = document.getElementById('teamNewsList');
            if (!currentTeam) return;
            
            // ä»RSSæ•°æ®ä¸­ç­›é€‰åŒ…å«å½“å‰çƒé˜Ÿçš„æ–°é—»
            const teamNews = rssData.filter(post => {
                const text = (post.title + ' ' + post.description).toLowerCase();
                return text.includes(currentTeam.name.toLowerCase());
            });
            
            if (teamNews.length === 0) {
                container.innerHTML = `
                    <div class="bg-white dark:bg-dark-surface rounded-lg p-8 text-center text-gray-400">
                        <i class="fas fa-newspaper text-4xl mb-2"></i>
                        <p>æš‚æ— ç›¸å…³åŠ¨æ€</p>
                    </div>
                `;
                return;
            }
            
            container.innerHTML = teamNews.map((post, idx) => {
                const tagColors = {
                    match: 'bg-blue-100 dark:bg-blue-900 text-blue-700 dark:text-blue-300',
                    transfer: 'bg-purple-100 dark:bg-purple-900 text-purple-700 dark:text-purple-300',
                    official: 'bg-red-100 dark:bg-red-900 text-red-700 dark:text-red-300',
                    analysis: 'bg-amber-100 dark:bg-amber-900 text-amber-700 dark:text-amber-300',
                    news: 'bg-gray-100 dark:bg-gray-700 text-gray-700 dark:text-gray-300'
                };
                const tagNames = { match: 'æˆ˜æŠ¥', transfer: 'è½¬ä¼š', official: 'å…¬å‘Š', analysis: 'åˆ†æ', news: 'æ–°é—»' };
                const tagClass = tagColors[post.category] || tagColors.news;
                const tagName = tagNames[post.category] || 'æ–°é—»';
                
                return `
                    <div onclick="openArticleFromTeam(${post.id})" class="bg-white dark:bg-dark-surface rounded-lg p-4 shadow-sm cursor-pointer active:scale-95 transition-transform">
                        <div class="flex items-center gap-2 mb-2">
                            <span class="${tagClass} px-2 py-0.5 rounded text-xs font-medium">${tagName}</span>
                            <span class="text-xs text-gray-400">${formatTime(post.pubDate)}</span>
                        </div>
                        <h4 class="font-bold text-sm dark:text-gray-100 line-clamp-2">${escapeHtml(post.title)}</h4>
                        <p class="text-xs text-gray-500 dark:text-gray-400 line-clamp-2 mt-1">${escapeHtml(post.description)}</p>
                    </div>
                `;
            }).join('');
        }
        
        // ä»çƒé˜ŸåŠ¨æ€æ‰“å¼€æ–‡ç« 
        function openArticleFromTeam(postId) {
            const post = rssData.find(p => p.id == postId);
            if (post) {
                openArticle(post);
            }
        }
        
        // æ‰“å¼€æ•™ç»ƒè¯¦æƒ…é¡µ
        function openCoachDetail() {
            const container = document.getElementById('coachList');
            
            if (currentCoaches.length === 0) {
                container.innerHTML = '<div class="text-center text-gray-400 py-8">æš‚æ— æ•™ç»ƒä¿¡æ¯</div>';
            } else {
                container.innerHTML = currentCoaches.map((coach, idx) => `
                    <div class="bg-white dark:bg-dark-surface rounded-lg p-4 shadow-sm">
                        <div class="flex items-center justify-between">
                            <div>
                                <div class="font-bold dark:text-gray-100 text-lg">${coach}</div>
                                <div class="text-sm text-gray-500">${idx === 0 ? 'ä¸»æ•™ç»ƒ' : 'åŠ©ç†æ•™ç»ƒ'}</div>
                            </div>
                            ${idx === 0 ? '<span class="text-emerald-600 text-sm font-medium">ç°ä»»</span>' : ''}
                        </div>
                    </div>
                `).join('');
            }
            
            document.getElementById('coachDetailPage').classList.remove('hidden');
        }
        
        // ä»æ•™ç»ƒè¯¦æƒ…è¿”å›çƒé˜Ÿè¯¦æƒ…
        function backToTeamDetailFromCoach() {
            document.getElementById('coachDetailPage').classList.add('hidden');
        }
        
        function renderSquad() {
            const container = document.getElementById('playersList');
            const teamPlayers = playersData.filter(p => p.team === currentTeam.name);
            
            if (teamPlayers.length === 0) {
                container.innerHTML = '<div class="text-center text-gray-400 py-8">æš‚æ— çƒå‘˜æ•°æ®</div>';
                return;
            }
            
            // æŒ‰ä½ç½®åˆ†ç»„
            const positionOrder = ['GK', 'DF', 'MF', 'FW'];
            const positionTitles = {'GK': 'é—¨å°†', 'DF': 'åå«', 'MF': 'ä¸­åœº', 'FW': 'å‰é”‹'};
            
            container.innerHTML = positionOrder.map(pos => {
                const posPlayers = teamPlayers.filter(p => p.mainPosition === pos);
                if (posPlayers.length === 0) return '';
                
                return `
                    <div class="mb-4">
                        <h3 class="text-sm font-bold text-gray-500 dark:text-gray-400 mb-2 uppercase tracking-wider">${positionTitles[pos]} (${posPlayers.length}äºº)</h3>
                        <div class="bg-white dark:bg-dark-surface rounded-lg overflow-hidden shadow-sm">
                            ${posPlayers.map((player, idx) => `
                                <div onclick="openPlayerDetail(${player.id})" class="player-card flex items-center gap-3 p-3 ${idx !== posPlayers.length - 1 ? 'border-b border-gray-100 dark:border-dark-border' : ''} cursor-pointer hover:bg-gray-50 dark:hover:bg-gray-700/50">
                                    <div class="flex-1 min-w-0">
                                        <div class="flex items-center gap-2">
                                            <span class="font-bold text-sm dark:text-gray-100">${player.name}</span>
                                            <span class="position-badge ${getPositionColorClass(pos)}">${player.positionName}</span>
                                        </div>
                                        <div class="text-xs text-gray-500 dark:text-gray-400 mt-0.5">
                                            ${player.age}å² Â· ${player.nation} Â· å¹´è–ª${player.wage}ä¸‡
                                        </div>
                                    </div>
                                    <div class="text-right">
                                        <div class="text-lg font-bold text-emerald-600">${player.ca}</div>
                                        <div class="text-xs text-gray-400">CA</div>
                                    </div>
                                </div>
                            `).join('')}
                        </div>
                    </div>
                `;
            }).join('');
        }
        
        function switchTeamTab(tab) {
            // æ›´æ–°æ ‡ç­¾æ ·å¼
            document.querySelectorAll('.team-tab').forEach(btn => {
                if (btn.dataset.tab === tab) {
                    btn.classList.add('tab-active');
                    btn.classList.remove('text-gray-500', 'dark:text-gray-400');
                } else {
                    btn.classList.remove('tab-active');
                    btn.classList.add('text-gray-500', 'dark:text-gray-400');
                }
            });
            
            // æ˜¾ç¤ºå¯¹åº”å†…å®¹
            ['squad', 'stats', 'schedule', 'news'].forEach(t => {
                document.getElementById(t + 'Content').classList.toggle('hidden', t !== tab);
            });
        }
        
        function backToTeamList() {
            document.getElementById('teamDetailPage').classList.add('hidden');
            document.getElementById('coachDetailPage').classList.add('hidden');
            document.body.style.overflow = '';
            currentTeam = null;
            currentCoaches = [];
        }
        
        function shareTeam() {
            if (navigator.share && currentTeam) {
                navigator.share({
                    title: currentTeam.name,
                    text: `æŸ¥çœ‹${currentTeam.name}çš„è¯¦ç»†èµ„æ–™`,
                    url: window.location.href
                });
            }
        }
        
        // ========== çƒå‘˜è¯¦æƒ… ==========
        
        function openPlayerDetail(playerId) {
            const player = playersData.find(p => p.id === playerId);
            if (!player) return;
            
            // ç§»é™¤å¤´åƒï¼Œä½¿ç”¨é¦–å­—æ¯
            document.getElementById('playerInitial').textContent = player.name.charAt(0);
            document.getElementById('playerDetailPosition').textContent = player.positionName;
            document.getElementById('playerDetailPosition').className = 'position-badge ' + getPositionColorClass(player.mainPosition);
            document.getElementById('playerDetailName').textContent = player.name;
            document.getElementById('playerDetailTeam').textContent = player.team;
            
            // è®¡ç®—ç»¼åˆè¯„åˆ†ï¼ˆåŸºäºCAï¼‰
            const rating = Math.min(10, (player.ca / 200) * 10).toFixed(1);
            document.getElementById('playerDetailRating').textContent = rating;
            
            document.getElementById('playerDetailCA').textContent = player.ca;
            document.getElementById('playerDetailPA').textContent = player.pa;
            document.getElementById('playerDetailAge').textContent = player.age + 'å²';
            document.getElementById('playerDetailNation').textContent = player.nation;
            document.getElementById('playerDetailHeight').textContent = player.height + 'cm';
            document.getElementById('playerDetailWeight').textContent = player.weight + 'kg';
            document.getElementById('playerDetailTeam2').textContent = player.team;
            document.getElementById('playerDetailContract').textContent = player.contractEnd || 'æœªåˆ°æœŸ';
            document.getElementById('playerDetailWage').textContent = player.wage + 'ä¸‡';
            document.getElementById('playerDetailClause').textContent = player.clause ? player.clause + 'ä¸‡' : 'æ— ';
            
            // æ˜¾ç¤ºæ‰€æœ‰å¯æ‰“ä½ç½®
            const positionsContainer = document.getElementById('playerAllPositions');
            positionsContainer.innerHTML = player.allPositions.map((pos, idx) => {
                const posCat = getPositionCategory(pos);
                return `<span class="position-badge ${getPositionColorClass(posCat)}">${pos}</span>`;
            }).join('');
            
            document.getElementById('playerDetailPage').classList.remove('hidden');
        }
        
        function backToTeamDetail() {
            document.getElementById('playerDetailPage').classList.add('hidden');
        }
        
        function sharePlayer() {
            const playerName = document.getElementById('playerDetailName').textContent;
            if (navigator.share) {
                navigator.share({
                    title: playerName,
                    text: `æŸ¥çœ‹${playerName}çš„è¯¦ç»†èµ„æ–™`,
                    url: window.location.href
                });
            }
        }

        // ========== å°è¯´åŠŸèƒ½ ==========
        
        // åŠ è½½ä¹¦æº
        async function loadBookSource() {
            const bookshelf = document.getElementById('bookshelf');
            bookshelf.innerHTML = '<div class="col-span-full text-center py-8"><i class="fas fa-spinner fa-spin text-2xl text-emerald-600"></i><p class="text-sm text-gray-500 mt-2">åŠ è½½ä¹¦ç±...</p></div>';
            
            try {
                const response = await fetch(CONFIG.bookSourceUrl, { signal: AbortSignal.timeout(10000) });
                if (!response.ok) throw new Error('æ— æ³•åŠ è½½ä¹¦æº');
                
                const text = await response.text();
                books = parseBookSource(text);
                
                renderBookshelf();
                
            } catch (error) {
                console.error('åŠ è½½ä¹¦æºå¤±è´¥:', error);
                bookshelf.innerHTML = `
                    <div class="col-span-full text-center text-red-500 py-8">
                        <i class="fas fa-exclamation-circle text-2xl mb-2"></i>
                        <p class="text-sm">åŠ è½½å¤±è´¥: ${error.message}</p>
                        <button onclick="loadBookSource()" class="mt-4 px-4 py-2 bg-emerald-600 text-white rounded-lg text-sm">
                            é‡è¯•
                        </button>
                    </div>
                `;
            }
        }
        
        // è§£æä¹¦æºæ–‡æœ¬
        function parseBookSource(text) {
            const books = [];
            const lines = text.split('\n');
            
            lines.forEach(line => {
                line = line.trim();
                if (!line) return;
                
                // åŒ¹é…æ ¼å¼ï¼šä¹¦åï¼šXXX txtç½‘å€ï¼šXXX
                const match = line.match(/ä¹¦å[ï¼š:]\s*(.+?)\s+txtç½‘å€[ï¼š:]\s*(.+)/i);
                if (match) {
                    const title = match[1].trim();
                    let url = match[2].trim();
                    
                    // ç¡®ä¿URLå®Œæ•´
                    if (!url.startsWith('http')) {
                        url = 'https://' + url;
                    }
                    
                    // æå–ä½œè€…ï¼ˆå¦‚æœæœ‰ï¼‰
                    let author = 'æœªçŸ¥ä½œè€…';
                    const authorMatch = title.match(/[ï¼ˆ(]([^)]+)[ï¼‰)]/);
                    if (authorMatch) {
                        author = authorMatch[1].replace('ä½œè€…ï¼š', '').replace('ä½œè€…:', '').trim();
                    }
                    
                    const cleanTitle = title.replace(/[ï¼ˆ(][^)]+[ï¼‰)]/g, '').trim();
                    
                    books.push({
                        title: cleanTitle,
                        author: author,
                        url: url,
                        coverColor: getRandomCoverColor()
                    });
                }
            });
            
            return books;
        }
        
        // éšæœºå°é¢é¢œè‰²
        function getRandomCoverColor() {
            const colors = [
                'linear-gradient(135deg, #667eea 0%, #764ba2 100%)',
                'linear-gradient(135deg, #f093fb 0%, #f5576c 100%)',
                'linear-gradient(135deg, #4facfe 0%, #00f2fe 100%)',
                'linear-gradient(135deg, #43e97b 0%, #38f9d7 100%)',
                'linear-gradient(135deg, #fa709a 0%, #fee140 100%)',
                'linear-gradient(135deg, #30cfd0 0%, #330867 100%)',
                'linear-gradient(135deg, #a8edea 0%, #fed6e3 100%)',
                'linear-gradient(135deg, #ff9a9e 0%, #fecfef 100%)'
            ];
            return colors[Math.floor(Math.random() * colors.length)];
        }
        
        // æ¸²æŸ“ä¹¦æ¶
        function renderBookshelf() {
            const container = document.getElementById('bookshelf');
            
            if (books.length === 0) {
                container.innerHTML = '<div class="col-span-full text-center text-gray-400 py-8">æš‚æ— ä¹¦ç±</div>';
                return;
            }
            
            container.innerHTML = books.map((book, idx) => `
                <div onclick="openBook(${idx})" class="cursor-pointer group">
                    <div class="book-cover mb-2" style="background: ${book.coverColor}">
                        <div class="text-white">
                            <div class="book-title">${book.title}</div>
                            <div class="book-author">${book.author}</div>
                        </div>
                    </div>
                    <div class="text-xs text-gray-600 dark:text-gray-400 text-center truncate group-hover:text-emerald-600 transition-colors">
                        ${book.title}
                    </div>
                </div>
            `).join('');
        }
        
        // æ‰“å¼€ä¹¦ç±
        async function openBook(index) {
            currentBook = books[index];
            const readerPage = document.getElementById('readerPage');
            const readerContent = document.getElementById('readerContent');
            const readerTitle = document.getElementById('readerTitle');
            
            readerTitle.textContent = currentBook.title;
            readerContent.innerHTML = '<div class="text-center py-8"><i class="fas fa-spinner fa-spin text-2xl text-emerald-600"></i><p class="text-sm text-gray-500 mt-2">åŠ è½½ä¸­...</p></div>';
            
            // æ˜¾ç¤ºé˜…è¯»é¡µé¢
            readerPage.classList.remove('hidden');
            document.body.style.overflow = 'hidden';
            
            // åº”ç”¨é˜…è¯»è®¾ç½®
            applyReaderSettings();
            
            try {
                const response = await fetch(currentBook.url, { signal: AbortSignal.timeout(30000) });
                if (!response.ok) throw new Error('æ— æ³•åŠ è½½ä¹¦ç±å†…å®¹');
                
                const text = await response.text();
                const formattedContent = formatBookContent(text);
                readerContent.innerHTML = formattedContent;
                
                // æ¢å¤é˜…è¯»è¿›åº¦
                const progress = localStorage.getItem(`book_progress_${currentBook.title}`);
                if (progress) {
                    const container = document.getElementById('readerContentContainer');
                    container.scrollTop = parseFloat(progress) * (container.scrollHeight - container.clientHeight);
                }
                
                // ç›‘å¬æ»šåŠ¨æ›´æ–°è¿›åº¦
                setupProgressTracking();
                
            } catch (error) {
                readerContent.innerHTML = `
                    <div class="text-center text-red-500 py-8">
                        <i class="fas fa-exclamation-circle text-2xl mb-2"></i>
                        <p class="text-sm">åŠ è½½å¤±è´¥: ${error.message}</p>
                        <button onclick="openBook(${index})" class="mt-4 px-4 py-2 bg-emerald-600 text-white rounded-lg text-sm">
                            é‡è¯•
                        </button>
                    </div>
                `;
            }
        }
        
        // æ ¼å¼åŒ–ä¹¦ç±å†…å®¹
        function formatBookContent(text) {
            // ç®€å•çš„æ–‡æœ¬å¤„ç†ï¼Œå°†æ–‡æœ¬åˆ†æ®µ
            const paragraphs = text.split(/\n\s*\n/).filter(p => p.trim());
            
            if (paragraphs.length === 0) {
                // å¦‚æœæ²¡æœ‰ç©ºè¡Œåˆ†éš”ï¼ŒæŒ‰æ¯100å­—åˆ†æ®µ
                const chunks = [];
                for (let i = 0; i < text.length; i += 100) {
                    chunks.push(text.slice(i, i + 100));
                }
                return chunks.map(chunk => `<p>${escapeHtml(chunk)}</p>`).join('');
            }
            
            return paragraphs.map(para => {
                const trimmed = para.trim();
                if (!trimmed) return '';
                
                // æ£€æµ‹æ˜¯å¦æ˜¯ç« èŠ‚æ ‡é¢˜
                if (/^[ç¬¬å·][0123456789ä¸€äºŒä¸‰å››äº”å…­ä¸ƒå…«ä¹åç™¾åƒé›¶]+[ç« å›èŠ‚å·].*/.test(trimmed) || 
                    trimmed.length < 20 && (trimmed.includes('ç« ') || trimmed.includes('èŠ‚'))) {
                    return `<h2 class="text-xl font-bold my-6 text-center">${escapeHtml(trimmed)}</h2>`;
                }
                
                return `<p>${escapeHtml(trimmed)}</p>`;
            }).join('');
        }
        
        // è¿”å›ä¹¦æ¶
        function backToBookshelf() {
            // ä¿å­˜é˜…è¯»è¿›åº¦
            if (currentBook) {
                const container = document.getElementById('readerContentContainer');
                const progress = container.scrollTop / (container.scrollHeight - container.clientHeight);
                localStorage.setItem(`book_progress_${currentBook.title}`, progress);
            }
            
            document.getElementById('readerPage').classList.add('hidden');
            document.getElementById('readerSettings').classList.remove('show');
            document.body.style.overflow = '';
            currentBook = null;
        }
        
        // åˆ‡æ¢é˜…è¯»è®¾ç½®é¢æ¿
        function toggleReaderSettings() {
            const panel = document.getElementById('readerSettings');
            panel.classList.toggle('show');
        }
        
        // è®¾ç½®é˜…è¯»èƒŒæ™¯
        function setReaderBg(bg) {
            readerSettings.bg = bg;
            
            // æ›´æ–°UI
            document.querySelectorAll('.color-option').forEach(el => {
                el.classList.remove('active');
                if (el.dataset.bg === bg) {
                    el.classList.add('active');
                }
            });
            
            applyReaderSettings();
            saveReaderSettings();
        }
        
        // æ›´æ–°é˜…è¯»æ ·å¼
        function updateReaderStyle() {
            const fontSize = document.getElementById('fontSizeSlider').value;
            const lineHeight = document.getElementById('lineHeightSlider').value / 10;
            const letterSpacing = document.getElementById('letterSpacingSlider').value / 100;
            const paraSpacing = document.getElementById('paraSpacingSlider').value / 10;
            
            readerSettings.fontSize = parseInt(fontSize);
            readerSettings.lineHeight = lineHeight;
            readerSettings.letterSpacing = letterSpacing;
            readerSettings.paraSpacing = paraSpacing;
            
            // æ›´æ–°æ˜¾ç¤ºå€¼
            document.getElementById('fontSizeValue').textContent = fontSize;
            document.getElementById('lineHeightValue').textContent = lineHeight.toFixed(1);
            document.getElementById('letterSpacingValue').textContent = letterSpacing.toFixed(2);
            document.getElementById('paraSpacingValue').textContent = paraSpacing.toFixed(1);
            
            applyReaderSettings();
            saveReaderSettings();
        }
        
        // åº”ç”¨é˜…è¯»è®¾ç½®
        function applyReaderSettings() {
            const readerPage = document.getElementById('readerPage');
            const readerContent = document.getElementById('readerContent');
            const readerHeader = document.getElementById('readerHeader');
            const readerFooter = document.getElementById('readerFooter');
            
            // ç§»é™¤æ‰€æœ‰èƒŒæ™¯ç±»
            readerPage.classList.remove('reader-bg-green', 'reader-bg-yellow', 'reader-bg-gray', 'reader-bg-black');
            readerPage.classList.add(`reader-bg-${readerSettings.bg}`);
            
            // åº”ç”¨æ–‡å­—æ ·å¼
            readerContent.style.fontSize = readerSettings.fontSize + 'px';
            readerContent.style.lineHeight = readerSettings.lineHeight;
            readerContent.style.letterSpacing = readerSettings.letterSpacing + 'em';
            
            // åº”ç”¨æ®µé—´è·
            const paragraphs = readerContent.querySelectorAll('p');
            paragraphs.forEach(p => {
                p.style.marginBottom = readerSettings.paraSpacing + 'em';
            });
            
            // æ ¹æ®èƒŒæ™¯è°ƒæ•´headerå’Œfooteræ ·å¼
            if (readerSettings.bg === 'black') {
                readerHeader.classList.add('bg-gray-900/90', 'text-gray-100');
                readerHeader.classList.remove('bg-white/90', 'text-gray-900');
                readerFooter.classList.add('bg-gray-900/90', 'text-gray-400');
                readerFooter.classList.remove('bg-white/90', 'text-gray-500');
            } else {
                readerHeader.classList.add('bg-white/90', 'text-gray-900');
                readerHeader.classList.remove('bg-gray-900/90', 'text-gray-100');
                readerFooter.classList.add('bg-white/90', 'text-gray-500');
                readerFooter.classList.remove('bg-gray-900/90', 'text-gray-400');
            }
            
            // æ›´æ–°è®¾ç½®é¢æ¿æ»‘å—å€¼
            document.getElementById('fontSizeSlider').value = readerSettings.fontSize;
            document.getElementById('lineHeightSlider').value = readerSettings.lineHeight * 10;
            document.getElementById('letterSpacingSlider').value = readerSettings.letterSpacing * 100;
            document.getElementById('paraSpacingSlider').value = readerSettings.paraSpacing * 10;
            
            // æ›´æ–°æ˜¾ç¤ºå€¼
            document.getElementById('fontSizeValue').textContent = readerSettings.fontSize;
            document.getElementById('lineHeightValue').textContent = readerSettings.lineHeight.toFixed(1);
            document.getElementById('letterSpacingValue').textContent = readerSettings.letterSpacing.toFixed(2);
            document.getElementById('paraSpacingValue').textContent = readerSettings.paraSpacing.toFixed(1);
        }
        
        // ä¿å­˜é˜…è¯»è®¾ç½®
        function saveReaderSettings() {
            localStorage.setItem('reader_settings', JSON.stringify(readerSettings));
        }
        
        // è®¾ç½®è¿›åº¦è·Ÿè¸ª
        function setupProgressTracking() {
            const container = document.getElementById('readerContentContainer');
            const progressBar = document.getElementById('readingProgress');
            const progressText = document.getElementById('readerProgress');
            
            container.onscroll = () => {
                const scrollPercent = container.scrollTop / (container.scrollHeight - container.clientHeight);
                const percent = Math.round(scrollPercent * 100);
                
                progressBar.style.width = percent + '%';
                progressText.textContent = percent + '%';
                
                // è‡ªåŠ¨ä¿å­˜è¿›åº¦
                if (currentBook) {
                    localStorage.setItem(`book_progress_${currentBook.title}`, scrollPercent);
                }
            };
        }
        
        // åˆ‡æ¢é˜…è¯»å™¨UIæ˜¾ç¤ºï¼ˆç‚¹å‡»ä¸­å¤®åŒºåŸŸï¼‰
        let uiVisible = true;
        function toggleReaderUI() {
            const header = document.getElementById('readerHeader');
            const footer = document.getElementById('readerFooter');
            const settings = document.getElementById('readerSettings');
            
            if (settings.classList.contains('show')) {
                settings.classList.remove('show');
                return;
            }
            
            uiVisible = !uiVisible;
            
            if (uiVisible) {
                header.style.transform = 'translateY(0)';
                footer.style.transform = 'translateY(0)';
            } else {
                header.style.transform = 'translateY(-100%)';
                footer.style.transform = 'translateY(100%)';
            }
        }

        // ========== åº•éƒ¨å¯¼èˆªåˆ‡æ¢ ==========

        function switchTab(tab) {
            currentTab = tab;
            
            document.querySelectorAll('.bottom-nav-item').forEach(btn => {
                btn.classList.remove('active', 'text-emerald-600', 'dark:text-emerald-400');
                btn.classList.add('text-gray-400', 'dark:text-gray-500');
                if (btn.dataset.tab === tab) {
                    btn.classList.add('active', 'text-emerald-600', 'dark:text-emerald-400');
                    btn.classList.remove('text-gray-400', 'dark:text-gray-500');
                }
            });
            
            // éšè—æ‰€æœ‰é¡µé¢
            document.getElementById('newsFeed').classList.add('hidden');
            document.getElementById('teamPage').classList.add('hidden');
            document.getElementById('novelPage').classList.add('hidden');
            document.getElementById('homeTabs').classList.add('hidden');
            document.getElementById('pullIndicator').classList.add('hidden');
            
            if (tab === 'home') {
                document.getElementById('newsFeed').classList.remove('hidden');
                document.getElementById('homeTabs').classList.remove('hidden');
                document.getElementById('pullIndicator').classList.remove('hidden');
                loadRSS();
            } else if (tab === 'team') {
                document.getElementById('teamPage').classList.remove('hidden');
                if (teamData.length === 0) {
                    loadTeamData();
                }
            } else if (tab === 'novel') {
                document.getElementById('novelPage').classList.remove('hidden');
                if (books.length === 0) {
                    loadBookSource();
                }
            } else {
                // å…¶ä»–é¡µé¢å ä½
                document.getElementById('newsFeed').classList.remove('hidden');
                document.getElementById('newsFeed').innerHTML = `
                    <div class="p-8 text-center text-gray-400 dark:text-gray-500 mt-20">
                        <i class="fas fa-tools text-4xl mb-3"></i>
                        <p>åŠŸèƒ½å¼€å‘ä¸­</p>
                        <p class="text-sm mt-2">æ•¬è¯·æœŸå¾…</p>
                    </div>
                `;
            }
        }

        function escapeHtml(text) {
            if (!text) return '';
            const div = document.createElement('div');
            div.textContent = text;
            return div.innerHTML;
        }

        function stripHtml(html) {
            if (!html) return '';
            const tmp = document.createElement('div');
            tmp.innerHTML = html;
            return tmp.textContent || tmp.innerText || '';
        }

        function formatTime(dateStr) {
            if (!dateStr) return '';
            const date = new Date(dateStr);
            const now = new Date();
            const diff = (now - date) / 1000;
            
            if (diff < 60) return 'åˆšåˆš';
            if (diff < 3600) return `${Math.floor(diff/60)}åˆ†é’Ÿå‰`;
            if (diff < 86400) return `${Math.floor(diff/3600)}å°æ—¶å‰`;
            if (diff < 604800) return `${Math.floor(diff/86400)}å¤©å‰`;
            return date.toLocaleDateString('zh-CN', {month: 'short', day: 'numeric'});
        }

        document.addEventListener('keydown', (e) => {
            if (e.key === 'Escape') {
                closeArticle();
                backToTeamDetail();
                backToTeamList();
                backToBookshelf();
            }
        });
    </script>
</body>
</html>
