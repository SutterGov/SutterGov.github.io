<!DOCTYPE html>
<html lang="zh-CN" class="scroll-smooth">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>加西亚足球APP</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.sheetjs.com/xlsx-0.20.1/package/dist/xlsx.full.min.js"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <script>
        tailwind.config = {
            darkMode: 'class',
            theme: {
                extend: {
                    colors: {
                        primary: '#1e3a5f',
                        accent: '#c9a227',
                        dark: { bg: '#121212', surface: '#1e1e1e', border: '#2c2c2c' }
                    }
                }
            }
        }
    </script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Noto+Sans+SC:wght@400;500;700&display=swap');
        * { scrollbar-width: none !important; -ms-overflow-style: none !important; }
        *::-webkit-scrollbar { display: none !important; width: 0 !important; height: 0 !important; }
        html, body { font-family: 'Noto Sans SC', -apple-system, BlinkMacSystemFont, sans-serif; -webkit-tap-highlight-color: transparent; overflow-x: hidden; }
        body { scrollbar-width: none; -ms-overflow-style: none; }
        body::-webkit-scrollbar { display: none; }
        .news-card { transition: all 0.2s ease; }
        .news-card:active { transform: scale(0.98); opacity: 0.9; }
        .tag-active { position: relative; }
        .tag-active::after { content: ''; position: absolute; bottom: -8px; left: 50%; transform: translateX(-50%); width: 20px; height: 3px; background-color: #10b981; border-radius: 2px; }
        .line-clamp-2 { display: -webkit-box; -webkit-line-clamp: 2; -webkit-box-orient: vertical; overflow: hidden; }
        .bottom-nav-item { transition: all 0.2s; }
        .bottom-nav-item.active { color: #10b981; }
        .fade-in { animation: fadeIn 0.3s ease-out; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
        .pull-refresh { position: absolute; top: -60px; left: 0; right: 0; height: 60px; display: flex; align-items: center; justify-content: center; transition: transform 0.3s; }
        .pull-refresh-spinner { width: 24px; height: 24px; border: 2px solid #e5e7eb; border-top-color: #10b981; border-radius: 50%; animation: spin 1s linear infinite; }
        @keyframes spin { to { transform: rotate(360deg); } }
        .refresh-toast { position: fixed; top: 100px; left: 50%; transform: translateX(-50%) translateY(-100px); background: rgba(16, 185, 129, 0.95); color: white; padding: 8px 16px; border-radius: 20px; font-size: 14px; opacity: 0; transition: all 0.3s; z-index: 100; pointer-events: none; }
        .refresh-toast.show { transform: translateX(-50%) translateY(0); opacity: 1; }
        .scroll-container { overflow-y: auto; scrollbar-width: none; -ms-overflow-style: none; }
        .scroll-container::-webkit-scrollbar { display: none; }
        .team-header { background: linear-gradient(135deg, #1e3a5f 0%, #2c5282 100%); }
        .team-logo-large { filter: drop-shadow(0 4px 6px rgba(0,0,0,0.3)); }
        .stat-card { background: rgba(255,255,255,0.1); backdrop-filter: blur(10px); }
        .player-card { transition: all 0.2s; }
        .player-card:active { transform: scale(0.98); }
        .position-badge { font-size: 10px; padding: 2px 6px; border-radius: 4px; font-weight: 600; }
        .position-gk { background: #fbbf24; color: #92400e; }
        .position-df { background: #3b82f6; color: white; }
        .position-mf { background: #10b981; color: white; }
        .position-fw { background: #ef4444; color: white; }
        .rating-badge { background: linear-gradient(135deg, #10b981 0%, #059669 100%); color: white; font-weight: bold; }
        .tab-active { color: #10b981; border-bottom: 2px solid #10b981; }
        .team-logo-container { display: flex; align-items: center; justify-content: center; overflow: hidden; }
        .team-logo-container img { max-width: 100%; max-height: 100%; object-fit: contain; }
        .team-logo-list { width: 64px; height: 64px; flex-shrink: 0; }
        .team-logo-detail { width: 80px; height: 80px; flex-shrink: 0; }
        .team-logo-small { width: 20px; height: 20px; flex-shrink: 0; }
        .team-logo-match { width: 40px; height: 40px; flex-shrink: 0; }
        .news-team-tag { display: inline-flex; align-items: center; gap: 4px; padding: 2px 8px; background: rgba(16, 185, 129, 0.1); border: 1px solid rgba(16, 185, 129, 0.3); border-radius: 12px; font-size: 11px; color: #10b981; cursor: pointer; transition: all 0.2s; }
        .news-team-tag:hover { background: rgba(16, 185, 129, 0.2); }
        .news-team-tag img { width: 16px; height: 16px; object-fit: contain; }
        .financial-warning { background: linear-gradient(90deg, #fef2f2 0%, #fee2e2 100%); border-left: 4px solid #ef4444; color: #dc2626; padding: 10px 16px; font-size: 13px; font-weight: 500; display: flex; align-items: center; gap: 8px; }
        .dark .financial-warning { background: linear-gradient(90deg, #450a0a 0%, #7f1d1d 100%); color: #fca5a5; }
        .article-page { transform: translateX(100%); transition: transform 0.3s ease-out; }
        .article-page.show { transform: translateX(0); }
        .search-overlay { position: fixed; inset: 0; background: rgba(0,0,0,0.5); z-index: 100; opacity: 0; visibility: hidden; transition: all 0.3s; }
        .search-overlay.show { opacity: 1; visibility: visible; }
        .search-page { position: fixed; inset: 0; background: #f3f4f6; z-index: 101; transform: translateY(100%); transition: transform 0.3s ease; display: flex; flex-direction: column; }
        .dark .search-page { background: #121212; }
        .search-page.show { transform: translateY(0); }
        .search-header { background: white; padding: 12px 16px; display: flex; align-items: center; gap: 12px; border-bottom: 1px solid #e5e7eb; }
        .dark .search-header { background: #1e1e1e; border-color: #2c2c2c; }
        .search-input-wrapper { flex: 1; position: relative; }
        .search-input { width: 100%; background: #f3f4f6; border: none; border-radius: 20px; padding: 10px 40px 10px 16px; font-size: 15px; outline: none; transition: all 0.2s; }
        .dark .search-input { background: #2c2c2c; color: white; }
        .search-input:focus { background: #e5e7eb; }
        .search-clear { position: absolute; right: 8px; top: 50%; transform: translateY(-50%); width: 24px; height: 24px; border-radius: 50%; background: #9ca3af; color: white; display: flex; align-items: center; justify-content: center; cursor: pointer; opacity: 0; transition: opacity 0.2s; font-size: 12px; }
        .search-clear.show { opacity: 1; }
        .search-cancel { color: #6b7280; font-size: 15px; padding: 4px 8px; cursor: pointer; }
        .search-tabs { display: flex; background: white; border-bottom: 1px solid #e5e7eb; padding: 0 16px; }
        .dark .search-tabs { background: #1e1e1e; border-color: #2c2c2c; }
        .search-tab { padding: 12px 16px; font-size: 14px; color: #6b7280; cursor: pointer; position: relative; font-weight: 500; }
        .search-tab.active { color: #10b981; }
        .search-tab.active::after { content: ''; position: absolute; bottom: 0; left: 16px; right: 16px; height: 2px; background: #10b981; border-radius: 2px; }
        .search-content { flex: 1; overflow-y: auto; padding: 16px; }
        .search-section-title { font-size: 13px; color: #9ca3af; margin-bottom: 12px; font-weight: 500; }
        .search-history-item { display: flex; align-items: center; justify-content: space-between; padding: 12px 0; border-bottom: 1px solid #f3f4f6; cursor: pointer; }
        .dark .search-history-item { border-color: #2c2c2c; }
        .search-result-item { background: white; border-radius: 12px; padding: 16px; margin-bottom: 12px; cursor: pointer; transition: all 0.2s; display: flex; align-items: center; gap: 12px; }
        .dark .search-result-item { background: #1e1e1e; }
        .search-result-item:active { transform: scale(0.98); opacity: 0.8; }
        .search-hot-item { display: inline-flex; align-items: center; gap: 6px; padding: 8px 16px; background: white; border-radius: 20px; margin: 0 8px 8px 0; font-size: 13px; cursor: pointer; transition: all 0.2s; }
        .dark .search-hot-item { background: #1e1e1e; }
        .search-hot-item:active { background: #10b981; color: white; }
        .search-highlight { color: #10b981; font-weight: 600; }
        .data-section { background: white; border-radius: 12px; padding: 16px; margin-bottom: 16px; }
        .dark .data-section { background: #1e1e1e; }
        .data-section-title { font-size: 14px; font-weight: bold; color: #374151; margin-bottom: 12px; padding-bottom: 8px; border-bottom: 1px solid #e5e7eb; }
        .dark .data-section-title { color: #e5e7eb; border-color: #374151; }
        .ranking-chart-container { width: 100%; height: 200px; position: relative; }
        .ranking-chart-container canvas { width: 100% !important; height: 100% !important; }
        .scorer-item { display: flex; justify-content: space-between; padding: 8px 0; border-bottom: 1px solid #f3f4f6; }
        .dark .scorer-item { border-color: #374151; }
        .scorer-item:last-child { border-bottom: none; }
        .honor-item { display: flex; align-items: center; gap: 8px; padding: 6px 0; }
        .honor-badge { background: #fbbf24; color: #92400e; padding: 2px 8px; border-radius: 4px; font-size: 12px; font-weight: bold; }
        .honor-badge.second { background: #9ca3af; color: #1f2937; }
        .honor-badge.third { background: #b45309; color: white; }
        .change-text { line-height: 1.6; color: #4b5563; }
        .dark .change-text { color: #9ca3af; }
        
        /* 比赛页面样式 */
        .match-league-header { background: linear-gradient(135deg, #1e3a5f 0%, #2c5282 100%); color: white; padding: 12px 16px; font-weight: bold; }
        .match-round-header { background: #f3f4f6; padding: 8px 16px; font-size: 13px; color: #6b7280; font-weight: 500; }
        .dark .match-round-header { background: #1e1e1e; color: #9ca3af; }
        .match-item { background: white; padding: 16px; border-bottom: 1px solid #f3f4f6; display: flex; align-items: center; justify-content: space-between; }
        .dark .match-item { background: #1e1e1e; border-color: #2c2c2c; }
        .match-item:last-child { border-bottom: none; }
        .match-team { display: flex; align-items: center; gap: 8px; flex: 1; }
        .match-team.home { justify-content: flex-end; text-align: right; }
        .match-team.away { justify-content: flex-start; text-align: left; }
        .match-score { display: flex; flex-direction: column; align-items: center; padding: 0 16px; min-width: 80px; }
        .match-score-number { font-size: 20px; font-weight: bold; color: #1f2937; }
        .dark .match-score-number { color: #f3f4f6; }
        .match-time { font-size: 12px; color: #9ca3af; }
        .match-status { font-size: 11px; padding: 2px 8px; border-radius: 10px; background: #10b981; color: white; }
        .match-status.finished { background: #6b7280; }
        .match-status.upcoming { background: #3b82f6; }
        .match-league-tabs { display: flex; overflow-x: auto; background: white; border-bottom: 1px solid #e5e7eb; }
        .dark .match-league-tabs { background: #1e1e1e; border-color: #2c2c2c; }
        .match-league-tab { padding: 12px 20px; font-size: 14px; white-space: nowrap; cursor: pointer; border-bottom: 2px solid transparent; }
        .match-league-tab.active { color: #10b981; border-bottom-color: #10b981; font-weight: 600; }
        .dark .match-league-tab { color: #9ca3af; }
        .dark .match-league-tab.active { color: #10b981; }
        
        /* 赛季选择器样式 */
        .season-selector { 
            display: flex; 
            align-items: center; 
            justify-content: center; 
            padding: 8px 16px; 
            background: white; 
            border-bottom: 1px solid #e5e7eb; 
        }
        .dark .season-selector { background: #1e1e1e; border-color: #2c2c2c; }
        .season-dropdown { 
            display: flex; 
            align-items: center; 
            gap: 8px; 
            padding: 6px 16px; 
            background: #f3f4f6; 
            border-radius: 20px; 
            font-size: 14px; 
            font-weight: 500; 
            color: #374151; 
            cursor: pointer; 
            border: none; 
            outline: none;
        }
        .dark .season-dropdown { background: #2c2c2c; color: #e5e7eb; }
        
        /* 数据页面样式 */
        .data-filter-bar { 
            display: flex; 
            gap: 8px; 
            padding: 12px 16px; 
            background: white; 
            border-bottom: 1px solid #e5e7eb; 
            overflow-x: auto; 
        }
        .dark .data-filter-bar { background: #1e1e1e; border-color: #2c2c2c; }
        .data-filter-btn { 
            padding: 6px 14px; 
            background: #f3f4f6; 
            border-radius: 16px; 
            font-size: 13px; 
            white-space: nowrap; 
            cursor: pointer; 
            transition: all 0.2s; 
            border: none;
            color: #6b7280;
        }
        .dark .data-filter-btn { background: #2c2c2c; color: #9ca3af; }
        .data-filter-btn.active { background: #10b981; color: white; }
        .youth-level-badge { 
            display: inline-flex; 
            align-items: center; 
            padding: 4px 10px; 
            border-radius: 12px; 
            font-size: 12px; 
            font-weight: 600; 
        }
        .youth-s { background: linear-gradient(135deg, #fbbf24 0%, #f59e0b 100%); color: white; }
        .youth-a { background: linear-gradient(135deg, #10b981 0%, #059669 100%); color: white; }
        .youth-b { background: linear-gradient(135deg, #3b82f6 0%, #2563eb 100%); color: white; }
        .youth-c { background: linear-gradient(135deg, #6b7280 0%, #4b5563 100%); color: white; }
        .youth-d { background: linear-gradient(135deg, #9ca3af 0%, #6b7280 100%); color: white; }
        
        /* 赛程样式 - 懂球帝风格 */
        .schedule-month-header { 
            background: #f3f4f6; 
            padding: 8px 16px; 
            font-size: 14px; 
            font-weight: 600; 
            color: #6b7280; 
            position: sticky; 
            top: 0; 
            z-index: 10;
        }
        .dark .schedule-month-header { background: #1e1e1e; color: #9ca3af; }
        .schedule-item { 
            background: white; 
            padding: 16px; 
            border-bottom: 1px solid #f3f4f6; 
            display: flex; 
            align-items: center; 
        }
        .dark .schedule-item { background: #1e1e1e; border-color: #2c2c2c; }
        .schedule-date { 
            width: 60px; 
            text-align: center; 
            flex-shrink: 0; 
        }
        .schedule-date-day { 
            font-size: 24px; 
            font-weight: bold; 
            color: #1f2937; 
            line-height: 1; 
        }
        .dark .schedule-date-day { color: #f3f4f6; }
        .schedule-date-week { 
            font-size: 12px; 
            color: #9ca3af; 
            margin-top: 2px; 
        }
        .schedule-info { 
            flex: 1; 
            padding: 0 12px; 
        }
        .schedule-league { 
            font-size: 12px; 
            color: #10b981; 
            margin-bottom: 4px; 
            font-weight: 500;
        }
        .schedule-teams { 
            display: flex; 
            align-items: center; 
            gap: 8px; 
        }
        .schedule-team { 
            display: flex; 
            align-items: center; 
            gap: 6px; 
            flex: 1; 
        }
        .schedule-team.home { justify-content: flex-end; }
        .schedule-team.away { justify-content: flex-start; }
        .schedule-team-name { 
            font-size: 14px; 
            font-weight: 500; 
            color: #1f2937; 
        }
        .dark .schedule-team-name { color: #f3f4f6; }
        .schedule-score { 
            font-size: 18px; 
            font-weight: bold; 
            color: #1f2937; 
            min-width: 60px; 
            text-align: center; 
        }
        .dark .schedule-score { color: #f3f4f6; }
        .schedule-result { 
            font-size: 12px; 
            padding: 2px 8px; 
            border-radius: 4px; 
            font-weight: 500; 
        }
        .result-win { background: #dcfce7; color: #166534; }
        .dark .result-win { background: #166534; color: #dcfce7; }
        .result-draw { background: #f3f4f6; color: #6b7280; }
        .dark .result-draw { background: #374151; color: #9ca3af; }
        .result-loss { background: #fee2e2; color: #dc2626; }
        .dark .result-loss { background: #7f1d1d; color: #fca5a5; }
        .result-upcoming { color: #9ca3af; }
        
        .pagination { 
            display: flex; 
            justify-content: center; 
            align-items: center; 
            gap: 16px; 
            padding: 16px; 
        }
        .pagination-btn { 
            padding: 8px 16px; 
            background: #10b981; 
            color: white; 
            border-radius: 8px; 
            font-size: 14px; 
            cursor: pointer; 
            border: none; 
        }
        .pagination-btn:disabled { 
            background: #9ca3af; 
            cursor: not-allowed; 
        }
        .pagination-info { 
            font-size: 14px; 
            color: #6b7280; 
        }
        .dark .pagination-info { color: #9ca3af; }
    </style>
</head>
<body class="bg-gray-50 dark:bg-dark-bg text-gray-900 dark:text-gray-100 transition-colors duration-300 pb-16">
    <div id="refreshToast" class="refresh-toast"><i class="fas fa-check-circle mr-1"></i> 已更新</div>
    <div id="searchOverlay" class="search-overlay" onclick="closeSearch()"></div>
    <div id="searchPage" class="search-page">
        <div class="search-header">
            <div class="search-input-wrapper">
                <input type="text" id="searchInput" class="search-input" placeholder="搜索球队、球员、新闻..." oninput="handleSearchInput(this.value)" onkeyup="handleSearchKeyup(event)">
                <div id="searchClear" class="search-clear" onclick="clearSearch()"><i class="fas fa-times"></i></div>
            </div>
            <div class="search-cancel" onclick="closeSearch()">取消</div>
        </div>
        <div class="search-tabs">
            <div class="search-tab active" onclick="switchSearchTab('all')" data-tab="all">综合</div>
            <div class="search-tab" onclick="switchSearchTab('team')" data-tab="team">球队</div>
            <div class="search-tab" onclick="switchSearchTab('player')" data-tab="player">球员</div>
            <div class="search-tab" onclick="switchSearchTab('news')" data-tab="news">新闻</div>
        </div>
        <div id="searchContent" class="search-content"></div>
    </div>

    <div class="sticky top-0 z-50 bg-white dark:bg-dark-surface border-b border-gray-200 dark:border-dark-border transition-colors duration-300" id="mainHeader">
        <div class="flex justify-between items-center px-4 py-1 text-xs text-gray-500 dark:text-gray-400">
            <span id="clock">16:10</span>
            <div class="flex items-center gap-1">
                <span id="syncStatus" class="text-gray-400 dark:text-gray-500 text-[10px] mr-2">等待刷新</span>
                <span>5G</span><i class="fas fa-signal"></i><i class="fas fa-wifi"></i><i class="fas fa-battery-full"></i>
            </div>
        </div>
        <div class="px-4 py-2 flex items-center gap-3">
            <div class="w-8 h-8 rounded-full bg-gray-200 dark:bg-gray-700 flex items-center justify-center overflow-hidden">
                <img src="https://suttergov.github.io/十周年纪念.png" alt="avatar" class="w-full h-full object-cover">
            </div>
            <div class="flex-1 relative" onclick="openSearch()">
                <div class="w-full bg-gray-100 dark:bg-dark-border text-sm px-4 py-2 rounded-full flex items-center text-gray-400 cursor-pointer">
                    <i class="fas fa-search mr-2"></i><span>搜索球队、球员、新闻...</span>
                </div>
            </div>
            <button onclick="toggleTheme()" class="w-8 h-8 flex items-center justify-center text-gray-600 dark:text-gray-300">
                <i class="fas fa-moon dark:hidden"></i><i class="fas fa-sun hidden dark:block text-yellow-400"></i>
            </button>
        </div>
        <div id="homeTabs" class="flex overflow-x-auto px-2 py-2 gap-6 text-sm font-medium border-t border-gray-100 dark:border-dark-border">
            <button onclick="filterByTag('all')" class="tag-btn tag-active text-emerald-600 dark:text-emerald-400 whitespace-nowrap px-2" data-tag="all">全部</button>
            <button onclick="filterByTag('match')" class="tag-btn text-gray-600 dark:text-gray-400 whitespace-nowrap px-2" data-tag="match">战报</button>
            <button onclick="filterByTag('transfer')" class="tag-btn text-gray-600 dark:text-gray-400 whitespace-nowrap px-2" data-tag="transfer">转会</button>
            <button onclick="filterByTag('official')" class="tag-btn text-gray-600 dark:text-gray-400 whitespace-nowrap px-2" data-tag="official">公告</button>
            <button onclick="filterByTag('analysis')" class="tag-btn text-gray-600 dark:text-gray-400 whitespace-nowrap px-2" data-tag="analysis">分析</button>
        </div>
    </div>

    <div id="refreshContainer" class="relative">
        <div id="pullIndicator" class="pull-refresh">
            <div id="pullSpinner" class="pull-refresh-spinner hidden"></div>
            <div id="pullText" class="text-gray-500 dark:text-gray-400 text-sm"><i class="fas fa-arrow-down mr-1"></i> 下拉刷新</div>
        </div>
        <main id="newsFeed" class="divide-y divide-gray-200 dark:divide-dark-border min-h-[60vh] scroll-container"></main>
        
        <!-- 比赛页面 -->
        <div id="matchPage" class="hidden min-h-[60vh] scroll-container bg-gray-100 dark:bg-dark-bg">
            <div id="matchLeagueTabs" class="match-league-tabs sticky top-0 z-40"></div>
            <div id="seasonSelector" class="season-selector">
                <select id="seasonDropdown" class="season-dropdown" onchange="changeSeason(this.value)">
                    <option value="all">全部赛季</option>
                </select>
            </div>
            <div id="matchContent" class="pb-4"></div>
        </div>
        
        <!-- 数据页面 -->
        <div id="dataPage" class="hidden min-h-[60vh] scroll-container bg-gray-100 dark:bg-dark-bg">
            <div class="data-filter-bar sticky top-0 z-40">
                <button onclick="switchDataTab('youth')" class="data-filter-btn active" id="youthTabBtn">青训等级</button>
                <button onclick="switchDataTab('players')" class="data-filter-btn" id="playersTabBtn">球员数据</button>
            </div>
            <div id="youthContent" class="p-4"></div>
            <div id="playersContent" class="hidden">
                <div class="p-4 space-y-3">
                    <div class="bg-white dark:bg-dark-surface rounded-lg p-4">
                        <div class="text-sm font-bold mb-3 dark:text-gray-200">筛选条件</div>
                        <div class="space-y-3">
                            <div>
                                <div class="text-xs text-gray-500 mb-2">合同到期赛季</div>
                                <select id="contractSeasonFilter" class="w-full p-2 bg-gray-100 dark:bg-dark-border rounded-lg text-sm dark:text-gray-200" onchange="applyPlayerFilters()">
                                    <option value="all">全部赛季</option>
                                </select>
                            </div>
                            <div>
                                <div class="text-xs text-gray-500 mb-2">国籍</div>
                                <select id="nationFilter" class="w-full p-2 bg-gray-100 dark:bg-dark-border rounded-lg text-sm dark:text-gray-200" onchange="applyPlayerFilters()">
                                    <option value="all">全部国籍</option>
                                </select>
                            </div>
                            <div>
                                <div class="text-xs text-gray-500 mb-2">排序方式</div>
                                <div class="flex gap-2 flex-wrap">
                                    <button onclick="setPlayerSort('ca-desc')" class="sort-btn px-3 py-1 bg-gray-100 dark:bg-dark-border rounded-full text-xs" data-sort="ca-desc">CA ↓</button>
                                    <button onclick="setPlayerSort('pa-desc')" class="sort-btn px-3 py-1 bg-gray-100 dark:bg-dark-border rounded-full text-xs" data-sort="pa-desc">PA ↓</button>
                                    <button onclick="setPlayerSort('age-desc')" class="sort-btn px-3 py-1 bg-gray-100 dark:bg-dark-border rounded-full text-xs" data-sort="age-desc">年龄 ↓</button>
                                    <button onclick="setPlayerSort('age-asc')" class="sort-btn px-3 py-1 bg-gray-100 dark:bg-dark-border rounded-full text-xs" data-sort="age-asc">年龄 ↑</button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div id="playersListContainer" class="px-4 pb-4"></div>
                <div id="playersPagination" class="pagination"></div>
            </div>
        </div>
        
        <div id="teamPage" class="hidden min-h-[60vh] scroll-container bg-gray-100 dark:bg-dark-bg">
            <div id="teamList" class="p-4 grid grid-cols-1 gap-3"></div>
        </div>
        <div id="teamDetailPage" class="hidden fixed inset-0 z-50 bg-gray-100 dark:bg-dark-bg scroll-container">
            <div class="team-header text-white relative overflow-hidden">
                <div class="absolute inset-0 bg-gradient-to-b from-transparent to-black/50"></div>
                <div class="relative z-10 flex items-center justify-between px-4 py-3">
                    <button onclick="backToTeamList()" class="w-10 h-10 flex items-center justify-center rounded-full bg-white/20 backdrop-blur"><i class="fas fa-arrow-left"></i></button>
                    <span class="font-medium">球队详情</span>
                    <button onclick="shareTeam()" class="w-10 h-10 flex items-center justify-center rounded-full bg-white/20 backdrop-blur"><i class="fas fa-share-alt"></i></button>
                </div>
                <div class="relative z-10 px-4 pb-6 pt-2">
                    <div class="flex items-center gap-4">
                        <div class="team-logo-container team-logo-detail bg-white/10 rounded-lg p-2">
                            <img id="teamDetailLogo" src="" alt="" class="team-logo-large">
                        </div>
                        <div class="flex-1">
                            <h1 id="teamDetailName" class="text-2xl font-bold mb-1"></h1>
                            <p id="teamDetailNameEn" class="text-sm opacity-80 mb-2"></p>
                            <div class="flex items-center gap-2 text-xs flex-wrap">
                                <span class="bg-white/20 px-2 py-1 rounded">加超联</span>
                                <span id="teamDetailCoach" class="bg-white/20 px-2 py-1 rounded"></span>
                            </div>
                        </div>
                    </div>
                    <div class="grid grid-cols-3 gap-2 mt-4">
                        <div class="stat-card rounded-lg p-3 text-center"><div class="text-xs opacity-80">球队资金</div><div class="text-lg font-bold" id="teamDetailFunds"></div></div>
                        <div class="stat-card rounded-lg p-3 text-center"><div class="text-xs opacity-80">场均上座</div><div class="text-lg font-bold" id="teamDetailAttendance"></div></div>
                        <div class="stat-card rounded-lg p-3 text-center"><div class="text-xs opacity-80">上座率</div><div class="text-lg font-bold" id="teamDetailOccupancy"></div></div>
                        <div class="stat-card rounded-lg p-3 text-center"><div class="text-xs opacity-80">球场容量</div><div class="text-lg font-bold" id="teamDetailCapacity"></div></div>
                        <div class="stat-card rounded-lg p-3 text-center"><div class="text-xs opacity-80">球队总年薪</div><div class="text-lg font-bold" id="teamDetailWages"></div></div>
                        <div class="stat-card rounded-lg p-3 text-center"><div class="text-xs opacity-80">预计季末资金</div><div class="text-lg font-bold" id="teamDetailProjected"></div></div>
                    </div>
                    <div id="financialWarning" class="hidden mt-3 rounded-lg financial-warning"><i class="fas fa-exclamation-triangle"></i><span>球队资金情况危险，可能无法通过准入</span></div>
                </div>
            </div>
            <div class="bg-white dark:bg-dark-surface border-b border-gray-200 dark:border-dark-border sticky top-0 z-40">
                <div class="flex">
                    <button onclick="switchTeamTab('squad')" class="team-tab flex-1 py-3 text-sm font-medium text-center tab-active" data-tab="squad">阵容</button>
                    <button onclick="switchTeamTab('stats')" class="team-tab flex-1 py-3 text-sm font-medium text-center text-gray-500 dark:text-gray-400" data-tab="stats">数据</button>
                    <button onclick="switchTeamTab('schedule')" class="team-tab flex-1 py-3 text-sm font-medium text-center text-gray-500 dark:text-gray-400" data-tab="schedule">赛程</button>
                    <button onclick="switchTeamTab('news')" class="team-tab flex-1 py-3 text-sm font-medium text-center text-gray-500 dark:text-gray-400" data-tab="news">动态</button>
                </div>
            </div>
            <div id="squadContent" class="p-4">
                <div class="mb-4">
                    <h3 class="text-sm font-bold text-gray-500 dark:text-gray-400 mb-2 uppercase tracking-wider">主教练</h3>
                    <div onclick="openCoachDetail()" class="bg-white dark:bg-dark-surface rounded-lg p-4 flex items-center justify-between shadow-sm cursor-pointer active:scale-95 transition-transform">
                        <div id="coachCard" class="flex-1"></div><i class="fas fa-chevron-right text-gray-400 dark:text-gray-500 ml-2"></i>
                    </div>
                </div>
                <div id="playersList"></div>
            </div>
            <div id="statsContent" class="hidden p-4"></div>
            <div id="scheduleContent" class="hidden p-4"></div>
            <div id="newsContent" class="hidden p-4"><div id="teamNewsList" class="space-y-3"></div></div>
        </div>
        <div id="coachDetailPage" class="hidden fixed inset-0 z-[60] bg-gray-100 dark:bg-dark-bg scroll-container">
            <div class="bg-white dark:bg-dark-surface border-b border-gray-200 dark:border-dark-border px-4 py-3 flex items-center sticky top-0 z-50">
                <button onclick="backToTeamDetailFromCoach()" class="w-10 h-10 flex items-center justify-center -ml-2"><i class="fas fa-arrow-left text-gray-600 dark:text-gray-300"></i></button>
                <span class="font-medium ml-2 dark:text-gray-100">教练团队</span>
            </div>
            <div id="coachList" class="p-4 space-y-3"></div>
        </div>
        <div id="playerDetailPage" class="hidden fixed inset-0 z-[70] bg-gray-100 dark:bg-dark-bg scroll-container">
            <div class="relative bg-gradient-to-br from-emerald-600 to-emerald-800 text-white">
                <div class="flex items-center justify-between px-4 py-3">
                    <button onclick="backToTeamDetail()" class="w-10 h-10 flex items-center justify-center rounded-full bg-white/20 backdrop-blur"><i class="fas fa-arrow-left"></i></button>
                    <span class="font-medium">球员详情</span>
                    <button onclick="sharePlayer()" class="w-10 h-10 flex items-center justify-center rounded-full bg-white/20 backdrop-blur"><i class="fas fa-share-alt"></i></button>
                </div>
                <div class="px-4 pb-6 flex items-end gap-4">
                    <div class="w-24 h-24 rounded-lg bg-white/20 flex items-center justify-center text-4xl font-bold"><span id="playerInitial"></span></div>
                    <div class="flex-1 pb-1">
                        <div class="flex items-center gap-2 mb-1"><span id="playerDetailPosition" class="position-badge"></span></div>
                        <h1 id="playerDetailName" class="text-2xl font-bold mb-1"></h1>
                        <p id="playerDetailTeam" class="text-sm opacity-80"></p>
                    </div>
                </div>
            </div>
            <div class="p-4 space-y-4">
                <div class="bg-white dark:bg-dark-surface rounded-lg p-4 shadow-sm">
                    <h3 class="font-bold mb-3 dark:text-gray-200">能力评估</h3>
                    <div class="flex items-center justify-center mb-4"><div class="w-24 h-24 rounded-full rating-badge flex items-center justify-center text-3xl" id="playerDetailRating"></div></div>
                    <div class="grid grid-cols-2 gap-3 text-sm">
                        <div class="flex justify-between py-2 border-b border-gray-100 dark:border-dark-border"><span class="text-gray-500">当前能力(CA)</span><span class="font-bold" id="playerDetailCA"></span></div>
                        <div class="flex justify-between py-2 border-b border-gray-100 dark:border-dark-border"><span class="text-gray-500">潜力(PA)</span><span class="font-bold text-emerald-600" id="playerDetailPA"></span></div>
                        <div class="flex justify-between py-2 border-b border-gray-100 dark:border-dark-border"><span class="text-gray-500">年龄</span><span class="font-bold" id="playerDetailAge"></span></div>
                        <div class="flex justify-between py-2 border-b border-gray-100 dark:border-dark-border"><span class="text-gray-500">国籍</span><span class="font-bold" id="playerDetailNation"></span></div>
                        <div class="flex justify-between py-2 border-b border-gray-100 dark:border-dark-border"><span class="text-gray-500">身高</span><span class="font-bold" id="playerDetailHeight"></span></div>
                        <div class="flex justify-between py-2 border-b border-gray-100 dark:border-dark-border"><span class="text-gray-500">体重</span><span class="font-bold" id="playerDetailWeight"></span></div>
                    </div>
                </div>
                <div class="bg-white dark:bg-dark-surface rounded-lg p-4 shadow-sm"><h3 class="font-bold mb-3 dark:text-gray-200">可打位置</h3><div id="playerAllPositions" class="flex flex-wrap gap-2"></div></div>
                <div class="bg-white dark:bg-dark-surface rounded-lg p-4 shadow-sm">
                    <h3 class="font-bold mb-3 dark:text-gray-200">合同信息</h3>
                    <div class="space-y-2 text-sm">
                        <div class="flex justify-between py-2 border-b border-gray-100 dark:border-dark-border"><span class="text-gray-500">所在球队</span><span class="font-bold" id="playerDetailTeam2"></span></div>
                        <div class="flex justify-between py-2 border-b border-gray-100 dark:border-dark-border"><span class="text-gray-500">合约到期</span><span class="font-bold" id="playerDetailContract"></span></div>
                        <div class="flex justify-between py-2 border-b border-gray-100 dark:border-dark-border"><span class="text-gray-500">年薪</span><span class="font-bold text-emerald-600" id="playerDetailWage"></span></div>
                        <div class="flex justify-between py-2"><span class="text-gray-500">违约金</span><span class="font-bold text-red-500" id="playerDetailClause"></span></div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <div id="articlePage" class="article-page fixed inset-0 z-50 bg-white dark:bg-dark-bg scroll-container">
        <div class="sticky top-0 bg-white/95 dark:bg-dark-surface/95 backdrop-blur border-b border-gray-200 dark:border-dark-border px-4 py-2 flex items-center justify-between">
            <button onclick="closeArticle()" class="w-8 h-8 flex items-center justify-center text-gray-600 dark:text-gray-300"><i class="fas fa-arrow-left text-lg"></i></button>
            <span class="font-medium text-sm dark:text-gray-200">加西亚足球APP</span>
            <button onclick="shareArticle()" class="w-8 h-8 flex items-center justify-center text-gray-600 dark:text-gray-300"><i class="fas fa-share-alt"></i></button>
        </div>
        <article id="articleContent" class="p-4"></article>
    </div>
    <nav class="fixed bottom-0 left-0 right-0 bg-white dark:bg-dark-surface border-t border-gray-200 dark:border-dark-border px-6 py-2 flex justify-between items-center z-40 transition-colors duration-300">
        <button onclick="switchTab('home')" class="bottom-nav-item active flex flex-col items-center gap-1 text-emerald-600 dark:text-emerald-400" data-tab="home"><i class="fas fa-home text-xl"></i><span class="text-xs">首页</span></button>
        <button onclick="switchTab('match')" class="bottom-nav-item flex flex-col items-center gap-1 text-gray-400 dark:text-gray-500" data-tab="match"><i class="fas fa-trophy text-xl"></i><span class="text-xs">比赛</span></button>
        <button onclick="switchTab('team')" class="bottom-nav-item flex flex-col items-center gap-1 text-gray-400 dark:text-gray-500" data-tab="team"><i class="fas fa-shield-alt text-xl"></i><span class="text-xs">球队</span></button>
        <button onclick="switchTab('video')" class="bottom-nav-item flex flex-col items-center gap-1 text-gray-400 dark:text-gray-500" data-tab="video"><i class="fas fa-play-circle text-xl"></i><span class="text-xs">视频</span></button>
        <button onclick="switchTab('data')" class="bottom-nav-item flex flex-col items-center gap-1 text-gray-400 dark:text-gray-500" data-tab="data"><i class="fas fa-chart-line text-xl"></i><span class="text-xs">数据</span></button>
    </nav>
    <script>
        const CONFIG = {
            owner: 'SutterGov',
            repo: 'SutterGov.github.io',
            branch: 'main',
            rssPath: 'garciafootball.xml',
            excelUrl: 'https://suttergov.github.io/GarciaDatabase26.xlsx',
            teamHistoryUrl: 'https://suttergov.github.io/球队数据.txt',
            scheduleUrl: 'https://suttergov.github.io/赛程.txt',
            defaultLogo: 'https://free.boltp.com/2026/02/11/698ca73e5a316.webp'
        };

        const TEAM_LOGOS = {
            '南太平洋大学色温校区': 'https://suttergov.github.io/南太大新泰.png',
            '三宝敦': 'https://suttergov.github.io/三宝敦.png',
            '东平雄鹰': 'https://suttergov.github.io/东平雄鹰.png',
            '伊丽莎白女王镇联合': 'https://suttergov.github.io/伊丽莎白联合.png',
            '泰克马联合': 'https://suttergov.github.io/伊斯特伍德联合新2.png',
            '首都守护者': 'https://suttergov.github.io/哈卡拉托特卡11.png',
            '哈贾丹太平洋人': 'https://suttergov.github.io/哈贾丹太平洋人.png',
            '坎布尔新吕伐登': 'https://suttergov.github.io/坎布尔新吕伐登.png',
            '大同拜仁皇家加西亚': 'https://suttergov.github.io/大同拜仁皇家加西亚.png',
            '奥顿兰海港': 'https://suttergov.github.io/奥顿兰斯巴达克斯.png',
            '奥顿兰海鸥': 'https://suttergov.github.io/奥顿兰海港.png',
            '东木市职业': 'https://suttergov.github.io/孔恩度卢FC.png',
            '安倍萨镇': 'https://suttergov.github.io/安倍萨城.png',
            '拉阿纳': 'https://suttergov.github.io/拉阿纳城市竞技.png',
            '斯波托普城市': 'https://suttergov.github.io/斯波托普城市.png',
            '新吕伐登猫头鹰镇': 'https://suttergov.github.io/新吕伐登猫头鹰.png',
            '新南城': 'https://suttergov.github.io/新泰新3.png',
            '哈卡拉托特卡海牛': 'https://fclogo.top/_next/image?url=https%3A%2F%2Fcdn.sanity.io%2Fimages%2F11hmdf08%2Fproduction%2F2d2c10be4e5d9a91aada5021b9b551ebd88f3bdc-800x800.png%3Fw%3D800%26fm%3Dwebp%26q%3D80&w=828&q=75',
            '新达华哈海岸': 'https://suttergov.github.io/新达华哈海岸.png',
            '泰克马职业': 'https://suttergov.github.io/泰克马职业.png',
            '泰克马队': 'https://suttergov.github.io/泰克马队.png',
            '瓦巴萨朱树鸦': 'https://suttergov.github.io/瓦巴萨朱树鸦.png',
            '新泰泰山': 'https://suttergov.github.io/瓦巴萨朱艾奥纳尔.png',
            '皇家萨乌萨乌': 'https://suttergov.github.io/皇家萨乌萨乌.png',
            '穆拉哈西部': 'https://suttergov.github.io/穆拉哈西部.png',
            '色温岱州东岳': 'https://suttergov.github.io/色温岱州东岳.png',
            '巴峰': 'https://suttergov.github.io/萨乌萨乌新.png',
            '诺维奇港': 'https://suttergov.github.io/诺维奇港新.png',
            '北泰克马': 'https://suttergov.github.io/里拉赫飞燕.png',
            '阿尔特弗雷奇流浪者': 'https://suttergov.github.io/阿尔特弗雷奇流浪者.png',
            '马雷克青春之城': 'https://suttergov.github.io/马雷克新.png',
            '哈克竞技': 'https://suttergov.github.io/哈卡拉托特卡.png',
            '比列竞技': 'https://suttergov.github.io/比列竞技新.png',
            '朱马蓝色协进': 'https://suttergov.github.io/朱马蓝色协进.png',
            '伊斯特伍德竞技': 'https://suttergov.github.io/伊斯特伍德俱乐部.png',
            '比斯恰捍卫者': 'https://suttergov.github.io/比斯恰捍卫者.png',
            '新利雅得胜利': 'https://suttergov.github.io/普拉市民.png',
            '南比斯恰城市': 'https://suttergov.github.io/南比斯恰城市.png',
            '岱州东岳': 'https://suttergov.github.io/色温岱州东岳.png',
            '新利雅得新月': 'https://fclogo.top/_next/image?url=https%3A%2F%2Fcdn.sanity.io%2Fimages%2F11hmdf08%2Fproduction%2F8b173e002d366de185a0b51b67e71d230f63b72e-800x800.png%3Fw%3D800%26fm%3Dwebp%26q%3D80&w=828&q=75',
            '马雷克海岸线': 'https://suttergov.github.io/运动伊斯特伍德.png',
            '伊斯特伍德海岸线': 'https://suttergov.github.io/运动伊斯特伍德.png',
            '瓦巴萨朱城市': 'https://suttergov.github.io/瓦巴萨朱艾奥纳尔.png',
            '瓦巴萨朱树鸦B': 'https://suttergov.github.io/瓦巴萨朱树鸦.png',
            '三宝敦乐邦战士': 'https://suttergov.github.io/维尔图钢管.png',
            '首都-东木联合B': 'https://suttergov.github.io/哈卡拉托特卡11.png',
            '首都B': 'https://suttergov.github.io/哈卡拉托特卡11.png',
            '比列地平线': 'https://fclogo.top/_next/image?url=https%3A%2F%2Fcdn.sanity.io%2Fimages%2F11hmdf08%2Fproduction%2F2d2c10be4e5d9a91aada5021b9b551ebd88f3bdc-800x800.png%3Fw%3D800%26fm%3Dwebp%26q%3D80&w=828&q=75',
            '哈卡拉托特卡海牛': 'https://fclogo.top/_next/image?url=https%3A%2F%2Fcdn.sanity.io%2Fimages%2F11hmdf08%2Fproduction%2F2d2c10be4e5d9a91aada5021b9b551ebd88f3bdc-800x800.png%3Fw%3D800%26fm%3Dwebp%26q%3D80&w=828&q=75',
            '新法鲁联盟': 'https://suttergov.github.io/新法鲁新.png',
            '新利雅得阿尔希拉尔': 'https://fclogo.top/_next/image?url=https%3A%2F%2Fcdn.sanity.io%2Fimages%2F11hmdf08%2Fproduction%2F8b173e002d366de185a0b51b67e71d230f63b72e-800x800.png%3Fw%3D800%26fm%3Dwebp%26q%3D80&w=828&q=75',
            '加西亚国青队': 'https://suttergov.github.io/1500px-Naval_Flag_of_the_Kingdom_of_France_(Civil_Ensign).svg.png'
        };

        let currentTag = 'all', currentTab = 'home', rssData = [], teamData = [], playersData = [];
        let currentTeam = null, currentCoaches = [], isRefreshing = false;
        let touchStartY = 0, touchCurrentY = 0, isPulling = false;
        const PULL_THRESHOLD = 80;
        let searchHistory = [], currentSearchTab = 'all';
        let searchHotWords = ['三宝敦', '泰克马联合', '转会', '战报', '大同拜仁', '哈贾丹'];
        let teamHistoryData = {};
        let scheduleData = [];
        let currentMatchLeague = 'all';
        let currentSeason = 'all';
        let currentDataTab = 'youth';
        let playerSort = 'ca-desc';
        let playerFilterSeason = 'all';
        let playerFilterNation = 'all';
        let playerPage = 1;
        const PLAYERS_PER_PAGE = 30;

        // 联赛排序权重
        const LEAGUE_ORDER = {
            '加超联': 1,
            '加甲联': 2,
            '加乙联': 3,
            '加冠联': 4,
            '足协杯': 5
        };

        document.addEventListener('DOMContentLoaded', () => {
            const cached = localStorage.getItem('rss_cache');
            if (cached) {
                try {
                    const { data } = JSON.parse(cached);
                    rssData = data;
                    renderNews();
                    updateSyncStatus('cached');
                } catch (e) {
                    showEmptyState();
                }
            } else {
                showEmptyState();
            }
            
            const savedHistory = localStorage.getItem('search_history');
            if (savedHistory) searchHistory = JSON.parse(savedHistory);
            
            const savedTeamHistory = localStorage.getItem('team_history_cache');
            if (savedTeamHistory) {
                try {
                    teamHistoryData = JSON.parse(savedTeamHistory);
                } catch (e) {
                    teamHistoryData = {};
                }
            }
            
            const savedSchedule = localStorage.getItem('schedule_cache');
            if (savedSchedule) {
                try {
                    scheduleData = JSON.parse(savedSchedule);
                } catch (e) {
                    scheduleData = [];
                }
            }
            
            updateClock();
            setInterval(updateClock, 1000);
            
            if (window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches) {
                document.documentElement.classList.add('dark');
            }
            
            initPullToRefresh();
        });

        async function loadScheduleData() {
            try {
                const response = await fetch(CONFIG.scheduleUrl + '?t=' + new Date().getTime(), {
                    method: 'GET',
                    signal: AbortSignal.timeout(10000)
                });
                
                if (!response.ok) throw new Error('无法加载赛程数据');
                
                const text = await response.text();
                scheduleData = parseScheduleData(text);
                localStorage.setItem('schedule_cache', JSON.stringify(scheduleData));
                localStorage.setItem('schedule_cache_time', new Date().toISOString());
                return scheduleData;
            } catch (error) {
                console.error('加载赛程数据失败:', error);
                return scheduleData;
            }
        }

        function parseScheduleData(text) {
            const data = [];
            const lines = text.split('\n');
            let currentLeague = null;
            let currentRound = null;
            let currentSeason = '';
            
            lines.forEach(line => {
                line = line.trim();
                if (!line) return;
                
                // 联赛标题 ==S4 加超联==
                if (line.startsWith('==') && line.endsWith('==')) {
                    const leagueMatch = line.match(/==S(\d+)\s+(.+)==/);
                    if (leagueMatch) {
                        currentSeason = 'S' + leagueMatch[1];
                        currentLeague = leagueMatch[2].trim();
                        currentRound = null;
                    }
                    return;
                }
                
                // 轮次标题 =第17轮=
                if (line.startsWith('=') && line.endsWith('=') && !line.startsWith('==')) {
                    currentRound = line.replace(/=/g, '').trim();
                    return;
                }
                
                // 比赛行
                if (currentLeague && line.includes('-')) {
                    // 检查是否有比分 (如 "3-0")
                    const scoreMatch = line.match(/(\d+)-(\d+)/);
                    let homeScore = null, awayScore = null;
                    let matchLine = line;
                    
                    if (scoreMatch) {
                        homeScore = parseInt(scoreMatch[1]);
                        awayScore = parseInt(scoreMatch[2]);
                        matchLine = line.replace(/\s*\d+-\d+\s*/, ' ');
                    }
                    
                    // 解析日期
                    const dateMatch = matchLine.match(/(\d{4}\/\d{1,2}\/\d{1,2})/);
                    const matchDate = dateMatch ? dateMatch[1] : null;
                    if (dateMatch) {
                        matchLine = matchLine.replace(dateMatch[0], '');
                    }
                    
                    // 解析球队
                    const teamsPart = matchLine.trim();
                    const teams = teamsPart.split('-').map(t => t.trim()).filter(t => t);
                    
                    if (teams.length >= 2) {
                        data.push({
                            season: currentSeason,
                            league: currentLeague,
                            round: currentRound,
                            homeTeam: teams[0],
                            awayTeam: teams[1],
                            homeScore: homeScore,
                            awayScore: awayScore,
                            date: matchDate,
                            status: homeScore !== null ? 'finished' : (matchDate ? 'upcoming' : 'scheduled')
                        });
                    }
                }
            });
            
            return data;
        }

        function getLeagueSortOrder(leagueName) {
            for (const key in LEAGUE_ORDER) {
                if (leagueName.includes(key)) return LEAGUE_ORDER[key];
            }
            return 999;
        }

        function getAllSeasons() {
            const seasons = [...new Set(scheduleData.map(m => m.season))];
            return seasons.sort();
        }

        function updateSeasonDropdown() {
            const dropdown = document.getElementById('seasonDropdown');
            const seasons = getAllSeasons();
            
            let html = '<option value="all">全部赛季</option>';
            seasons.forEach(season => {
                html += `<option value="${season}">${season}</option>`;
            });
            
            dropdown.innerHTML = html;
            dropdown.value = currentSeason;
        }

        function changeSeason(season) {
            currentSeason = season;
            renderMatchPage();
        }

        function renderMatchPage() {
            const container = document.getElementById('matchContent');
            const tabsContainer = document.getElementById('matchLeagueTabs');
            
            updateSeasonDropdown();
            
            if (scheduleData.length === 0) {
                container.innerHTML = `
                    <div class="p-8 text-center text-gray-400 dark:text-gray-500 mt-20">
                        <i class="fas fa-calendar-alt text-4xl mb-3"></i>
                        <p>暂无赛程数据</p>
                        <button onclick="loadScheduleData().then(() => renderMatchPage())" class="mt-4 px-6 py-2 bg-emerald-600 text-white rounded-lg text-sm">加载赛程</button>
                    </div>
                `;
                tabsContainer.innerHTML = '';
                return;
            }
            
            // 获取所有联赛并排序
            let leagues = [...new Set(scheduleData.map(m => m.league))];
            
            // 如果是全部赛季，显示所有联赛；否则只显示该赛季的联赛
            if (currentSeason !== 'all') {
                leagues = [...new Set(scheduleData.filter(m => m.season === currentSeason).map(m => m.league))];
            }
            
            leagues.sort((a, b) => getLeagueSortOrder(a) - getLeagueSortOrder(b));
            
            // 渲染联赛标签
            tabsContainer.innerHTML = `
                <div class="match-league-tab ${currentMatchLeague === 'all' ? 'active' : ''}" onclick="switchMatchLeague('all')">全部</div>
                ${leagues.map(l => `
                    <div class="match-league-tab ${currentMatchLeague === l ? 'active' : ''}" onclick="switchMatchLeague('${l}')">${l}</div>
                `).join('')}
            `;
            
            // 筛选比赛
            let filteredMatches = scheduleData;
            
            if (currentSeason !== 'all') {
                filteredMatches = filteredMatches.filter(m => m.season === currentSeason);
            }
            
            if (currentMatchLeague !== 'all') {
                filteredMatches = filteredMatches.filter(m => m.league === currentMatchLeague);
            }
            
            // 按日期排序（全部标签下）
            if (currentMatchLeague === 'all') {
                filteredMatches.sort((a, b) => {
                    if (!a.date) return 1;
                    if (!b.date) return -1;
                    return new Date(a.date) - new Date(b.date);
                });
                
                // 按日期分组渲染
                const groupedByDate = {};
                filteredMatches.forEach(match => {
                    const dateKey = match.date || '待定';
                    if (!groupedByDate[dateKey]) {
                        groupedByDate[dateKey] = [];
                    }
                    groupedByDate[dateKey].push(match);
                });
                
                let html = '';
                Object.keys(groupedByDate).sort((a, b) => {
                    if (a === '待定') return 1;
                    if (b === '待定') return -1;
                    return new Date(a) - new Date(b);
                }).forEach(date => {
                    const matches = groupedByDate[date];
                    const dateObj = date !== '待定' ? new Date(date) : null;
                    const dateStr = dateObj ? `${dateObj.getMonth() + 1}月${dateObj.getDate()}日` : '待定';
                    
                    html += `
                        <div class="match-round-header">
                            ${dateStr} ${matches[0].season || ''}
                        </div>
                        <div class="mb-2">
                            ${matches.map(match => renderMatchItem(match)).join('')}
                        </div>
                    `;
                });
                
                container.innerHTML = html || '<div class="p-8 text-center text-gray-400">暂无比赛</div>';
            } else {
                // 按联赛和轮次分组
                const grouped = {};
                filteredMatches.forEach(match => {
                    const key = `${match.league}|${match.round}`;
                    if (!grouped[key]) {
                        grouped[key] = {
                            league: match.league,
                            round: match.round,
                            season: match.season,
                            matches: []
                        };
                    }
                    grouped[key].matches.push(match);
                });
                
                // 排序分组
                const sortedGroups = Object.values(grouped).sort((a, b) => {
                    const orderA = getLeagueSortOrder(a.league);
                    const orderB = getLeagueSortOrder(b.league);
                    if (orderA !== orderB) return orderA - orderB;
                    return a.round.localeCompare(b.round);
                });
                
                // 渲染
                let html = '';
                sortedGroups.forEach(group => {
                    html += `
                        <div class="match-league-header">
                            ${group.round}
                        </div>
                        <div class="mb-2">
                            ${group.matches.map(match => renderMatchItem(match)).join('')}
                        </div>
                    `;
                });
                
                container.innerHTML = html || '<div class="p-8 text-center text-gray-400">暂无比赛</div>';
            }
        }

        function renderMatchItem(match) {
            const isFinished = match.status === 'finished';
            const scoreDisplay = isFinished 
                ? `<span class="match-score-number">${match.homeScore} - ${match.awayScore}</span>`
                : `<span class="match-time">${match.date || '待定'}</span>`;
            const statusClass = isFinished ? 'finished' : (match.date ? 'upcoming' : '');
            const statusText = isFinished ? '已结束' : (match.date ? '未开始' : '待定');
            
            return `
                <div class="match-item" onclick="goToMatchDetail('${match.homeTeam}', '${match.awayTeam}')">
                    <div class="match-team home">
                        <span class="font-medium text-sm dark:text-gray-200">${match.homeTeam}</span>
                        <div class="team-logo-container team-logo-match">
                            <img src="${getTeamLogo(match.homeTeam)}" alt="${match.homeTeam}" onerror="this.src='${CONFIG.defaultLogo}'">
                        </div>
                    </div>
                    <div class="match-score">
                        ${scoreDisplay}
                        <span class="match-status ${statusClass}">${statusText}</span>
                    </div>
                    <div class="match-team away">
                        <div class="team-logo-container team-logo-match">
                            <img src="${getTeamLogo(match.awayTeam)}" alt="${match.awayTeam}" onerror="this.src='${CONFIG.defaultLogo}'">
                        </div>
                        <span class="font-medium text-sm dark:text-gray-200">${match.awayTeam}</span>
                    </div>
                </div>
            `;
        }

        function switchMatchLeague(league) {
            currentMatchLeague = league;
            renderMatchPage();
        }

        function goToMatchDetail(homeTeam, awayTeam) {
            console.log('查看比赛:', homeTeam, 'vs', awayTeam);
        }

        // 数据页面功能
        async function loadDataPage() {
            if (teamData.length === 0 || playersData.length === 0) {
                await loadTeamData();
            }
            renderYouthLevels();
            initPlayerFilters();
            applyPlayerFilters();
        }

        function switchDataTab(tab) {
            currentDataTab = tab;
            document.getElementById('youthTabBtn').classList.toggle('active', tab === 'youth');
            document.getElementById('playersTabBtn').classList.toggle('active', tab === 'players');
            document.getElementById('youthContent').classList.toggle('hidden', tab !== 'youth');
            document.getElementById('playersContent').classList.toggle('hidden', tab !== 'players');
            
            if (tab === 'youth') {
                renderYouthLevels();
            } else {
                applyPlayerFilters();
            }
        }

        function renderYouthLevels() {
            const container = document.getElementById('youthContent');
            
            // 按青训等级排序
            const youthOrder = { 'S': 5, 'A': 4, 'B': 3, 'C': 2, 'D': 1 };
            const sortedTeams = [...teamData].sort((a, b) => {
                const levelA = youthOrder[a.youth?.charAt(0).toUpperCase()] || 0;
                const levelB = youthOrder[b.youth?.charAt(0).toUpperCase()] || 0;
                return levelB - levelA;
            });
            
            const getYouthClass = (youth) => {
                const level = youth?.charAt(0).toUpperCase();
                const classMap = { 'S': 'youth-s', 'A': 'youth-a', 'B': 'youth-b', 'C': 'youth-c', 'D': 'youth-d' };
                return classMap[level] || 'youth-d';
            };
            
            const getYouthText = (youth) => {
                const level = youth?.charAt(0).toUpperCase();
                return level ? `${level}级` : '未评级';
            };
            
            container.innerHTML = `
                <div class="bg-white dark:bg-dark-surface rounded-lg overflow-hidden">
                    ${sortedTeams.map((team, idx) => `
                        <div class="flex items-center justify-between p-4 ${idx !== sortedTeams.length - 1 ? 'border-b border-gray-100 dark:border-dark-border' : ''}">
                            <div class="flex items-center gap-3">
                                <span class="text-sm font-bold text-gray-400 w-6">${idx + 1}</span>
                                <div class="team-logo-container team-logo-small">
                                    <img src="${getTeamLogo(team.name)}" alt="${team.name}" onerror="this.src='${CONFIG.defaultLogo}'">
                                </div>
                                <span class="font-medium dark:text-gray-200">${team.name}</span>
                            </div>
                            <span class="youth-level-badge ${getYouthClass(team.youth)}">${getYouthText(team.youth)}</span>
                        </div>
                    `).join('')}
                </div>
            `;
        }

        function initPlayerFilters() {
            // 获取所有赛季选项
            const seasons = [...new Set(playersData.map(p => p.contractEnd).filter(Boolean))];
            const seasonSelect = document.getElementById('contractSeasonFilter');
            seasons.sort().forEach(season => {
                const option = document.createElement('option');
                option.value = season;
                option.textContent = season;
                seasonSelect.appendChild(option);
            });
            
            // 获取所有国籍
            const nations = [...new Set(playersData.map(p => p.nation).filter(Boolean))];
            const nationSelect = document.getElementById('nationFilter');
            nations.sort().forEach(nation => {
                const option = document.createElement('option');
                option.value = nation;
                option.textContent = nation;
                nationSelect.appendChild(option);
            });
        }

        function setPlayerSort(sort) {
            playerSort = sort;
            document.querySelectorAll('.sort-btn').forEach(btn => {
                btn.classList.toggle('bg-emerald-600', btn.dataset.sort === sort);
                btn.classList.toggle('text-white', btn.dataset.sort === sort);
                btn.classList.toggle('bg-gray-100', btn.dataset.sort !== sort);
                btn.classList.toggle('dark:bg-dark-border', btn.dataset.sort !== sort);
            });
            playerPage = 1;
            applyPlayerFilters();
        }

        function applyPlayerFilters() {
            playerFilterSeason = document.getElementById('contractSeasonFilter').value;
            playerFilterNation = document.getElementById('nationFilter').value;
            
            let filtered = [...playersData];
            
            // 筛选合同到期赛季
            if (playerFilterSeason !== 'all') {
                filtered = filtered.filter(p => p.contractEnd === playerFilterSeason);
            }
            
            // 筛选国籍
            if (playerFilterNation !== 'all') {
                filtered = filtered.filter(p => p.nation === playerFilterNation);
            }
            
            // 排序
            filtered.sort((a, b) => {
                switch(playerSort) {
                    case 'ca-desc': return b.ca - a.ca;
                    case 'pa-desc': return b.pa - a.pa;
                    case 'age-desc': return b.age - a.age;
                    case 'age-asc': return a.age - b.age;
                    default: return b.ca - a.ca;
                }
            });
            
            renderPlayersList(filtered);
        }

        function renderPlayersList(players) {
            const container = document.getElementById('playersListContainer');
            const pagination = document.getElementById('playersPagination');
            
            const totalPages = Math.ceil(players.length / PLAYERS_PER_PAGE);
            const start = (playerPage - 1) * PLAYERS_PER_PAGE;
            const end = start + PLAYERS_PER_PAGE;
            const pagePlayers = players.slice(start, end);
            
            if (pagePlayers.length === 0) {
                container.innerHTML = '<div class="text-center text-gray-400 py-8">暂无符合条件的球员</div>';
                pagination.innerHTML = '';
                return;
            }
            
            container.innerHTML = `
                <div class="bg-white dark:bg-dark-surface rounded-lg overflow-hidden">
                    ${pagePlayers.map((player, idx) => `
                        <div onclick="openPlayerDetail(${player.id})" class="flex items-center gap-3 p-4 cursor-pointer active:scale-95 transition-transform ${idx !== pagePlayers.length - 1 ? 'border-b border-gray-100 dark:border-dark-border' : ''}">
                            <div class="w-8 h-8 rounded-full bg-emerald-100 dark:bg-emerald-900 flex items-center justify-center text-emerald-600 dark:text-emerald-400 font-bold text-sm">
                                ${player.name.charAt(0)}
                            </div>
                            <div class="flex-1 min-w-0">
                                <div class="flex items-center gap-2">
                                    <span class="font-medium text-sm dark:text-gray-200">${player.name}</span>
                                    <span class="position-badge ${getPositionColorClass(player.mainPosition)} text-xs">${player.positionName}</span>
                                </div>
                                <div class="text-xs text-gray-500 dark:text-gray-400 mt-0.5">
                                    ${player.team} · ${player.nation} · ${player.age}岁
                                </div>
                            </div>
                            <div class="text-right">
                                <div class="text-lg font-bold text-emerald-600">${player.ca}</div>
                                <div class="text-xs text-gray-400">PA:${player.pa}</div>
                            </div>
                        </div>
                    `).join('')}
                </div>
            `;
            
            // 分页
            if (totalPages > 1) {
                pagination.innerHTML = `
                    <button class="pagination-btn" onclick="changePlayerPage(${playerPage - 1})" ${playerPage === 1 ? 'disabled' : ''}>上一页</button>
                    <span class="pagination-info">${playerPage} / ${totalPages}</span>
                    <button class="pagination-btn" onclick="changePlayerPage(${playerPage + 1})" ${playerPage === totalPages ? 'disabled' : ''}>下一页</button>
                `;
            } else {
                pagination.innerHTML = '';
            }
        }

        function changePlayerPage(page) {
            playerPage = page;
            applyPlayerFilters();
        }

        function renderTeamSchedule() {
            const container = document.getElementById('scheduleContent');
            if (!currentTeam) return;
            
            // 查找该球队的所有比赛
            let teamMatches = scheduleData.filter(m => 
                m.homeTeam === currentTeam.name || m.awayTeam === currentTeam.name
            );
            
            // 名称映射处理
            teamMatches = teamMatches.map(m => {
                // 处理首都东木联合B的映射
                if (m.homeTeam === '首都东木联合B') m.homeTeam = '首都-东木联合B';
                if (m.awayTeam === '首都东木联合B') m.awayTeam = '首都-东木联合B';
                return m;
            });
            
            if (teamMatches.length === 0) {
                container.innerHTML = `
                    <div class="bg-white dark:bg-dark-surface rounded-lg p-8 text-center text-gray-400">
                        <i class="fas fa-calendar-alt text-4xl mb-2"></i>
                        <p>暂无赛程数据</p>
                    </div>
                `;
                return;
            }
            
            // 按日期排序
            teamMatches.sort((a, b) => {
                if (!a.date) return 1;
                if (!b.date) return -1;
                return new Date(a.date) - new Date(b.date);
            });
            
            // 按月份分组
            const groupedByMonth = {};
            teamMatches.forEach(match => {
                let monthKey;
                if (match.date) {
                    const date = new Date(match.date);
                    monthKey = `${date.getFullYear()}年${date.getMonth() + 1}月`;
                } else {
                    monthKey = '待定';
                }
                
                if (!groupedByMonth[monthKey]) {
                    groupedByMonth[monthKey] = [];
                }
                groupedByMonth[monthKey].push(match);
            });
            
            let html = '';
            Object.keys(groupedByMonth).forEach(month => {
                const matches = groupedByMonth[month];
                
                html += `
                    <div class="schedule-month-header">${month}</div>
                    <div class="mb-2">
                        ${matches.map(match => renderScheduleItem(match)).join('')}
                    </div>
                `;
            });
            
            container.innerHTML = html;
        }

        function renderScheduleItem(match) {
            const isHome = match.homeTeam === currentTeam.name;
            const opponent = isHome ? match.awayTeam : match.homeTeam;
            const isFinished = match.status === 'finished';
            
            let resultBadge = '';
            let scoreText = '-';
            
            if (isFinished) {
                const isWin = (isHome && match.homeScore > match.awayScore) || (!isHome && match.awayScore > match.homeScore);
                const isDraw = match.homeScore === match.awayScore;
                
                const resultClass = isWin ? 'result-win' : (isDraw ? 'result-draw' : 'result-loss');
                const resultText = isWin ? '胜' : (isDraw ? '平' : '负');
                resultBadge = `<span class="schedule-result ${resultClass}">${resultText}</span>`;
                
                scoreText = isHome ? `${match.homeScore}-${match.awayScore}` : `${match.awayScore}-${match.homeScore}`;
            } else {
                scoreText = match.date ? match.date.split('/').slice(1).join('/') : '待定';
                resultBadge = '<span class="schedule-result result-upcoming">未赛</span>';
            }
            
            const dateObj = match.date ? new Date(match.date) : null;
            const day = dateObj ? dateObj.getDate() : '-';
            const weekDays = ['周日', '周一', '周二', '周三', '周四', '周五', '周六'];
            const week = dateObj ? weekDays[dateObj.getDay()] : '';
            
            return `
                <div class="schedule-item">
                    <div class="schedule-date">
                        <div class="schedule-date-day">${day}</div>
                        <div class="schedule-date-week">${week}</div>
                    </div>
                    <div class="schedule-info">
                        <div class="schedule-league">${match.league} · ${match.round || ''}</div>
                        <div class="schedule-teams">
                            <div class="schedule-team home">
                                <span class="schedule-team-name">${isHome ? currentTeam.name : opponent}</span>
                                <div class="team-logo-container team-logo-small">
                                    <img src="${getTeamLogo(isHome ? currentTeam.name : opponent)}" onerror="this.src='${CONFIG.defaultLogo}'">
                                </div>
                            </div>
                            <div class="schedule-score">${scoreText}</div>
                            <div class="schedule-team away">
                                <div class="team-logo-container team-logo-small">
                                    <img src="${getTeamLogo(isHome ? opponent : currentTeam.name)}" onerror="this.src='${CONFIG.defaultLogo}'">
                                </div>
                                <span class="schedule-team-name">${isHome ? opponent : currentTeam.name}</span>
                            </div>
                        </div>
                    </div>
                    <div style="min-width: 40px; text-align: right;">
                        ${resultBadge}
                    </div>
                </div>
            `;
        }

        async function loadTeamHistoryData() {
            try {
                const response = await fetch(CONFIG.teamHistoryUrl + '?t=' + new Date().getTime(), {
                    method: 'GET',
                    signal: AbortSignal.timeout(10000)
                });
                
                if (!response.ok) throw new Error('无法加载球队历史数据');
                
                const text = await response.text();
                const parsedData = parseTeamHistoryData(text);
                teamHistoryData = { ...teamHistoryData, ...parsedData };
                localStorage.setItem('team_history_cache', JSON.stringify(teamHistoryData));
                localStorage.setItem('team_history_cache_time', new Date().toISOString());
                return teamHistoryData;
            } catch (error) {
                console.error('加载球队历史数据失败:', error);
                return teamHistoryData;
            }
        }
        
        function parseTeamHistoryData(text) {
            const data = {};
            const lines = text.split('\n');
            let currentTeam = null;
            let currentSection = null;
            
            lines.forEach(line => {
                line = line.trim();
                if (!line) return;
                
                if (line.startsWith('==') && line.endsWith('==')) {
                    currentTeam = line.replace(/==/g, '').trim();
                    if (!data[currentTeam]) {
                        data[currentTeam] = {
                            rankings: {},
                            nameChanges: '',
                            topScorers: [],
                            honors: []
                        };
                    }
                    currentSection = null;
                    return;
                }
                
                if (!currentTeam) return;
                
                if (line.startsWith('=') && line.endsWith('=') && !line.startsWith('==')) {
                    currentSection = line.replace(/=/g, '').trim();
                    return;
                }
                
                if (currentSection === '球队变迁') {
                    data[currentTeam].nameChanges = line;
                }
                else if (currentSection === '近年联赛排名') {
                    const match = line.match(/S(\d+)[：:]\s*(\d+)/);
                    if (match) {
                        const seasonNum = parseInt(match[1]);
                        const rank = parseInt(match[2]);
                        data[currentTeam].rankings['S' + seasonNum] = {
                            season: '第' + seasonNum + '赛季',
                            rank: rank
                        };
                    }
                }
                else if (currentSection === '历史射手榜') {
                    const parts = line.split(/\s+/);
                    if (parts.length >= 2) {
                        const goals = parseInt(parts[parts.length - 1]);
                        const name = parts.slice(0, parts.length - 1).join(' ');
                        if (!isNaN(goals)) {
                            data[currentTeam].topScorers.push({ name, goals });
                        }
                    }
                }
                else if (currentSection === '球队荣誉') {
                    const honorMatch = line.match(/(.+?)\s+(冠军|亚军|季军|第\w+名)\s*[Ss]?(\d+)?/);
                    if (honorMatch) {
                        data[currentTeam].honors.push({
                            competition: honorMatch[1].trim(),
                            rank: honorMatch[2],
                            season: honorMatch[3] ? 'S' + honorMatch[3] : ''
                        });
                    } else {
                        data[currentTeam].honors.push({ competition: line, rank: '', season: '' });
                    }
                }
            });
            
            return data;
        }
        
        function getTeamHistoryData(teamName) {
            if (teamHistoryData[teamName]) return teamHistoryData[teamName];
            for (const key in teamHistoryData) {
                if (teamName.includes(key) || key.includes(teamName)) return teamHistoryData[key];
            }
            return null;
        }

        function openSearch() {
            document.getElementById('searchOverlay').classList.add('show');
            document.getElementById('searchPage').classList.add('show');
            document.getElementById('searchInput').focus();
            renderSearchInitial();
        }
        
        function closeSearch() {
            document.getElementById('searchOverlay').classList.remove('show');
            document.getElementById('searchPage').classList.remove('show');
            document.getElementById('searchInput').value = '';
            document.getElementById('searchClear').classList.remove('show');
        }
        
        function handleSearchInput(value) {
            const clearBtn = document.getElementById('searchClear');
            if (value.length > 0) {
                clearBtn.classList.add('show');
                performSearch(value);
            } else {
                clearBtn.classList.remove('show');
                renderSearchInitial();
            }
        }
        
        function handleSearchKeyup(event) {
            if (event.key === 'Enter') {
                const value = document.getElementById('searchInput').value;
                if (value.trim()) {
                    addSearchHistory(value.trim());
                    performSearch(value.trim());
                }
            }
        }
        
        function clearSearch() {
            document.getElementById('searchInput').value = '';
            document.getElementById('searchInput').focus();
            document.getElementById('searchClear').classList.remove('show');
            renderSearchInitial();
        }
        
        function addSearchHistory(keyword) {
            searchHistory = searchHistory.filter(h => h !== keyword);
            searchHistory.unshift(keyword);
            if (searchHistory.length > 10) searchHistory.pop();
            localStorage.setItem('search_history', JSON.stringify(searchHistory));
        }
        
        function removeSearchHistory(keyword, event) {
            event.stopPropagation();
            searchHistory = searchHistory.filter(h => h !== keyword);
            localStorage.setItem('search_history', JSON.stringify(searchHistory));
            renderSearchInitial();
        }
        
        function clearAllHistory() {
            searchHistory = [];
            localStorage.removeItem('search_history');
            renderSearchInitial();
        }
        
        function switchSearchTab(tab) {
            currentSearchTab = tab;
            document.querySelectorAll('.search-tab').forEach(el => {
                el.classList.toggle('active', el.dataset.tab === tab);
            });
            const value = document.getElementById('searchInput').value;
            if (value) performSearch(value);
        }
        
        function renderSearchInitial() {
            const container = document.getElementById('searchContent');
            let html = '';
            
            if (searchHistory.length > 0) {
                html += `
                    <div class="mb-6">
                        <div class="flex items-center justify-between mb-3">
                            <span class="search-section-title" style="margin-bottom: 0;">搜索历史</span>
                            <span class="text-xs text-gray-400 cursor-pointer" onclick="clearAllHistory()">清空</span>
                        </div>
                        <div>
                            ${searchHistory.map(h => `
                                <div class="search-history-item" onclick="quickSearch('${h}')">
                                    <div class="flex items-center gap-3">
                                        <i class="fas fa-history text-gray-400"></i>
                                        <span class="text-sm dark:text-gray-200">${h}</span>
                                    </div>
                                    <i class="fas fa-times text-gray-400 text-xs" onclick="removeSearchHistory('${h}', event)"></i>
                                </div>
                            `).join('')}
                        </div>
                    </div>
                `;
            }
            
            html += `
                <div>
                    <span class="search-section-title">热门搜索</span>
                    <div class="flex flex-wrap">
                        ${searchHotWords.map((word, idx) => `
                            <div class="search-hot-item" onclick="quickSearch('${word}')">
                                <span class="${idx < 3 ? 'text-red-500 font-bold' : 'text-gray-600 dark:text-gray-300'}">${idx + 1}</span>
                                <span class="dark:text-gray-200">${word}</span>
                            </div>
                        `).join('')}
                    </div>
                </div>
            `;
            
            container.innerHTML = html;
        }
        
        function quickSearch(keyword) {
            document.getElementById('searchInput').value = keyword;
            document.getElementById('searchClear').classList.add('show');
            addSearchHistory(keyword);
            performSearch(keyword);
        }
        
        function performSearch(keyword) {
            const container = document.getElementById('searchContent');
            const lowerKeyword = keyword.toLowerCase();
            
            const matchedTeams = teamData.filter(t => 
                t.name.toLowerCase().includes(lowerKeyword) || 
                t.stadium.toLowerCase().includes(lowerKeyword)
            );
            
            const matchedPlayers = playersData.filter(p => 
                p.name.toLowerCase().includes(lowerKeyword) ||
                p.team.toLowerCase().includes(lowerKeyword) ||
                p.position.toLowerCase().includes(lowerKeyword)
            );
            
            const matchedNews = rssData.filter(n => 
                n.title.toLowerCase().includes(lowerKeyword) || 
                n.description.toLowerCase().includes(lowerKeyword)
            );
            
            let html = '';
            let hasResult = false;
            const tabs = currentSearchTab === 'all' ? ['team', 'player', 'news'] : [currentSearchTab];
            
            tabs.forEach(type => {
                if (type === 'team' && matchedTeams.length > 0) {
                    hasResult = true;
                    html += `
                        <div class="mb-4">
                            <span class="search-section-title">球队 (${matchedTeams.length})</span>
                            ${matchedTeams.map(t => `
                                <div class="search-result-item" onclick="closeSearch(); openTeamDetail(${t.id})">
                                    <div class="team-logo-container team-logo-small bg-gray-100 dark:bg-gray-800 rounded p-1">
                                        <img src="${getTeamLogo(t.name)}" alt="${t.name}" onerror="this.src='${CONFIG.defaultLogo}'">
                                    </div>
                                    <div class="flex-1">
                                        <div class="font-bold dark:text-gray-100">${highlightText(t.name, keyword)}</div>
                                        <div class="text-xs text-gray-500">${t.stadium}</div>
                                    </div>
                                    <i class="fas fa-chevron-right text-gray-300"></i>
                                </div>
                            `).join('')}
                        </div>
                    `;
                }
                
                if (type === 'player' && matchedPlayers.length > 0) {
                    hasResult = true;
                    html += `
                        <div class="mb-4">
                            <span class="search-section-title">球员 (${matchedPlayers.length})</span>
                            ${matchedPlayers.slice(0, 10).map(p => `
                                <div class="search-result-item" onclick="closeSearch(); openPlayerDetail(${p.id})">
                                    <div class="w-10 h-10 rounded-full bg-emerald-100 dark:bg-emerald-900 flex items-center justify-center text-emerald-600 dark:text-emerald-400 font-bold">
                                        ${p.name.charAt(0)}
                                    </div>
                                    <div class="flex-1">
                                        <div class="font-bold dark:text-gray-100">${highlightText(p.name, keyword)}</div>
                                        <div class="text-xs text-gray-500">${p.team} · ${p.positionName} · CA${p.ca}</div>
                                    </div>
                                    <i class="fas fa-chevron-right text-gray-300"></i>
                                </div>
                            `).join('')}
                            ${matchedPlayers.length > 10 ? `<div class="text-center text-xs text-gray-400 py-2">还有${matchedPlayers.length - 10}位球员</div>` : ''}
                        </div>
                    `;
                }
                
                if (type === 'news' && matchedNews.length > 0) {
                    hasResult = true;
                    html += `
                        <div class="mb-4">
                            <span class="search-section-title">新闻 (${matchedNews.length})</span>
                            ${matchedNews.slice(0, 5).map(n => `
                                <div class="search-result-item" onclick="closeSearch(); openArticleById('${n.id}')">
                                    <div class="flex-1">
                                        <div class="font-bold text-sm dark:text-gray-100 line-clamp-2">${highlightText(n.title, keyword)}</div>
                                        <div class="text-xs text-gray-500 mt-1">${formatTime(n.pubDate)}</div>
                                    </div>
                                </div>
                            `).join('')}
                        </div>
                    `;
                }
            });
            
            if (!hasResult) {
                html = `
                    <div class="text-center text-gray-400 py-12">
                        <i class="fas fa-search text-4xl mb-3 opacity-30"></i>
                        <p>未找到"${keyword}"相关结果</p>
                        <p class="text-xs mt-2">试试搜索球队名、球员名或新闻关键词</p>
                    </div>
                `;
            }
            
            container.innerHTML = html;
        }
        
        function highlightText(text, keyword) {
            if (!keyword) return text;
            const regex = new RegExp(`(${keyword})`, 'gi');
            return text.replace(regex, '<span class="search-highlight">$1</span>');
        }
        
        function openArticleById(id) {
            const post = rssData.find(p => p.id == id);
            if (post) openArticle(post);
        }

        function showEmptyState() {
            document.getElementById('newsFeed').innerHTML = `
                <div class="p-8 text-center text-gray-400 dark:text-gray-500 mt-10">
                    <div class="text-4xl mb-3">📡</div>
                    <p class="mb-2">暂无数据</p>
                    <p class="text-xs mb-4">下拉刷新或点击首页按钮获取最新内容</p>
                    <button onclick="loadRSS()" class="px-6 py-2 bg-emerald-600 text-white rounded-lg text-sm hover:bg-emerald-700 transition">立即刷新</button>
                </div>
            `;
        }

        function updateClock() {
            const now = new Date();
            const hours = String(now.getHours()).padStart(2, '0');
            const minutes = String(now.getMinutes()).padStart(2, '0');
            document.getElementById('clock').textContent = `${hours}:${minutes}`;
        }

        function toggleTheme() {
            document.documentElement.classList.toggle('dark');
        }

        function initPullToRefresh() {
            const container = document.getElementById('refreshContainer');
            const indicator = document.getElementById('pullIndicator');
            
            container.addEventListener('touchstart', (e) => {
                if (window.scrollY === 0 && !isRefreshing && currentTab === 'home') {
                    touchStartY = e.touches[0].clientY;
                    isPulling = true;
                }
            }, { passive: true });
            
            container.addEventListener('touchmove', (e) => {
                if (!isPulling || isRefreshing || currentTab !== 'home') return;
                
                touchCurrentY = e.touches[0].clientY;
                const diff = touchCurrentY - touchStartY;
                
                if (diff > 0) {
                    e.preventDefault();
                    const pullDistance = Math.min(diff * 0.5, 120);
                    indicator.style.transform = `translateY(${pullDistance}px)`;
                    
                    const text = document.getElementById('pullText');
                    if (pullDistance > PULL_THRESHOLD) {
                        text.innerHTML = '<i class="fas fa-arrow-up mr-1"></i> 释放刷新';
                    } else {
                        text.innerHTML = '<i class="fas fa-arrow-down mr-1"></i> 下拉刷新';
                    }
                }
            }, { passive: false });
            
            container.addEventListener('touchend', () => {
                if (!isPulling || isRefreshing) return;
                
                const diff = touchCurrentY - touchStartY;
                
                if (diff > PULL_THRESHOLD && !isRefreshing) {
                    startRefresh();
                } else {
                    resetPullIndicator();
                }
                
                isPulling = false;
                touchStartY = 0;
                touchCurrentY = 0;
            });
        }

        function startRefresh() {
            isRefreshing = true;
            const indicator = document.getElementById('pullIndicator');
            const spinner = document.getElementById('pullSpinner');
            const text = document.getElementById('pullText');
            
            spinner.classList.remove('hidden');
            text.innerHTML = '<span class="ml-2">刷新中...</span>';
            indicator.style.transform = `translateY(60px)`;
            
            Promise.all([loadRSS(), loadTeamHistoryData(), loadScheduleData()]).then(() => {
                showRefreshToast();
                if (currentTab === 'match') renderMatchPage();
                if (currentTab === 'data') loadDataPage();
            }).finally(() => {
                setTimeout(() => {
                    resetPullIndicator();
                    isRefreshing = false;
                }, 500);
            });
        }

        function resetPullIndicator() {
            const indicator = document.getElementById('pullIndicator');
            const spinner = document.getElementById('pullSpinner');
            const text = document.getElementById('pullText');
            
            indicator.style.transition = 'transform 0.3s';
            indicator.style.transform = 'translateY(0)';
            spinner.classList.add('hidden');
            text.innerHTML = '<i class="fas fa-arrow-down mr-1"></i> 下拉刷新';
            
            setTimeout(() => {
                indicator.style.transition = '';
            }, 300);
        }

        function showRefreshToast() {
            const toast = document.getElementById('refreshToast');
            toast.classList.add('show');
            setTimeout(() => {
                toast.classList.remove('show');
            }, 2000);
        }

        async function loadRSS() {
            updateSyncStatus('syncing');
            
            try {
                const githubUrl = `https://raw.githubusercontent.com/${CONFIG.owner}/${CONFIG.repo}/${CONFIG.branch}/${CONFIG.rssPath}?t=${new Date().getTime()}`;
                
                let response = await fetch(githubUrl, {
                    method: 'GET',
                    headers: { 'Accept': 'application/xml, text/xml, */*' },
                    signal: AbortSignal.timeout(10000)
                });

                if (!response.ok) {
                    const proxyUrl = 'https://api.allorigins.win/raw?url=' + encodeURIComponent('https://sutterfootball.freeflarum.com/rss/t/garciafootball');
                    response = await fetch(proxyUrl, { signal: AbortSignal.timeout(10000) });
                }

                if (!response.ok) throw new Error(`HTTP ${response.status}`);

                const xmlText = await response.text();
                if (!xmlText.includes('<?xml') && !xmlText.includes('<rss')) {
                    throw new Error('返回内容不是有效的 RSS');
                }

                const items = parseRSS(xmlText);
                if (items.length === 0) throw new Error('RSS 解析结果为空');
                
                rssData = items;
                renderNews();
                updateSyncStatus('success', items.length);
                
                localStorage.setItem('rss_cache', JSON.stringify({
                    data: items,
                    time: new Date().toISOString()
                }));

            } catch (error) {
                console.error('RSS 加载失败:', error);
                const cached = localStorage.getItem('rss_cache');
                if (cached) {
                    try {
                        const { data, time } = JSON.parse(cached);
                        rssData = data;
                        renderNews();
                        updateSyncStatus('cached', data.length, time);
                    } catch (e) {
                        showError('加载失败，且无缓存数据可用');
                    }
                } else {
                    showError('加载失败: ' + error.message);
                }
            }
        }

        function parseRSS(xmlText) {
            const parser = new DOMParser();
            const xml = parser.parseFromString(xmlText, 'text/xml');
            const parseError = xml.querySelector('parsererror');
            if (parseError) throw new Error('XML 解析错误');

            const items = xml.querySelectorAll('item');
            
            return Array.from(items).map((item, index) => {
                let title = item.querySelector('title')?.textContent || '无标题';
                title = title.replace(/<!\[CDATA\[(.*?)\]\]>/s, '$1').trim();
                
                const link = item.querySelector('link')?.textContent || '';
                
                let description = item.querySelector('description')?.textContent || '';
                description = description.replace(/<!\[CDATA\[(.*?)\]\]>/s, '$1').trim();
                
                let content = item.querySelector('content\\:encoded')?.textContent || 
                             item.querySelector('encoded')?.textContent || 
                             description;
                content = content.replace(/<!\[CDATA\[(.*?)\]\]>/s, '$1').trim();
                
                const pubDate = item.querySelector('pubDate')?.textContent || 
                               item.querySelector('dc\\:date')?.textContent || 
                               new Date().toISOString();
                
                const author = item.querySelector('author')?.textContent || 
                              item.querySelector('dc\\:creator')?.textContent || 
                              item.querySelector('creator')?.textContent || 
                              '加西亚足球APP';
                
                const categories = Array.from(item.querySelectorAll('category')).map(c => c.textContent);
                const category = categories[0] || detectCategory(title);
                
                const id = item.querySelector('guid')?.textContent || 
                          item.querySelector('link')?.textContent || 
                          index;
                
                const imgMatch = content.match(/<img[^>]+src=["']([^"']+)["']/i);
                const image = imgMatch ? imgMatch[1] : getDefaultImage(category, index);
                
                return { 
                    id, 
                    title, 
                    link, 
                    description: stripHtml(description).substring(0, 200) + '...', 
                    content, 
                    pubDate, 
                    author, 
                    category, 
                    image, 
                    comments: Math.floor(Math.random() * 100), 
                    views: Math.floor(Math.random() * 1000) + 100 
                };
            });
        }

        function detectCategory(title) {
            const lower = title.toLowerCase();
            if (lower.includes('战报') || lower.includes('vs') || lower.includes('-') || lower.includes('比赛')) return 'match';
            if (lower.includes('转会') || lower.includes('签约') || lower.includes('续约') || lower.includes('加盟')) return 'transfer';
            if (lower.includes('公告') || lower.includes('官方') || lower.includes('通知')) return 'official';
            if (lower.includes('分析') || lower.includes('战术') || lower.includes('数据')) return 'analysis';
            return 'news';
        }

        function getDefaultImage(category, seed) {
            const images = {
                match: 'https://images.unsplash.com/photo-1574629810360-7efbbe195018?w=400&h=300&fit=crop',
                transfer: 'https://images.unsplash.com/photo-1522778119026-d647f0565c6a?w=400&h=300&fit=crop',
                official: 'https://images.unsplash.com/photo-1556056504-5c7696c4c28d?w=400&h=300&fit=crop',
                analysis: 'https://images.unsplash.com/photo-1517927033932-b3d18e61fb3a?w=400&h=300&fit=crop',
                news: 'https://images.unsplash.com/photo-1489944440615-453fc2b6a9a9?w=400&h=300&fit=crop'
            };
            return images[category] || images.news;
        }

        function updateSyncStatus(status, count, cacheTime) {
            const el = document.getElementById('syncStatus');
            const now = new Date();
            const timeStr = `${String(now.getHours()).padStart(2,'0')}:${String(now.getMinutes()).padStart(2,'0')}`;
            
            switch(status) {
                case 'syncing':
                    el.innerHTML = '<i class="fas fa-sync-alt animate-spin mr-1"></i>更新中';
                    el.className = 'text-emerald-600 dark:text-emerald-400 text-[10px] mr-2';
                    break;
                case 'success':
                    el.innerHTML = `<i class="fas fa-check mr-1"></i>${count}条 ${timeStr}`;
                    el.className = 'text-emerald-600 dark:text-emerald-400 text-[10px] mr-2';
                    break;
                case 'cached':
                    const cacheDate = new Date(cacheTime);
                    const cacheTimeStr = `${String(cacheDate.getHours()).padStart(2,'0')}:${String(cacheDate.getMinutes()).padStart(2,'0')}`;
                    el.innerHTML = `<i class="fas fa-clock mr-1"></i>缓存 ${cacheTimeStr}`;
                    el.className = 'text-amber-600 dark:text-amber-400 text-[10px] mr-2';
                    break;
            }
        }

        function showError(message) {
            const feed = document.getElementById('newsFeed');
            feed.innerHTML = `
                <div class="p-8 text-center text-red-500 dark:text-red-400">
                    <div class="text-4xl mb-2">⚠️</div>
                    <p class="font-medium mb-2">${message}</p>
                    <button onclick="loadRSS()" class="mt-4 px-6 py-2 bg-emerald-600 text-white rounded-lg text-sm hover:bg-emerald-700 transition">重新加载</button>
                </div>
            `;
            updateSyncStatus('error');
        }

        function filterByTag(tag) {
            currentTag = tag;
            
            document.querySelectorAll('.tag-btn').forEach(btn => {
                btn.classList.remove('tag-active', 'text-emerald-600', 'dark:text-emerald-400');
                btn.classList.add('text-gray-600', 'dark:text-gray-400');
                if (btn.dataset.tag === tag) {
                    btn.classList.add('tag-active', 'text-emerald-600', 'dark:text-emerald-400');
                    btn.classList.remove('text-gray-600', 'dark:text-gray-400');
                }
            });
            
            renderNews();
        }

        function detectTeamsInNews(title, description) {
            const teams = [];
            const text = (title + ' ' + description).toLowerCase();
            
            for (const teamName in TEAM_LOGOS) {
                if (text.includes(teamName.toLowerCase())) {
                    teams.push(teamName);
                }
            }
            
            return teams;
        }

        function renderNews() {
            const feed = document.getElementById('newsFeed');
            feed.innerHTML = '';
            
            const filtered = currentTag === 'all' ? rssData : rssData.filter(p => p.category === currentTag);
            
            if (filtered.length === 0) {
                feed.innerHTML = `
                    <div class="p-8 text-center text-gray-400 dark:text-gray-500">
                        <i class="fas fa-inbox text-4xl mb-3"></i>
                        <p>暂无相关文章</p>
                    </div>
                `;
                return;
            }
            
            filtered.forEach((post, index) => {
                const card = document.createElement('div');
                card.className = 'news-card bg-white dark:bg-dark-surface p-4 flex gap-4 cursor-pointer fade-in';
                card.style.animationDelay = `${index * 0.05}s`;
                card.onclick = () => openArticle(post);
                
                const tagColors = {
                    match: 'bg-blue-100 dark:bg-blue-900 text-blue-700 dark:text-blue-300',
                    transfer: 'bg-purple-100 dark:bg-purple-900 text-purple-700 dark:text-purple-300',
                    official: 'bg-red-100 dark:bg-red-900 text-red-700 dark:text-red-300',
                    analysis: 'bg-amber-100 dark:bg-amber-900 text-amber-700 dark:text-amber-300',
                    news: 'bg-gray-100 dark:bg-gray-700 text-gray-700 dark:text-gray-300'
                };
                
                const tagNames = { match: '战报', transfer: '转会', official: '公告', analysis: '分析', news: '新闻' };
                
                const tagClass = tagColors[post.category] || tagColors.news;
                const tagName = tagNames[post.category] || '新闻';
                
                const relatedTeams = detectTeamsInNews(post.title, post.description);
                let teamTagsHtml = '';
                if (relatedTeams.length > 0) {
                    teamTagsHtml = `
                        <div class="flex flex-wrap gap-2 mt-2">
                            ${relatedTeams.map(team => `
                                <span class="news-team-tag" onclick="event.stopPropagation(); goToTeamByName('${team}')">
                                    <img src="${getTeamLogo(team)}" alt="${team}" onerror="this.src='${CONFIG.defaultLogo}'">
                                    ${team}
                                </span>
                            `).join('')}
                        </div>
                    `;
                }
                
                card.innerHTML = `
                    <div class="flex-1 min-w-0">
                        <h2 class="text-base font-bold text-gray-900 dark:text-gray-100 leading-snug mb-2 line-clamp-2">${escapeHtml(post.title)}</h2>
                        <p class="text-sm text-gray-500 dark:text-gray-400 line-clamp-2 mb-3 leading-relaxed">${escapeHtml(post.description)}</p>
                        <div class="flex items-center text-xs text-gray-400 dark:text-gray-500 gap-3">
                            <span class="${tagClass} px-2 py-0.5 rounded font-medium">${tagName}</span>
                            <span class="flex items-center gap-1"><i class="far fa-comment-alt"></i>${post.comments}</span>
                            <span>${formatTime(post.pubDate)}</span>
                        </div>
                        ${teamTagsHtml}
                    </div>
                    <div class="w-24 h-20 flex-shrink-0 rounded-lg overflow-hidden bg-gray-200 dark:bg-gray-700">
                        <img src="${post.image}" alt="" class="w-full h-full object-cover" loading="lazy" onerror="this.src='https://via.placeholder.com/400x300?text=No+Image'">
                    </div>
                `;
                
                feed.appendChild(card);
            });
        }

        function goToTeamByName(teamName) {
            const team = teamData.find(t => t.name === teamName);
            if (team) {
                switchTab('team');
                setTimeout(() => openTeamDetail(team.id), 100);
            } else {
                alert('球队数据尚未加载，请先访问球队页面');
            }
        }

        function openArticle(post) {
            const page = document.getElementById('articlePage');
            const content = document.getElementById('articleContent');
            
            const tagNames = { match: '比赛战报', transfer: '转会动态', official: '官方公告', analysis: '战术分析', news: '新闻报道' };
            
            const relatedTeams = detectTeamsInNews(post.title, post.description);
            let teamTagsHtml = '';
            if (relatedTeams.length > 0) {
                teamTagsHtml = `
                    <div class="flex flex-wrap gap-2 mt-4 pt-4 border-t border-gray-200 dark:border-dark-border">
                        <span class="text-sm text-gray-500 dark:text-gray-400 mr-2">相关球队：</span>
                        ${relatedTeams.map(team => `
                            <span class="news-team-tag" onclick="event.stopPropagation(); goToTeamByName('${team}')">
                                <img src="${getTeamLogo(team)}" alt="${team}" onerror="this.src='${CONFIG.defaultLogo}'">
                                ${team}
                            </span>
                        `).join('')}
                    </div>
                `;
            }
            
            content.innerHTML = `
                <div class="mb-4">
                    <span class="inline-block px-2 py-1 bg-emerald-100 dark:bg-emerald-900 text-emerald-700 dark:text-emerald-300 text-xs rounded mb-2 font-medium">
                        ${tagNames[post.category] || '新闻'}
                    </span>
                    <h1 class="text-2xl font-bold text-gray-900 dark:text-gray-100 leading-tight mb-3">${escapeHtml(post.title)}</h1>
                    <div class="flex items-center justify-between text-sm text-gray-500 dark:text-gray-400 border-b border-gray-200 dark:border-dark-border pb-4">
                        <div class="flex items-center gap-2">
                            <span class="font-medium text-gray-700 dark:text-gray-300">${escapeHtml(post.author)}</span>
                            <span>•</span>
                            <span>${formatTime(post.pubDate)}</span>
                        </div>
                        <div class="flex items-center gap-3">
                            <span class="flex items-center gap-1"><i class="far fa-eye"></i>${post.views}</span>
                            <span class="flex items-center gap-1"><i class="far fa-comment"></i>${post.comments}</span>
                        </div>
                    </div>
                </div>
                <div class="prose dark:prose-invert max-w-none text-gray-700 dark:text-gray-300 leading-relaxed text-base">
                    ${post.content}
                </div>
                ${teamTagsHtml}
            `;
            
            page.classList.add('show');
            document.body.style.overflow = 'hidden';
        }

        function closeArticle() {
            const page = document.getElementById('articlePage');
            page.classList.remove('show');
            document.body.style.overflow = '';
        }

        function shareArticle() {
            const title = document.querySelector('#articleContent h1')?.textContent || '加西亚足球APP';
            if (navigator.share) {
                navigator.share({ title: title, text: '来自加西亚足球APP', url: window.location.href });
            } else {
                navigator.clipboard.writeText(window.location.href).then(() => alert('链接已复制到剪贴板'));
            }
        }

        function getTeamLogo(teamName) {
            // 处理首都东木联合B的映射
            if (teamName === '首都东木联合B') {
                return TEAM_LOGOS['首都-东木联合B'] || CONFIG.defaultLogo;
            }
            return TEAM_LOGOS[teamName] || CONFIG.defaultLogo;
        }
        
        function getPositionCategory(position) {
            if (!position) return 'MF';
            
            const posList = position.split(/[,，]/).map(p => p.trim());
            const firstPos = posList[0];
            
            if (firstPos.includes('门将') || firstPos.includes('守门')) return 'GK';
            if (firstPos.includes('后卫') || firstPos.endsWith('卫')) return 'DF';
            if (firstPos.includes('前锋') || firstPos.includes('中锋') || firstPos.includes('影锋') || firstPos.includes('边锋') || firstPos.endsWith('锋')) return 'FW';
            if (firstPos.includes('中场') || firstPos.includes('前卫') || firstPos.includes('后腰') || firstPos.includes('前腰') || firstPos.includes('中前卫') || firstPos.includes('组织') || firstPos.includes('进攻') || firstPos.endsWith('场') || firstPos.endsWith('腰')) return 'MF';
            
            return 'MF';
        }
        
        function getPositionColorClass(pos) {
            const map = { 'GK': 'position-gk', 'DF': 'position-df', 'MF': 'position-mf', 'FW': 'position-fw' };
            return map[pos] || 'position-mf';
        }
        
        function parseCoaches(coachStr) {
            if (!coachStr) return [];
            return coachStr.split(/[、,，/]/).map(c => c.trim()).filter(c => c);
        }
        
        function formatNumberRaw(num) {
            if (!num) return '0';
            return num.toString();
        }
        
        async function loadTeamData() {
            const teamList = document.getElementById('teamList');
            teamList.innerHTML = '<div class="text-center py-8"><i class="fas fa-spinner fa-spin text-2xl text-emerald-600"></i><p class="text-sm text-gray-500 mt-2">加载球队数据...</p></div>';
            
            await loadTeamHistoryData();
            
            try {
                const response = await fetch(CONFIG.excelUrl, { signal: AbortSignal.timeout(15000) });
                if (!response.ok) throw new Error('无法加载数据文件');
                
                const arrayBuffer = await response.arrayBuffer();
                const data = new Uint8Array(arrayBuffer);
                const workbook = XLSX.read(data, { type: 'array' });
                
                const teamSheetName = workbook.SheetNames.find(name => name.includes('球队')) || workbook.SheetNames[1];
                const teamSheet = workbook.Sheets[teamSheetName];
                const teamJson = XLSX.utils.sheet_to_json(teamSheet, { header: 1 });
                
                const playerSheetName = workbook.SheetNames.find(name => name.includes('球员')) || workbook.SheetNames[0];
                const playerSheet = workbook.Sheets[playerSheetName];
                const playerJson = XLSX.utils.sheet_to_json(playerSheet, { header: 1 });
                
                const teamHeaders = teamJson[0];
                teamData = [];
                for (let i = 1; i < teamJson.length; i++) {
                    const row = teamJson[i];
                    if (!row[0]) continue;
                    
                    const teamObj = {};
                    teamHeaders.forEach((header, idx) => {
                        teamObj[header] = row[idx];
                    });
                    
                    teamData.push({
                        id: i - 1,
                        name: teamObj['球队名'] || '',
                        manager: teamObj['玩家'] || '',
                        coach: teamObj['教练组'] || '',
                        stadium: teamObj['主场'] || '',
                        capacity: teamObj['座席数'] || 0,
                        avgAttendance: teamObj['场均上座'] || 0,
                        occupancyRate: teamObj['上座率'] || 0,
                        revenue: teamObj['收入'] || 0,
                        funds: teamObj['球队资金'] || 0,
                        sponsor1: teamObj['赞助商1'] || '',
                        sponsor2: teamObj['赞助商2'] || '',
                        youth: teamObj['青训'] || '',
                        other: teamObj['其他'] || ''
                    });
                }
                
                const playerHeaders = playerJson[0];
                playersData = [];
                for (let i = 1; i < playerJson.length; i++) {
                    const row = playerJson[i];
                    if (!row[0]) continue;
                    
                    const playerObj = {};
                    playerHeaders.forEach((header, idx) => {
                        playerObj[header] = row[idx];
                    });
                    
                    const position = playerObj['位置'] || '';
                    const mainPos = getPositionCategory(position);
                    const posList = position.split(/[,，]/).map(p => p.trim()).filter(p => p);
                    
                    playersData.push({
                        id: i - 1,
                        name: playerObj['球员名称'] || '',
                        age: playerObj['年龄'] || 0,
                        nation: playerObj['国家/地区籍'] || '',
                        height: playerObj['身高'] || 0,
                        weight: playerObj['体重'] || 0,
                        ca: playerObj['CA'] || 0,
                        pa: playerObj['PA'] || 0,
                        position: position,
                        mainPosition: mainPos,
                        positionName: posList[0] || '未知',
                        allPositions: posList,
                        wage: playerObj['年薪'] || 0,
                        team: playerObj['所在球队'] || '',
                        contractEnd: playerObj['合约到期'] || '',
                        clause: playerObj['违约金'] || '',
                        contractType: playerObj['合同类型'] || '',
                        contractNote: playerObj['合同备注'] || ''
                    });
                }
                
                renderTeamList();
                
            } catch (error) {
                console.error('加载球队数据失败:', error);
                teamList.innerHTML = `
                    <div class="text-center text-red-500 py-8">
                        <i class="fas fa-exclamation-circle text-2xl mb-2"></i>
                        <p class="text-sm">加载失败: ${error.message}</p>
                        <button onclick="loadTeamData()" class="mt-4 px-4 py-2 bg-emerald-600 text-white rounded-lg text-sm">重试</button>
                    </div>
                `;
            }
        }
        
        function renderTeamList() {
            const container = document.getElementById('teamList');
            
            if (teamData.length === 0) {
                container.innerHTML = '<div class="text-center text-gray-400 py-8">暂无球队数据</div>';
                return;
            }
            
            container.innerHTML = teamData.map((team, idx) => `
                <div onclick="openTeamDetail(${team.id})" class="bg-white dark:bg-dark-surface rounded-lg p-4 flex items-center gap-4 shadow-sm cursor-pointer active:scale-95 transition-transform">
                    <div class="team-logo-container team-logo-list bg-gray-50 dark:bg-gray-800 rounded-lg p-1">
                        <img src="${getTeamLogo(team.name)}" alt="${team.name}" onerror="this.src='${CONFIG.defaultLogo}'">
                    </div>
                    <div class="flex-1 min-w-0">
                        <div class="flex items-center gap-2 mb-1">
                            <h3 class="font-bold text-lg dark:text-gray-100 truncate">${team.name}</h3>
                        </div>
                        <div class="flex items-center gap-2 text-sm text-gray-500 dark:text-gray-400">
                            <span class="truncate">${team.stadium}</span>
                        </div>
                        <div class="flex items-center gap-3 mt-1 text-xs text-gray-400">
                            <span>资金: ${formatNumber(team.funds)}万</span>
                            <span>上座: ${formatNumber(team.avgAttendance)}</span>
                        </div>
                    </div>
                    <i class="fas fa-chevron-right text-gray-300 dark:text-gray-600"></i>
                </div>
            `).join('');
        }
        
        function formatNumber(num) {
            if (!num) return '0';
            if (num >= 10000) return (num / 10000).toFixed(1) + '亿';
            if (num >= 1000) return (num / 1000).toFixed(1) + '千万';
            return num.toString();
        }
        
        function openTeamDetail(teamId) {
            currentTeam = teamData.find(t => t.id === teamId);
            if (!currentTeam) return;
            
            currentCoaches = parseCoaches(currentTeam.coach);
            const headCoach = currentCoaches[0] || '暂无';
            
            const teamPlayers = playersData.filter(p => p.team === currentTeam.name);
            const totalWages = teamPlayers.reduce((sum, p) => sum + (parseFloat(p.wage) || 0), 0);
            const projectedFunds = (parseFloat(currentTeam.funds) || 0) - totalWages;
            
            document.getElementById('teamDetailName').textContent = currentTeam.name;
            document.getElementById('teamDetailNameEn').textContent = currentTeam.stadium;
            document.getElementById('teamDetailCoach').textContent = headCoach;
            
            document.getElementById('teamDetailFunds').textContent = formatNumberRaw(currentTeam.funds);
            document.getElementById('teamDetailAttendance').textContent = formatNumberRaw(currentTeam.avgAttendance);
            document.getElementById('teamDetailOccupancy').textContent = ((currentTeam.occupancyRate || 0) * 100).toFixed(1) + '%';
            document.getElementById('teamDetailCapacity').textContent = formatNumberRaw(currentTeam.capacity);
            
            document.getElementById('teamDetailWages').textContent = formatNumberRaw(totalWages);
            document.getElementById('teamDetailProjected').textContent = formatNumberRaw(projectedFunds);
            
            const warningEl = document.getElementById('financialWarning');
            if (projectedFunds < 0) {
                warningEl.classList.remove('hidden');
            } else {
                warningEl.classList.add('hidden');
            }
            
            document.getElementById('teamDetailLogo').src = getTeamLogo(currentTeam.name);
            
            document.getElementById('coachCard').innerHTML = `
                <div class="font-bold dark:text-gray-100 text-lg">${headCoach}</div>
                <div class="text-sm text-gray-500">主教练</div>
            `;
            
            renderSquad();
            renderTeamNews();
            renderTeamStats();
            renderTeamSchedule();
            switchTeamTab('squad');
            
            document.getElementById('teamDetailPage').classList.remove('hidden');
            document.body.style.overflow = 'hidden';
        }
        
        function renderTeamStats() {
            const container = document.getElementById('statsContent');
            if (!currentTeam) return;
            
            const historyData = getTeamHistoryData(currentTeam.name);
            
            let html = '';
            
            if (historyData) {
                if (historyData.nameChanges) {
                    html += `
                        <div class="data-section">
                            <div class="data-section-title">球队变迁</div>
                            <div class="change-text text-sm">${historyData.nameChanges}</div>
                        </div>
                    `;
                }
                
                if (historyData.rankings && Object.keys(historyData.rankings).length > 0) {
                    const sortedRankings = Object.entries(historyData.rankings)
                        .sort((a, b) => {
                            const numA = parseInt(a[0].replace('S', ''));
                            const numB = parseInt(b[0].replace('S', ''));
                            return numA - numB;
                        });
                    
                    html += `
                        <div class="data-section">
                            <div class="data-section-title">近年联赛排名</div>
                            <div class="ranking-chart-container">
                                <canvas id="rankingChart"></canvas>
                            </div>
                        </div>
                    `;
                    
                    setTimeout(() => drawRankingChart(sortedRankings), 100);
                }
                
                if (historyData.topScorers && historyData.topScorers.length > 0) {
                    html += `
                        <div class="data-section">
                            <div class="data-section-title">历史射手榜</div>
                            <div>
                                ${historyData.topScorers.map((scorer, idx) => `
                                    <div class="scorer-item">
                                        <div class="flex items-center gap-2">
                                            <span class="text-xs font-bold ${idx < 3 ? 'text-emerald-600' : 'text-gray-400'}">${idx + 1}</span>
                                            <span class="text-sm font-medium">${scorer.name}</span>
                                        </div>
                                        <span class="text-sm font-bold text-emerald-600">${scorer.goals}球</span>
                                    </div>
                                `).join('')}
                            </div>
                        </div>
                    `;
                }
                
                if (historyData.honors && historyData.honors.length > 0) {
                    html += `
                        <div class="data-section">
                            <div class="data-section-title">球队荣誉</div>
                            <div class="space-y-2">
                                ${historyData.honors.map(honor => {
                                    let badgeClass = 'honor-badge';
                                    if (honor.rank === '亚军') badgeClass += ' second';
                                    else if (honor.rank === '季军') badgeClass += ' third';
                                    
                                    return `
                                        <div class="honor-item">
                                            ${honor.rank ? `<span class="${badgeClass}">${honor.rank}</span>` : ''}
                                            <span class="text-sm">${honor.competition}</span>
                                            ${honor.season ? `<span class="text-xs text-gray-500">${honor.season}</span>` : ''}
                                        </div>
                                    `;
                                }).join('')}
                            </div>
                        </div>
                    `;
                }
            }
            
            if (!historyData || (!historyData.nameChanges && !Object.keys(historyData.rankings).length && !historyData.topScorers.length && !historyData.honors.length)) {
                html = `
                    <div class="bg-white dark:bg-dark-surface rounded-lg p-8 text-center text-gray-400">
                        <i class="fas fa-chart-bar text-4xl mb-2"></i>
                        <p>暂无历史数据</p>
                        <p class="text-xs mt-2">下拉刷新可更新数据</p>
                    </div>
                `;
            }
            
            container.innerHTML = html;
        }
        
        function drawRankingChart(rankings) {
            const canvas = document.getElementById('rankingChart');
            if (!canvas) return;
            
            // 设置canvas实际尺寸为容器尺寸
            const container = canvas.parentElement;
            const dpr = window.devicePixelRatio || 1;
            const rect = container.getBoundingClientRect();
            
            canvas.width = rect.width * dpr;
            canvas.height = rect.height * dpr;
            canvas.style.width = rect.width + 'px';
            canvas.style.height = rect.height + 'px';
            
            const ctx = canvas.getContext('2d');
            ctx.scale(dpr, dpr);
            
            const width = rect.width;
            const height = rect.height;
            
            ctx.clearRect(0, 0, width, height);
            
            const data = rankings.map(r => r[1].rank);
            const labels = rankings.map(r => r[1].season);
            
            if (data.length === 0) return;
            
            const padding = { top: 30, right: 30, bottom: 30, left: 40 };
            const chartWidth = width - padding.left - padding.right;
            const chartHeight = height - padding.top - padding.bottom;
            
            const maxRank = Math.max(...data, 20);
            const minRank = 1;
            
            ctx.strokeStyle = document.documentElement.classList.contains('dark') ? '#374151' : '#e5e7eb';
            ctx.lineWidth = 1;
            
            for (let i = 0; i <= 5; i++) {
                const y = padding.top + (chartHeight / 5) * i;
                ctx.beginPath();
                ctx.moveTo(padding.left, y);
                ctx.lineTo(width - padding.right, y);
                ctx.stroke();
                
                const rankValue = Math.round(maxRank - (maxRank - minRank) * (i / 5));
                ctx.fillStyle = document.documentElement.classList.contains('dark') ? '#9ca3af' : '#6b7280';
                ctx.font = '10px sans-serif';
                ctx.textAlign = 'right';
                ctx.fillText(rankValue.toString(), padding.left - 5, y + 3);
            }
            
            if (data.length > 1) {
                ctx.strokeStyle = '#f97316';
                ctx.lineWidth = 2;
                ctx.beginPath();
                
                data.forEach((rank, idx) => {
                    const x = padding.left + (chartWidth / (data.length - 1)) * idx;
                    const y = padding.top + ((rank - minRank) / (maxRank - minRank)) * chartHeight;
                    
                    if (idx === 0) {
                        ctx.moveTo(x, y);
                    } else {
                        ctx.lineTo(x, y);
                    }
                });
                
                ctx.stroke();
            }
            
            data.forEach((rank, idx) => {
                const x = padding.left + (chartWidth / Math.max(data.length - 1, 1)) * idx;
                const y = padding.top + ((rank - minRank) / (maxRank - minRank)) * chartHeight;
                
                ctx.fillStyle = '#f97316';
                ctx.beginPath();
                ctx.arc(x, y, 4, 0, Math.PI * 2);
                ctx.fill();
                
                ctx.fillStyle = '#fff';
                ctx.beginPath();
                ctx.arc(x, y, 2, 0, Math.PI * 2);
                ctx.fill();
                
                ctx.fillStyle = document.documentElement.classList.contains('dark') ? '#fff' : '#1f2937';
                ctx.font = 'bold 12px sans-serif';
                ctx.textAlign = 'center';
                ctx.fillText(rank.toString(), x, y - 10);
                
                ctx.fillStyle = document.documentElement.classList.contains('dark') ? '#9ca3af' : '#6b7280';
                ctx.font = '10px sans-serif';
                ctx.fillText(labels[idx], x, height - 10);
            });
        }
        
        function renderTeamNews() {
            const container = document.getElementById('teamNewsList');
            if (!currentTeam) return;
            
            const teamNews = rssData.filter(post => {
                const text = (post.title + ' ' + post.description).toLowerCase();
                return text.includes(currentTeam.name.toLowerCase());
            });
            
            if (teamNews.length === 0) {
                container.innerHTML = `
                    <div class="bg-white dark:bg-dark-surface rounded-lg p-8 text-center text-gray-400">
                        <i class="fas fa-newspaper text-4xl mb-2"></i>
                        <p>暂无相关动态</p>
                    </div>
                `;
                return;
            }
            
            container.innerHTML = teamNews.map((post, idx) => {
                const tagColors = {
                    match: 'bg-blue-100 dark:bg-blue-900 text-blue-700 dark:text-blue-300',
                    transfer: 'bg-purple-100 dark:bg-purple-900 text-purple-700 dark:text-purple-300',
                    official: 'bg-red-100 dark:bg-red-900 text-red-700 dark:text-red-300',
                    analysis: 'bg-amber-100 dark:bg-amber-900 text-amber-700 dark:text-amber-300',
                    news: 'bg-gray-100 dark:bg-gray-700 text-gray-700 dark:text-gray-300'
                };
                const tagNames = { match: '战报', transfer: '转会', official: '公告', analysis: '分析', news: '新闻' };
                const tagClass = tagColors[post.category] || tagColors.news;
                const tagName = tagNames[post.category] || '新闻';
                
                return `
                    <div onclick="openArticleFromTeam(${post.id})" class="bg-white dark:bg-dark-surface rounded-lg p-4 shadow-sm cursor-pointer active:scale-95 transition-transform">
                        <div class="flex items-center gap-2 mb-2">
                            <span class="${tagClass} px-2 py-0.5 rounded text-xs font-medium">${tagName}</span>
                            <span class="text-xs text-gray-400">${formatTime(post.pubDate)}</span>
                        </div>
                        <h4 class="font-bold text-sm dark:text-gray-100 line-clamp-2">${escapeHtml(post.title)}</h4>
                        <p class="text-xs text-gray-500 dark:text-gray-400 line-clamp-2 mt-1">${escapeHtml(post.description)}</p>
                    </div>
                `;
            }).join('');
        }
        
        function openArticleFromTeam(postId) {
            const post = rssData.find(p => p.id == postId);
            if (post) {
                openArticle(post);
            }
        }
        
        function openCoachDetail() {
            const container = document.getElementById('coachList');
            
            if (currentCoaches.length === 0) {
                container.innerHTML = '<div class="text-center text-gray-400 py-8">暂无教练信息</div>';
            } else {
                container.innerHTML = currentCoaches.map((coach, idx) => `
                    <div class="bg-white dark:bg-dark-surface rounded-lg p-4 shadow-sm">
                        <div class="flex items-center justify-between">
                            <div>
                                <div class="font-bold dark:text-gray-100 text-lg">${coach}</div>
                                <div class="text-sm text-gray-500">${idx === 0 ? '主教练' : '助理教练'}</div>
                            </div>
                            ${idx === 0 ? '<span class="text-emerald-600 text-sm font-medium">现任</span>' : ''}
                        </div>
                    </div>
                `).join('');
            }
            
            document.getElementById('coachDetailPage').classList.remove('hidden');
        }
        
        function backToTeamDetailFromCoach() {
            document.getElementById('coachDetailPage').classList.add('hidden');
        }
        
        function renderSquad() {
            const container = document.getElementById('playersList');
            const teamPlayers = playersData.filter(p => p.team === currentTeam.name);
            
            if (teamPlayers.length === 0) {
                container.innerHTML = '<div class="text-center text-gray-400 py-8">暂无球员数据</div>';
                return;
            }
            
            const positionOrder = ['GK', 'DF', 'MF', 'FW'];
            const positionTitles = {'GK': '门将', 'DF': '后卫', 'MF': '中场', 'FW': '前锋'};
            
            container.innerHTML = positionOrder.map(pos => {
                const posPlayers = teamPlayers.filter(p => p.mainPosition === pos);
                if (posPlayers.length === 0) return '';
                
                return `
                    <div class="mb-4">
                        <h3 class="text-sm font-bold text-gray-500 dark:text-gray-400 mb-2 uppercase tracking-wider">${positionTitles[pos]} (${posPlayers.length}人)</h3>
                        <div class="bg-white dark:bg-dark-surface rounded-lg overflow-hidden shadow-sm">
                            ${posPlayers.map((player, idx) => `
                                <div onclick="openPlayerDetail(${player.id})" class="player-card flex items-center gap-3 p-3 ${idx !== posPlayers.length - 1 ? 'border-b border-gray-100 dark:border-dark-border' : ''} cursor-pointer hover:bg-gray-50 dark:hover:bg-gray-700/50">
                                    <div class="flex-1 min-w-0">
                                        <div class="flex items-center gap-2">
                                            <span class="font-bold text-sm dark:text-gray-100">${player.name}</span>
                                            <span class="position-badge ${getPositionColorClass(pos)}">${player.positionName}</span>
                                        </div>
                                        <div class="text-xs text-gray-500 dark:text-gray-400 mt-0.5">
                                            ${player.age}岁 · ${player.nation} · 年薪${player.wage}万
                                        </div>
                                    </div>
                                    <div class="text-right">
                                        <div class="text-lg font-bold text-emerald-600">${player.ca}</div>
                                        <div class="text-xs text-gray-400">CA</div>
                                    </div>
                                </div>
                            `).join('')}
                        </div>
                    </div>
                `;
            }).join('');
        }
        
        function switchTeamTab(tab) {
            document.querySelectorAll('.team-tab').forEach(btn => {
                if (btn.dataset.tab === tab) {
                    btn.classList.add('tab-active');
                    btn.classList.remove('text-gray-500', 'dark:text-gray-400');
                } else {
                    btn.classList.remove('tab-active');
                    btn.classList.add('text-gray-500', 'dark:text-gray-400');
                }
            });
            
            ['squad', 'stats', 'schedule', 'news'].forEach(t => {
                document.getElementById(t + 'Content').classList.toggle('hidden', t !== tab);
            });
            
            if (tab === 'stats') {
                setTimeout(() => {
                    const historyData = getTeamHistoryData(currentTeam.name);
                    if (historyData && historyData.rankings) {
                        const sortedRankings = Object.entries(historyData.rankings)
                            .sort((a, b) => {
                                const numA = parseInt(a[0].replace('S', ''));
                                const numB = parseInt(b[0].replace('S', ''));
                                return numA - numB;
                            });
                        drawRankingChart(sortedRankings);
                    }
                }, 50);
            }
        }
        
        function backToTeamList() {
            document.getElementById('teamDetailPage').classList.add('hidden');
            document.getElementById('coachDetailPage').classList.add('hidden');
            document.body.style.overflow = '';
            currentTeam = null;
            currentCoaches = [];
        }
        
        function shareTeam() {
            if (navigator.share && currentTeam) {
                navigator.share({
                    title: currentTeam.name,
                    text: `查看${currentTeam.name}的详细资料`,
                    url: window.location.href
                });
            }
        }
        
        function openPlayerDetail(playerId) {
            const player = playersData.find(p => p.id === playerId);
            if (!player) return;
            
            document.getElementById('playerInitial').textContent = player.name.charAt(0);
            document.getElementById('playerDetailPosition').textContent = player.positionName;
            document.getElementById('playerDetailPosition').className = 'position-badge ' + getPositionColorClass(player.mainPosition);
            document.getElementById('playerDetailName').textContent = player.name;
            document.getElementById('playerDetailTeam').textContent = player.team;
            
            const rating = Math.min(10, (player.ca / 200) * 10).toFixed(1);
            document.getElementById('playerDetailRating').textContent = rating;
            
            document.getElementById('playerDetailCA').textContent = player.ca;
            document.getElementById('playerDetailPA').textContent = player.pa;
            document.getElementById('playerDetailAge').textContent = player.age + '岁';
            document.getElementById('playerDetailNation').textContent = player.nation;
            document.getElementById('playerDetailHeight').textContent = player.height + 'cm';
            document.getElementById('playerDetailWeight').textContent = player.weight + 'kg';
            document.getElementById('playerDetailTeam2').textContent = player.team;
            document.getElementById('playerDetailContract').textContent = player.contractEnd || '未到期';
            document.getElementById('playerDetailWage').textContent = player.wage + '万';
            document.getElementById('playerDetailClause').textContent = player.clause ? player.clause + '万' : '无';
            
            const positionsContainer = document.getElementById('playerAllPositions');
            positionsContainer.innerHTML = player.allPositions.map((pos, idx) => {
                const posCat = getPositionCategory(pos);
                return `<span class="position-badge ${getPositionColorClass(posCat)}">${pos}</span>`;
            }).join('');
            
            document.getElementById('playerDetailPage').classList.remove('hidden');
        }
        
        function backToTeamDetail() {
            document.getElementById('playerDetailPage').classList.add('hidden');
        }
        
        function sharePlayer() {
            const playerName = document.getElementById('playerDetailName').textContent;
            if (navigator.share) {
                navigator.share({
                    title: playerName,
                    text: `查看${playerName}的详细资料`,
                    url: window.location.href
                });
            }
        }

        function switchTab(tab) {
            currentTab = tab;
            
            document.querySelectorAll('.bottom-nav-item').forEach(btn => {
                btn.classList.remove('active', 'text-emerald-600', 'dark:text-emerald-400');
                btn.classList.add('text-gray-400', 'dark:text-gray-500');
                if (btn.dataset.tab === tab) {
                    btn.classList.add('active', 'text-emerald-600', 'dark:text-emerald-400');
                    btn.classList.remove('text-gray-400', 'dark:text-gray-500');
                }
            });
            
            document.getElementById('newsFeed').classList.add('hidden');
            document.getElementById('teamPage').classList.add('hidden');
            document.getElementById('matchPage').classList.add('hidden');
            document.getElementById('dataPage').classList.add('hidden');
            document.getElementById('homeTabs').classList.add('hidden');
            document.getElementById('pullIndicator').classList.add('hidden');
            
            if (tab === 'home') {
                document.getElementById('newsFeed').classList.remove('hidden');
                document.getElementById('homeTabs').classList.remove('hidden');
                document.getElementById('pullIndicator').classList.remove('hidden');
                loadRSS();
            } else if (tab === 'match') {
                document.getElementById('matchPage').classList.remove('hidden');
                if (scheduleData.length === 0) {
                    loadScheduleData().then(() => renderMatchPage());
                } else {
                    renderMatchPage();
                }
            } else if (tab === 'team') {
                document.getElementById('teamPage').classList.remove('hidden');
                if (teamData.length === 0) {
                    loadTeamData();
                }
            } else if (tab === 'data') {
                document.getElementById('dataPage').classList.remove('hidden');
                loadDataPage();
            } else {
                document.getElementById('newsFeed').classList.remove('hidden');
                document.getElementById('newsFeed').innerHTML = `
                    <div class="p-8 text-center text-gray-400 dark:text-gray-500 mt-20">
                        <i class="fas fa-tools text-4xl mb-3"></i>
                        <p>功能开发中</p>
                        <p class="text-sm mt-2">敬请期待</p>
                    </div>
                `;
            }
        }

        function escapeHtml(text) {
            if (!text) return '';
            const div = document.createElement('div');
            div.textContent = text;
            return div.innerHTML;
        }

        function stripHtml(html) {
            if (!html) return '';
            const tmp = document.createElement('div');
            tmp.innerHTML = html;
            return tmp.textContent || tmp.innerText || '';
        }

        function formatTime(dateStr) {
            if (!dateStr) return '';
            const date = new Date(dateStr);
            const now = new Date();
            const diff = (now - date) / 1000;
            
            if (diff < 60) return '刚刚';
            if (diff < 3600) return `${Math.floor(diff/60)}分钟前`;
            if (diff < 86400) return `${Math.floor(diff/3600)}小时前`;
            if (diff < 604800) return `${Math.floor(diff/86400)}天前`;
            return date.toLocaleDateString('zh-CN', {month: 'short', day: 'numeric'});
        }

        document.addEventListener('keydown', (e) => {
            if (e.key === 'Escape') {
                closeArticle();
                backToTeamDetail();
                backToTeamList();
                closeSearch();
            }
        });
        
        // 监听窗口大小变化，重绘图表
        window.addEventListener('resize', () => {
            if (currentTeam && !document.getElementById('statsContent').classList.contains('hidden')) {
                const historyData = getTeamHistoryData(currentTeam.name);
                if (historyData && historyData.rankings) {
                    const sortedRankings = Object.entries(historyData.rankings)
                        .sort((a, b) => {
                            const numA = parseInt(a[0].replace('S', ''));
                            const numB = parseInt(b[0].replace('S', ''));
                            return numA - numB;
                        });
                    drawRankingChart(sortedRankings);
                }
            }
        });
    </script>
</body>
</html>
