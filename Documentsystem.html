<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>è¨ç‰¹ç¬¬äºŒå…±å’Œå›½å…¬æ–‡ç”Ÿæˆå™¨ | Sutter Republic II Official Document Generator</title>
    <script src="https://html2canvas.hertzen.com/dist/html2canvas.min.js"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Noto+Serif+SC:wght@400;600;700;900&display=swap');
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: "Microsoft YaHei", "PingFang SC", "Helvetica Neue", Arial, sans-serif;
            background: linear-gradient(135deg, #1a1a2e 0%, #16213e 50%, #0f3460 100%);
            min-height: 100vh;
            padding: 20px;
            color: #333;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            display: grid;
            grid-template-columns: 400px 1fr;
            gap: 30px;
        }

        @media (max-width: 1100px) {
            .container { grid-template-columns: 1fr; }
        }

        /* å·¦ä¾§æ§åˆ¶é¢æ¿ */
        .control-panel {
            background: rgba(255, 255, 255, 0.95);
            border-radius: 12px;
            padding: 30px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
            height: fit-content;
            border-top: 4px solid #c9a227;
            position: sticky;
            top: 20px;
        }

        .panel-title {
            font-size: 1.4rem;
            color: #1a237e;
            font-weight: 700;
            margin-bottom: 25px;
            padding-bottom: 15px;
            border-bottom: 2px solid #e0e0e0;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .form-group {
            margin-bottom: 20px;
        }

        label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: #1a237e;
            font-size: 0.9rem;
        }

        input[type="text"], textarea {
            width: 100%;
            padding: 12px;
            border: 2px solid #e0e0e0;
            border-radius: 6px;
            font-size: 0.95rem;
            transition: all 0.3s;
            font-family: "Microsoft YaHei", sans-serif;
        }

        input:focus, textarea:focus {
            outline: none;
            border-color: #1a237e;
            box-shadow: 0 0 0 3px rgba(26,35,126,0.1);
        }

        textarea {
            resize: vertical;
            min-height: 120px;
            line-height: 1.6;
        }

        .btn {
            width: 100%;
            padding: 14px;
            border: none;
            border-radius: 8px;
            font-size: 1rem;
            font-weight: 700;
            cursor: pointer;
            transition: all 0.3s;
            margin-top: 10px;
        }

        .btn-primary {
            background: linear-gradient(135deg, #1a237e 0%, #3949ab 100%);
            color: white;
            box-shadow: 0 4px 15px rgba(26,35,126,0.3);
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(26,35,126,0.4);
        }

        .info-box {
            background: #f5f7ff;
            border-left: 4px solid #1a237e;
            padding: 15px;
            margin-top: 20px;
            border-radius: 4px;
            font-size: 0.85rem;
            color: #555;
        }

        /* å³ä¾§é¢„è§ˆåŒº */
        .preview-area {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 20px;
        }

        /* A4 å…¬æ–‡å®¹å™¨ - è‡ªé€‚åº”é«˜åº¦ */
        .document-container {
            width: 210mm;
            min-height: 297mm; /* æœ€å°A4é«˜åº¦ï¼Œä½†å¯å»¶é•¿ */
            height: auto; /* é«˜åº¦è‡ªé€‚åº”å†…å®¹ */
            background: white;
            padding: 20mm;
            box-shadow: 0 0 0 1px #333, 0 0 0 10px #fff, 0 0 0 11px #333, 0 20px 60px rgba(0,0,0,0.5);
            position: relative;
            overflow: hidden;
            font-family: "STFangsong", "FangSong", "Noto Serif SC", "SimSun", serif;
            color: #000;
            display: flex;
            flex-direction: column; /* çºµå‘ flex å¸ƒå±€ */
        }

        @media (max-width: 900px) {
            .document-container {
                width: 100%;
                min-height: auto;
                padding: 20px;
            }
        }

        /* å…¬æ–‡å¤´éƒ¨ */
        .doc-header {
            text-align: center;
            margin-bottom: 30px;
            position: relative;
            flex-shrink: 0; /* ä¸å‹ç¼© */
        }

        .doc-number {
            position: absolute;
            top: -10px;
            right: 0;
            font-size: 10pt;
            font-family: "Times New Roman", serif;
            color: #333;
            letter-spacing: 1px;
        }

        .national-emblem {
            width: 70px;
            height: 70px;
            margin: 0 auto 15px;
            background: url('https://i.imgs.ovh/2026/01/28/y9gXK9.png') center/contain no-repeat;
            filter: grayscale(100%) contrast(120%);
        }

        .country-name {
            font-size: 22pt;
            font-weight: 900;
            letter-spacing: 3px;
            margin-bottom: 5px;
            font-family: "Times New Roman", "Noto Serif SC", serif;
            text-transform: uppercase;
        }

        .department-name {
            font-size: 14pt;
            font-weight: 700;
            letter-spacing: 2px;
            text-transform: uppercase;
            margin-bottom: 20px;
            border-bottom: 2px solid #000;
            padding-bottom: 10px;
            display: inline-block;
        }

        .salutation {
            font-size: 12pt;
            font-style: italic;
            font-weight: 600;
            margin: 20px 0;
            font-family: "Times New Roman", serif;
        }

        /* å…¬æ–‡æ ‡é¢˜ */
        .doc-title {
            text-align: center;
            font-size: 26pt;
            font-weight: 700;
            margin: 30px 0 25px;
            line-height: 1.3;
            font-family: "æ–¹æ­£å°æ ‡å®‹", "FZXiaoBiaoSong-B05S", "Noto Serif SC", "Times New Roman", serif;
            letter-spacing: 2px;
            color: #000;
            flex-shrink: 0;
        }

        /* å…¬æ–‡æ­£æ–‡ - è‡ªåŠ¨æ‰©å±• */
        .doc-body {
            font-size: 16pt;
            line-height: 1.8;
            text-align: justify;
            text-indent: 2em;
            margin-bottom: 40px;
            font-family: "åæ–‡ä»¿å®‹", "STFangsong", "FangSong", "Noto Serif SC", "SimSun", serif;
            color: #000;
            flex: 1; /* å æ®å‰©ä½™ç©ºé—´ï¼Œä½†å…è®¸å»¶é•¿ */
        }

        .doc-body p {
            margin-bottom: 1em;
            text-indent: 2em;
        }

        /* åº•éƒ¨åŒºåŸŸ - è‡ªç„¶æµå¼å¸ƒå±€ï¼Œä¸å†ç»å¯¹å®šä½ */
        .doc-footer {
            margin-top: 20px; /* ä¸æ­£æ–‡é—´è· */
            padding-top: 30px;
            border-top: 1px solid #ccc;
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            gap: 40px;
            position: relative;
            flex-shrink: 0; /* åº•éƒ¨åŒºåŸŸä¸å‹ç¼© */
            min-height: 200px; /* ç¡®ä¿åº•éƒ¨åŒºåŸŸæœ‰è¶³å¤Ÿç©ºé—´ */
        }

        /* æ³•å¾‹å¼•ç”¨ï¼ˆå·¦ä¾§ï¼‰ */
        .legal-reference {
            width: 40%;
            font-size: 8pt;
            line-height: 1.4;
            color: #333;
            font-family: "Times New Roman", serif;
            text-align: left;
        }

        .legal-reference p {
            margin-bottom: 0.5em;
            text-indent: 0;
        }

        /* ç­¾ååŒºåŸŸï¼ˆå³ä¾§ï¼‰ */
        .signature-area {
            width: 55%;
            text-align: left;
        }

        .testimony-text {
            font-size: 11pt;
            line-height: 1.6;
            margin-bottom: 30px;
            text-align: justify;
            font-family: "åæ–‡ä»¿å®‹", "STFangsong", serif;
        }

        /* æŠ„é€éƒ¨é—¨ */
        .cc-section {
            margin-bottom: 20px;
            font-size: 10.5pt;
            font-family: "Microsoft YaHei", "Segoe UI", sans-serif;
            color: #333;
        }

        .cc-label {
            font-weight: 600;
        }

        /* ç­¾åå— */
        .signature-block {
            text-align: center;
            margin-top: 20px;
        }

        .signature-line {
            border-bottom: 1px solid #000;
            width: 80%;
            margin: 0 auto 5px;
            height: 40px;
        }

        .signature-name {
            font-size: 12pt;
            font-weight: 600;
            margin-top: 5px;
            font-family: "Microsoft YaHei", "Segoe UI", sans-serif;
        }

        .signature-title {
            font-size: 10pt;
            color: #333;
            margin-top: 3px;
            font-family: "Microsoft YaHei", sans-serif;
        }

        /* å°ç« ä½ç½® - ç›¸å¯¹äº footer å®šä½åœ¨åº•éƒ¨ä¸­å¤® */
        .seal-placeholder {
            position: absolute;
            bottom: 20px;
            left: 50%;
            transform: translateX(-50%) rotate(-15deg);
            width: 90px;
            height: 90px;
            border: 3px solid #c9a227;
            border-radius: 50%;
            opacity: 0.2;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 8pt;
            text-align: center;
            color: #c9a227;
            pointer-events: none;
        }

        /* æ—¶é—´æˆ³ - é¡µé¢æœ€å³ä¸‹è§’ */
        .timestamp {
            margin-top: 30px;
            text-align: right;
            font-size: 9pt;
            color: #666;
            font-family: "Microsoft YaHei", "Consolas", monospace;
            letter-spacing: 0.5px;
            border-top: 1px solid #eee;
            padding-top: 10px;
        }

        /* ä¸‹è½½æŒ‰é’® */
        .download-section {
            position: sticky;
            bottom: 20px;
            background: rgba(255,255,255,0.95);
            padding: 15px;
            border-radius: 10px;
            box-shadow: 0 -4px 20px rgba(0,0,0,0.1);
            text-align: center;
            width: 210mm;
        }

        .btn-download {
            background: linear-gradient(135deg, #c9a227 0%, #f4d03f 100%);
            color: #1a1a1a;
            padding: 12px 40px;
            font-size: 1.1rem;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-weight: 700;
            transition: all 0.3s;
        }

        .btn-download:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 15px rgba(201,162,39,0.4);
        }

        .loading-overlay {
            position: fixed;
            top: 0; left: 0; right: 0; bottom: 0;
            background: rgba(0,0,0,0.8);
            display: none;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 1.2rem;
            z-index: 9999;
            flex-direction: column;
            gap: 15px;
        }

        .spinner {
            width: 40px;
            height: 40px;
            border: 4px solid #f3f3f3;
            border-top: 4px solid #c9a227;
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
    </style>
</head>
<body>
    <div class="loading-overlay" id="loading">
        <div class="spinner"></div>
        <div>æ­£åœ¨ç”Ÿæˆå…¬æ–‡...</div>
    </div>

    <div class="container">
        <div class="control-panel">
            <div class="panel-title">
                <span>ğŸ“‹</span>
                <span>å…¬æ–‡ä¿¡æ¯å½•å…¥</span>
            </div>

            <div class="form-group">
                <label>æ–‡ä»¶ç¼–å·</label>
                <input type="text" id="docNumber" placeholder="å¦‚ï¼šSUTTER-2026-001" value="SUTTER-2026-001">
            </div>

            <div class="form-group">
                <label>å‘æ–‡æœºå…³</label>
                <input type="text" id="issuerOrg" placeholder="å¦‚ï¼šå¤–äº¤éƒ¨" value="å¤–äº¤éƒ¨">
            </div>

            <div class="form-group">
                <label>å…¬æ–‡æ ‡é¢˜</label>
                <input type="text" id="docTitle" placeholder="è¯·è¾“å…¥å…¬æ–‡æ ‡é¢˜" value="å…³äºå»ºç«‹å¤–äº¤å…³ç³»çš„è”åˆå…¬æŠ¥">
            </div>

            <div class="form-group">
                <label>å…¬æ–‡æ­£æ–‡</label>
                <textarea id="docBody" rows="8" placeholder="è¯·è¾“å…¥å…¬æ–‡æ­£æ–‡å†…å®¹...">é‰´äºè¨ç‰¹ç¬¬äºŒå…±å’Œå›½ä¸è´µå›½åœ¨å¹³ç­‰äº’åˆ©çš„åŸºç¡€ä¸Šï¼Œä¸ºç»´æŠ¤ä¸–ç•Œå’Œå¹³ä¸ä¿ƒè¿›å…±åŒå‘å±•ï¼Œå†³å®šè‡ªå³æ—¥èµ·å»ºç«‹å¤§ä½¿çº§å¤–äº¤å…³ç³»ã€‚

åŒæ–¹åŒæ„åœ¨ç›¸äº’å°Šé‡ä¸»æƒå’Œé¢†åœŸå®Œæ•´ã€äº’ä¸ä¾µçŠ¯ã€äº’ä¸å¹²æ¶‰å†…æ”¿ã€å¹³ç­‰äº’åˆ©ã€å’Œå¹³å…±å¤„çš„åŸåˆ™åŸºç¡€ä¸Šå‘å±•ä¸¤å›½å‹å¥½åˆä½œå…³ç³»ã€‚

åŒæ–¹åŒæ„äº’æ´¾å¤§ä½¿ï¼Œå¹¶åœ¨å„è‡ªé¦–éƒ½ä¸ºå¯¹æ–¹å»ºç«‹ä½¿é¦†åŠå±¥è¡Œå…¬åŠ¡æä¾›ä¸€åˆ‡å¿…è¦çš„ååŠ©ã€‚

æœ¬å…¬æŠ¥è‡ªç­¾ç½²ä¹‹æ—¥èµ·ç”Ÿæ•ˆã€‚</textarea>
            </div>

            <div class="form-group">
                <label>æŠ„é€éƒ¨é—¨</label>
                <input type="text" id="ccDepts" placeholder="å¦‚ï¼šå„éƒ¨ã€å„å§”å‘˜ä¼š" value="å„éƒ¨ã€å„å§”å‘˜ä¼šï¼Œå„çœã€è‡ªæ²»åŒºã€ç›´è¾–å¸‚æ”¿åºœ">
            </div>

            <div class="form-group">
                <label>å‘æ–‡äººå§“å</label>
                <input type="text" id="issuerName" placeholder="å¦‚ï¼šSchnekov" value="Schnekov">
            </div>

            <button class="btn btn-primary" onclick="updateDocument()">ğŸ”„ æ›´æ–°é¢„è§ˆ</button>
            
            <div class="info-box">
                <strong>ğŸ’¡ æç¤ºï¼š</strong><br>
                â€¢ æ ‡é¢˜ä½¿ç”¨æ–¹æ­£å°æ ‡å®‹ï¼Œæ­£æ–‡ä½¿ç”¨åæ–‡ä»¿å®‹<br>
                â€¢ åº•éƒ¨åŒºåŸŸï¼ˆæ³•å¾‹å¼•ç”¨ã€ç­¾åã€å°ç« ï¼‰å›ºå®šåœ¨æ­£æ–‡ä¹‹å<br>
                â€¢ æ­£æ–‡è¿‡é•¿æ—¶è‡ªåŠ¨å»¶é•¿é¡µé¢ï¼Œä¿æŒA4å®½åº¦<br>
                â€¢ æ—¶é—´æˆ³ç²¾ç¡®åˆ°ç§’ï¼Œå®æ—¶æ›´æ–°
            </div>
        </div>

        <div class="preview-area">
            <div class="document-container" id="document">
                <div class="doc-number" id="displayNumber">SUTTER-2026-001</div>
                
                <div class="doc-header">
                    <div class="national-emblem"></div>
                    <div class="country-name">Sutter Republic II</div>
                    <div class="department-name" id="displayOrg">å¤–äº¤éƒ¨</div>
                    <div class="salutation">To all to whom these presents shall come, Greetings:</div>
                </div>

                <div class="doc-title" id="displayTitle">å…³äºå»ºç«‹å¤–äº¤å…³ç³»çš„è”åˆå…¬æŠ¥</div>

                <div class="doc-body" id="displayBody">
                    <p>é‰´äºè¨ç‰¹ç¬¬äºŒå…±å’Œå›½ä¸è´µå›½åœ¨å¹³ç­‰äº’åˆ©çš„åŸºç¡€ä¸Šï¼Œä¸ºç»´æŠ¤ä¸–ç•Œå’Œå¹³ä¸ä¿ƒè¿›å…±åŒå‘å±•ï¼Œå†³å®šè‡ªå³æ—¥èµ·å»ºç«‹å¤§ä½¿çº§å¤–äº¤å…³ç³»ã€‚</p>
                    <p>åŒæ–¹åŒæ„åœ¨ç›¸äº’å°Šé‡ä¸»æƒå’Œé¢†åœŸå®Œæ•´ã€äº’ä¸ä¾µçŠ¯ã€äº’ä¸å¹²æ¶‰å†…æ”¿ã€å¹³ç­‰äº’åˆ©ã€å’Œå¹³å…±å¤„çš„åŸåˆ™åŸºç¡€ä¸Šå‘å±•ä¸¤å›½å‹å¥½åˆä½œå…³ç³»ã€‚</p>
                    <p>åŒæ–¹åŒæ„äº’æ´¾å¤§ä½¿ï¼Œå¹¶åœ¨å„è‡ªé¦–éƒ½ä¸ºå¯¹æ–¹å»ºç«‹ä½¿é¦†åŠå±¥è¡Œå…¬åŠ¡æä¾›ä¸€åˆ‡å¿…è¦çš„ååŠ©ã€‚</p>
                    <p>æœ¬å…¬æŠ¥è‡ªç­¾ç½²ä¹‹æ—¥èµ·ç”Ÿæ•ˆã€‚</p>
                </div>

                <!-- åº•éƒ¨åŒºåŸŸï¼šæµå¼å¸ƒå±€ï¼Œä¸å†ç»å¯¹å®šä½ -->
                <div class="doc-footer">
                    <div class="legal-reference">
                        <p>Issued pursuant to the Constitution of Sutter Republic II, Article 45, Section 3; and the Foreign Service Act of 2024, SRII Title 22, Chapter 38.</p>
                        <p>This document is not valid if it is removed or altered in any way whatsoever.</p>
                        <p>Authenticated by the Department of SRII Government seal.</p>
                    </div>

                    <div class="signature-area">
                        <div class="testimony-text">
                            In testimony whereof, I, <span id="displayIssuer">Schnekov</span>, Officer of State, 
                            have hereunto caused the seal of the Department of State to be 
                            affixed and my name subscribed by the Assistant Authentication 
                            Officer, of the said Department, at the city of Hollyfeak Capital District, in the 
                            Kessiby Province, this <span id="displayDate">seventh day of September, 2026</span>.
                        </div>

                        <div class="cc-section">
                            <span class="cc-label">æŠ„é€ï¼š</span><span id="displayCC">å„éƒ¨ã€å„å§”å‘˜ä¼šï¼Œå„çœã€è‡ªæ²»åŒºã€ç›´è¾–å¸‚æ”¿åºœ</span>
                        </div>

                        <div class="signature-block">
                            <div class="signature-line"></div>
                            <div class="signature-name" id="displaySignature">Schnekov</div>
                            <div class="signature-title">Secretary of State<br>Department of State</div>
                        </div>
                    </div>

                    <!-- å°ç« æ”¾åœ¨åº•éƒ¨ä¸­å¤® -->
                    <div class="seal-placeholder">
                        OFFICIAL<br>SEAL
                    </div>
                </div>

                <div class="timestamp" id="timestamp">2026-01-28 14:32:18</div>
            </div>

            <div class="download-section">
                <button class="btn-download" onclick="downloadDocument()">ğŸ“¥ ä¸‹è½½å…¬æ–‡å›¾ç‰‡ (PNG)</button>
            </div>
        </div>
    </div>

    <script>
        // æ›´æ–°æ—¥æœŸå’Œæ—¶é—´æˆ³
        function updateDate() {
            const now = new Date();
            
            // è‹±æ–‡æ—¥æœŸæ ¼å¼
            const day = now.getDate();
            const ordinal = getOrdinal(day);
            const month = now.toLocaleDateString('en-US', { month: 'long' });
            const year = now.getFullYear();
            const formattedDate = `${ordinal} day of ${month}, ${year}`;
            
            document.getElementById('displayDate').textContent = formattedDate;
            
            // æ•°å­—æ—¶é—´æˆ³ï¼ˆç²¾ç¡®åˆ°ç§’ï¼‰
            const timestamp = now.getFullYear() + '-' + 
                            String(now.getMonth() + 1).padStart(2, '0') + '-' + 
                            String(now.getDate()).padStart(2, '0') + ' ' + 
                            String(now.getHours()).padStart(2, '0') + ':' + 
                            String(now.getMinutes()).padStart(2, '0') + ':' + 
                            String(now.getSeconds()).padStart(2, '0');
            document.getElementById('timestamp').textContent = 'Generated: ' + timestamp + ' | Sutter Republic II Official Document System';
        }

        function getOrdinal(n) {
            const s = ["th", "st", "nd", "rd"];
            const v = n % 100;
            return n + (s[(v - 20) % 10] || s[v] || s[0]);
        }

        // æ¯ç§’æ›´æ–°æ—¶é—´æˆ³
        setInterval(updateDate, 1000);
        updateDate();

        function updateDocument() {
            const number = document.getElementById('docNumber').value || 'NO.001';
            const org = document.getElementById('issuerOrg').value || 'å¤–äº¤éƒ¨';
            const title = document.getElementById('docTitle').value || 'å…¬æ–‡æ ‡é¢˜';
            const body = document.getElementById('docBody').value || '';
            const cc = document.getElementById('ccDepts').value || '';
            const issuer = document.getElementById('issuerName').value || 'Schnekov';

            document.getElementById('displayNumber').textContent = number;
            document.getElementById('displayOrg').textContent = org;
            document.getElementById('displayTitle').textContent = title;
            document.getElementById('displayCC').textContent = cc;
            document.getElementById('displayIssuer').textContent = issuer;
            document.getElementById('displaySignature').textContent = issuer;

            // å¤„ç†æ­£æ–‡æ¢è¡Œï¼ŒæŒ‰æ®µè½åˆ†å‰²
            const bodyDiv = document.getElementById('displayBody');
            const paragraphs = body.split('\n').filter(p => p.trim());
            if (paragraphs.length === 0) {
                bodyDiv.innerHTML = '<p>ï¼ˆæ— æ­£æ–‡å†…å®¹ï¼‰</p>';
            } else {
                bodyDiv.innerHTML = paragraphs.map(p => `<p>${p}</p>`).join('');
            }
        }

        async function downloadDocument() {
            const loading = document.getElementById('loading');
            loading.style.display = 'flex';

            // ç­‰å¾…å­—ä½“åŠ è½½
            await document.fonts.ready;
            
            // çŸ­æš‚å»¶è¿Ÿç¡®ä¿DOMæ›´æ–°å®Œæˆ
            await new Promise(resolve => setTimeout(resolve, 100));

            const element = document.getElementById('document');
            
            try {
                const canvas = await html2canvas(element, {
                    scale: 2,
                    useCORS: true,
                    allowTaint: true,
                    backgroundColor: '#ffffff',
                    logging: false,
                    height: element.scrollHeight, // ç¡®ä¿æ•è·å®Œæ•´é«˜åº¦
                    windowHeight: element.scrollHeight,
                    x: 0,
                    y: 0,
                    scrollX: 0,
                    scrollY: 0
                });

                const link = document.createElement('a');
                const timestamp = new Date().toISOString().slice(0,10);
                const title = document.getElementById('docTitle').value || 'Document';
                // ç®€åŒ–æ–‡ä»¶åï¼Œé¿å…ç‰¹æ®Šå­—ç¬¦
                const safeTitle = title.replace(/[^\w\u4e00-\u9fa5]/g, '_').substring(0, 30);
                link.download = `SUTTER_${safeTitle}_${timestamp}.png`;
                link.href = canvas.toDataURL('image/png');
                link.click();

                loading.style.display = 'none';
                
                // æˆåŠŸæç¤º
                const btn = document.querySelector('.btn-download');
                const originalText = btn.textContent;
                btn.textContent = 'âœ… ä¸‹è½½æˆåŠŸ';
                btn.style.background = '#4caf50';
                setTimeout(() => {
                    btn.textContent = originalText;
                    btn.style.background = '';
                }, 2000);
            } catch(err) {
                console.error(err);
                loading.style.display = 'none';
                alert('ç”Ÿæˆå¤±è´¥ï¼Œè¯·é‡è¯•ã€‚é”™è¯¯ï¼š' + err.message);
            }
        }

        // åˆå§‹åŒ–
        updateDocument();
    </script>
</body>
</html>
